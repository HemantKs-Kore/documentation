<ng-template #ruleContainer let-rulesObj='rulesObj' let-rulesSet="rulesSet" let-rule='rule' let-ruleIndex='ruleIndex'  let-validationMode='validationMode'>
    <div [ngClass]="{'validation-rules-add-edit row m-0 mt-1 mb-1 w-100 col-12': (validationMode==='simple')}">        
        <div [ngClass]="{'drop-down-sec w-100 col-12 row m-0 p-0':(validationMode==='simple'), 'd-flex mt-mb-11 w-100 rules-selection align-items-center':(validationMode==='advanced')}" class="drop-down-sec w-100 col-12 row m-0 p-0">
            <span class="info-rule if">If</span>
            <div *ngIf="validationMode==='simple'" class="close-minus-btn" (click)="removeSimpleRule(rulesSet,ruleIndex)"><span>-</span></div>
            <div *ngIf="validationMode==='advanced'" class="close-minus-btn" (click)="removeAdvancedRule(ruleIndex,rulesSet,rule)"><span>-</span></div>
            <div class="col-3">                        
                <div class="kr-sg-dropdowns">                           
                    <div class="dropdown dropdown-open" ngbDropdown>
                        <button class="dropdown-toggle dropdown-input"  ngbDropdownToggle>Choose </button>                                            
                        <ul class="dropdown-menu content-menu p-0" ngbDropdownMenu (click)="$event.stopImmediatePropagation()"> 
                        <li><a>1</a></li>  
                        <li><a>1</a></li>  
                        <li><a>1</a></li>  
                        <li><a>1</a></li>                                                                         
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-3">                        
                <div class="kr-sg-input-text">
                    <input type="text" [(ngModel)]="rule.value"  placeholder="" class="input-text">
                </div>
            </div>
            <div class="col-3">                        
                <div class="kr-sg-dropdowns">                           
                    <div class="dropdown dropdown-open" ngbDropdown>
                        <button class="dropdown-toggle dropdown-input"  ngbDropdownToggle>Choose </button>                                            
                        <ul class="dropdown-menu content-menu p-0" ngbDropdownMenu (click)="$event.stopImmediatePropagation()"> 
                            <li><a>1</a></li>  
                            <li><a>1</a></li>  
                            <li><a>1</a></li>  
                            <li><a>1</a></li>                                                                         
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-3">                        
                <div class="kr-sg-input-text">
                    <input type="text" [(ngModel)]="rule.value"  placeholder="" class="input-text">
                </div>
            </div>
        </div>        
    </div>
    <ng-container *ngIf="validationMode==='simple'">
    <div class="rule-info" *ngIf="ruleIndex !== (rulesSet.rules.length-1)">AND</div>
    <div class="row justify-content-between align-items-center col-12 pr-0 add-rule-plus-icon" *ngIf="ruleIndex === (rulesSet.rules.length-1)">
        <div class="close-minus-btn add-plus" (click)="addSimpleRule(rulesSet,'simple')"><span>+</span></div>
    </div>
    <div class="error-message-text-box w-100 mb-2 col-12 row m-0" *ngIf="ruleIndex === (rulesSet.rules.length-1)">
        <span class="info-rule">then</span>
        <div class="kr-sg-dropdowns col-3">                           
            <div class="dropdown dropdown-open" ngbDropdown>
                <button class="dropdown-toggle dropdown-input"  ngbDropdownToggle>Choose </button>                                            
                <ul class="dropdown-menu content-menu p-0" ngbDropdownMenu (click)="$event.stopImmediatePropagation()"> 
                    <li><a>1</a></li>  
                    <li><a>1</a></li>  
                    <li><a>1</a></li>  
                    <li><a>1</a></li>                                                                         
                </ul>
            </div>
        </div>
        <div class="kr-sg-input-text col-9">
            <input type="text" placeholder="Please select department"  [(ngModel)]="rulesSet.errorMsg" class="input-text">            
        </div>     
    </div>
    </ng-container>
</ng-template>

<div class="rules-table-container">
    <div class="tab-sec-top">
        <div (click)='selectTab("attributes")' class="tab-name" [ngClass]="{'active': selectedTab==='attributes'}">Attributes</div>
        <div (click)='selectTab("rules")' class="tab-name" [ngClass]="{'active': selectedTab==='rules'}">Rules</div>
        <div  (click)='selectTab("signals")' class="tab-name" [ngClass]="{'active': selectedTab==='signals'}">Signals</div>
        <div class="header-sec">
            <div class="kr-sg-input-search">                               
                <input type="text" placeholder="Search" class="input-search" id="searchFaqs" name='faqsSearch'>
                <img src="assets/icons/search-gray.svg" class="search-icon">
            </div>
            <button class="kr-sg-button-primary btn_md" (click)="addEditRule()" *ngIf="selectedTab==='rules'">Add</button>
            <button class="kr-sg-button-primary btn_md" (click)="addEditAttibutes()">Add</button>
        </div>
    </div>
   <ng-container *ngIf="selectedTab==='rules'">
    <div class="faq-header-sec row m-0">
        <div class="col-12 left-sec p-0">
            <div class="tab-sec d-flex">
                <div class="tab_title active">Drafts<span>(0)</span></div>
                <div class="tab_title">In-review<span>(0)</span></div>
                <div class="tab_title">Approved<span>(0)</span></div>
            </div>
        </div>       
    </div>
    <div class="table-list-content">
        <div class="kr-sg-data-table">      
          <section class="table-content">
            <header class="table-header">
              <div class="col-2 col_">RULE NAME<img src="assets/icons/caretDown.svg" class="ml-1 sortImg"></div>
              <div class="col-2 col_ d-flex align-items-center">Type<span class="selected-length-doc-web hide">(2)</span>
                <div class="kr-sg-dropdowns type_sort_dropdown" #sourceFilter="ngbDropdown" ngbDropdown [container]="'body'" [autoClose]="true" [placement]="'bottom-right'">
                  <div class="dropdown dropdown-open">
                    <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopPropagation()"><img src="assets/icons/caretDown.svg" class="ml-1 sortImg"></button>
                    <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                      <li><span class="list-name">All</span><img class="hide" src="assets/icons/check-blue.svg"></li>                      
                    </ul>
                  </div>
                </div>
              </div>              
              <div class="col_ col-2 d-flex align-items-center">Status<span class="selected-length-doc-web hide">(2)</span>
                <div class="kr-sg-dropdowns type_sort_dropdown" #statusFilter="ngbDropdown" ngbDropdown [container]="'body'" [autoClose]="true" [placement]="'bottom-right'">
                  <div class="dropdown dropdown-open">
                    <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopPropagation()"><img src="assets/icons/caretDown.svg" class="ml-1 sortImg"></button>
                    <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                      <li><span class="list-name">All</span><img class="hide"  src="assets/icons/check-blue.svg"></li>                     
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col_ col-6 col">DEFINITION</div>              
            </header>
            <perfect-scrollbar class="table-scroll-perfect">
                <div class="content-body">
                    <div class="col_ col-2">Citi Bank</div>
                    <div class="col_ col-2">Web</div>                   
                    <div class="col_ col-2 review">In-Review</div>
                    <div class="col_ col-6 definatation">If <b>“Search Context.RecentSearches”</b> Contains <b>“Credit”</b> OR <b>“Card”</b> AND <b>“User Context.CustomerType”</b> Starts With <b>“Premium”</b> THEN Filter Results Containing <b>“Card Offers”</b> OR <b>“Card Rewards”</b></div>               
                    <div class="delete-rule-data" (click)="openAddRulesModal()"><img src="assets/icons/edit.svg"></div>
                </div>           
            </perfect-scrollbar>
          </section>       
        </div>
    </div>
   </ng-container>
   <ng-container   *ngIf="selectedTab==='attributes'">
    <div class="table-list-content attributes" *ngIf="attributes && attributes.groups && attributes.groups.length && !loadingContent">
        <div class="kr-sg-data-table with-checkbox">
          <section class="table-content">
            <header class="table-header">
              <div class="col_ col-3">ATTRIBUTE NAME<img src="assets/icons/caretDown.svg" class="ml-1 sortImg"></div>
              <div class="col_ col-5">DEFINITION</div>
              <div class="col_ col-2">TYPE</div>
              <div class="col_ col-2">IS FACET</div>
            </header>
            <perfect-scrollbar class="table-scroll-perfect">
              <ng-container>
                <div class="content-body" *ngFor="let attribute of attributes.groups">
                  <div class="col_ col-3">{{attribute.name}}</div>
                  <div class="col_ col-5"><span class='eachAttr' *ngFor="let value of attribute.attributes; let i = index ">{{value.value + ((index === (attribute.attributes.length-1))?'':',')}} </span></div>  
                  <div class="col_ col-2" >{{attribute.type || 'Systom/Auto'}}</div>  
                  <div class="col_ col-2">{{attribute.isFacet || 'Yes' }}</div>            
                </div>
              </ng-container>
              <div class="divBlockEmptylastChild">No Results found</div>
            </perfect-scrollbar>
          </section>
        </div>
      </div>
   </ng-container>
   <ng-container  *ngIf="selectedTab==='signals'">
  </ng-container>
 </div>

<kr-modal modalType="center" modalClass="addRulesModalComponent" #addRulesModalPop>
    <div class="modal-header">
        <div class="header-title" (click)='closeAddRulesModal()'><img src="assets/images/closeCross.png" class="closeCross"></div>        
    </div>
    <div class="modal-body">
    <div class="col-12 pl-5 pr-0" *ngIf="validationRules && validationRules.rules && validationRules.rules.length">
        <ng-container *ngFor="let simpleRule of validationRules.rules; index as parentIndex">
            <div class="kr-sg-input-text mb-3 rule-name-input">
                <input type="text" placeholder="" class="input-text">
            </div>
            <div class="validation-setting-rules" >
                <ng-container *ngFor="let rule of simpleRule.rules; index as i">
                    <ng-container 
                        *ngTemplateOutlet="ruleContainer; context{$implicit: validationRules,rulesSet:simpleRule,rule:rule,ruleIndex:i,validationMode:'simple'}">
                    </ng-container>
                </ng-container>
            </div>  
        </ng-container>
    </div>
 </div>
 <div class="modal-footer">                               
    <button class="kr-sg-button-primary btn_md" (click)="saveAttributes()" >Ok</button>
    <button class="kr-sg-button-secondary btn_md" data-dismiss="modal" (click)="closeAddAttributesModal()">Cancel</button>
   </div>
</kr-modal>
<kr-modal modalType="center" modalClass="addRulesModalComponent" #addAttributesModalPop>
    <div class="modal-header">
        <div class="header-title" (click)='closeAddAttributesModal()'><img src="assets/images/closeCross.png" class="closeCross"></div>        
    </div>
    <div class="modal-body">
            <div class="kr-sg-input-text mb-15">
              <div class="label-text">Addtribute name</div>
              <input type="text" placeholder="Enter name" class="input-text" [(ngModel)]="addEditattribute.name" required autocomplete="off">             
           </div>
           <div for="tagInput" class="label_text">values</div>
           <mat-form-field class="example-chip-list mb-15" [floatLabel]="'never'">
            <mat-chip-list #chipList aria-label="tag selection">
              <mat-chip *ngFor="let tag of addEditattribute.attributes; let index = index" (removed)="removeAltTag(tag)">
                 <div class="mat-value" *ngIf="tag">{{tag.value}}</div> 
                <mat-icon matChipRemove><img src="assets/images/close.svg"></mat-icon>
              </mat-chip>
              <input placeholder="Type & enter" [(ngModel)]="addEditattribute.newTag" [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" name = "tagInput"  (matChipInputTokenEnd)="addAltTag($event)" id="tagInput" (click)="$event.stopPropagation()">
            </mat-chip-list>
          </mat-form-field> 
           <div class="kr-sg-dropdowns w-100">
            <div class="label-text">Label</div>
            <div class="dropdown dropdown-open">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">{{addEditattribute.type?addEditattribute.type:'Choose'}}</button>                                            
                <ul class="dropdown-menu content-menu">
                  <li (click)="addEditattribute.type='systemAuto'">System/Auto</li>
                  <li (click)="addEditattribute.type='custom'">Custom</li>
                </ul>
             </div>
           </div>
           <div class="kr-sg-dropdowns w-100">
            <div class="label-text">Label</div>
            <div class="dropdown dropdown-open">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">{{addEditattribute.isFacet?addEditattribute.isFacet:'Choose'}}</button>                                            
                <ul class="dropdown-menu content-menu">
                  <li (click)="addEditattribute.isFacet='Yes'">Yes</li>
                  <li (click)="addEditattribute.isFacet='No'">No</li>
                </ul>
              </div>
           </div>
     </div>
   <div class="modal-footer">                               
    <button class="kr-sg-button-primary btn_md" (click)="saveAttributes()" >Ok</button>
    <button class="kr-sg-button-secondary btn_md" data-dismiss="modal" (click)="closeAddAttributesModal()">Cancel</button>
   </div>
</kr-modal>