<div class="main-metrics-container">
    <div class="header-sec row m-0 col-12">
        <app-useronboarding-journey [componentType]='componentType'></app-useronboarding-journey>
        <div class="bread-cum-sec col-3 p-0 d-flex align-items-center">
            <div class="bread-name">{{'metrics.analytics'| translate}}</div>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAMCAYAAABBV8wuAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAClSURBVHgBbU+xDcIwEPQ7ibIGI8AIGQNREJepYAMYAQoUkSC9U9iUFhNkFNgAWoTsByNhKQ5XnPR3uv971khtasQJi8At2X0CeR+b4KlGVSYAq4yehRDi8U14qsRCEtHlBblh/3BEtW2kwrBqaGrJOVz5qA2wu3NuGGi786ZBvRuJrdT9b049nTq9dETlp+4s/HFANc0AjCUoKjG/hVspg3UserwBA09CgWDEywYAAAAASUVORK5CYII=">
            <div class="bread-name active-name">{{'metrics.search_insights.Search_Insights'| translate}}</div>
        </div>
        <div class="d-flex justify-content-end align-items-center col-9 p-0">
            <div class="custom_date_picker_sec">
                <input type="text" class="d-none" readonly ngxDaterangepickerMd style="width: 320px" [timePicker]="true" showCancel="true" [locale]="{format: 'DD/MM/YYYY hh:mm', displayFormat: 'MM/DD/YYYY hh:mm A'}" [(ngModel)]="selected" (datesUpdated)="onDatesUpdated($event)"
                />
                <button type="button" class="ngx-daterangepicker-action invisible custom_date_picker" style="position: absolute; width: 0; height: 0;" (click)="openDateTimePicker($event)" #datetimeTrigger></button>
            </div>
            <!-- <div class="date-info">All conversation sessions between <span class="bold-text">01-08-2020 to 07-08-2020</span></div>                 -->
            <div class="date-select">
                <span class="day time " (click)="getDateRange(1)" [ngClass]="{'selected': defaultSelectedDay === 1}">24 Hrs</span>
                <span class="week time" (click)="getDateRange(7)" [ngClass]="{'selected': defaultSelectedDay === 7}">7 Days</span>
                <span class="custom time" (click)="getDateRange(-1)" [ngClass]="{'selected': defaultSelectedDay === -1}">Custom</span>
            </div>
            <div class="export"><img src="assets/icons/share.svg"></div>
        </div>
    </div>
    <perfect-scrollbar class="scroll_content">
        <div class="data-information-content col-12 m-0 row split-tables">
            <div class="col-12 box-content">
                <div class="row m-0 col-12 p-0 align-items-center">
                    <div class="title-card col-4 p-0">{{'metrics.search_insights.Top_Search_Queries'| translate}}</div>
                    <div class="col-8 d-flex justify-content-end p-0 search-filter-block">
                        <!-- <div class="kr-sg-input-search">                               
                            <input type="text" placeholder="Search" class="input-search" name="searchSources" [(ngModel)]="searchSources">
                            <img src="assets/icons/search_gray.svg" class="search-icon">
                        </div>                        -->
                        <div class="kr-sg-input-search">
                            <input type="text" placeholder="Search" class="input-search" [ngClass]="{'pl-33':!searchSources,'pl-2':searchSources}" autocomplete="off" [(ngModel)]="searchSources" (mouseover)="searchImgSrc = (searchFocusIn ? 'assets/icons/search_gray.svg' :'assets/icons/search_gray_dark.svg')"
                                (mouseout)="searchFocusIn=false;searchImgSrc = 'assets/icons/search_gray.svg'" (focus)="searchFocusIn=true;searchImgSrc = 'assets/icons/search_gray.svg'">
                            <img [src]="searchImgSrc" class="search-icon" *ngIf="!searchSources">
                            <img class="close-icon" *ngIf="searchSources" src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':searchSources}" (click)="searchSources='';">
                        </div>
                    </div>
                </div>
                <!-- <div class="searched-details d-flex">
                    <div class="bulb-icon"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFISURBVHgBlVHRUYNAEL29uwIQUgADFhArMTMh/9iBVABWEFJB8m8c04F2YP6dmBRgJvwLOd8ih5jgjO4Mw7K89+7tO+GMfN+NglT8sQZRMAXHIf7wxuGCyBzel28JCymt5hgP8TiCxKr6qJJitduBlBlD/v5hE5NVYhV+gfRCgmZlWeY8l1oDZNKqrK74mwXObHiT8HEQXd722Mu8KHzqzuQPhBEjnLQ4JZblMW+st6WhZLjZLzeEphA9BXsFcE7tqsFrJlgAmrXUMkabn6wQw82zPeDMakUyQTApJ2tndW/EFOHciL4dGVDcv66R4Ewp2QaklEoNUuY0m+S/ibjHeWPxKwhJ1xZgyAyPTWBa65Sx9VqsAtUMl9qeYgOw1c0B15Vx8iR6ionY6aK2qtWhS7Sl+4gI6I4JtVX04j/ljoOtOwm3v/3/BFVkg8kakxD7AAAAAElFTkSuQmCC"></div>
                    <div class="seach-content">
                        <div class="names"><b>4%</b> of all searches resulted in zero clicks</div>
                        <div class="names"><b>46%</b> of all searches resulted in multiple clicks</div>
                        <div class="names"><b>4%</b> of all searches resulted in zero clicks</div>
                        <div class="names"><b>46%</b> of all searches resulted in multiple clicks</div>
                        <div class="names"><b>48%</b> of all the total searches resulted in almost no clicks</div>
                    </div>
                </div>   -->
                <div class="tab-sec-data">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link" [ngClass]="{'active': querieswithresults }" data-toggle="tab" href="#querieswithresults">{{'metrics.search_insights.Queries_with_results'| translate}}</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" [ngClass]="{'active': !querieswithresults }" data-toggle="tab" href="#querieswithoutresults">{{'metrics.search_insights.Queries_without_results'| translate}}</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div id="querieswithresults" class="tab-pane tab-data-content " [ngClass]="{'active show': querieswithresults }">
                            <div class="table_data_content">
                                <div class="table_header row m-0">
                                    <div class="col-8 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Search_results'| translate}} </div>
                                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Count'| translate}} <span class="info-icon" placement="top-center" ngbTooltip="Number of times the query was searched for by the end-users" [container]="'body'" tooltipClass="dashboard-custom-tooltips" class="pl-1"><img src="assets/icons/Info_gray.svg"></span></div>
                                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.No_of_Clicks'| translate}} <span class="info-icon" placement="top-center" ngbTooltip="Number of times where at least one result of the query was clicked on by the end-users" [container]="'body'" tooltipClass="dashboard-custom-tooltips" class="pl-1"><img src="assets/icons/Info_gray.svg"></span></div>
                                </div>
                                <div class="table_body row m-0" *ngFor="let result of getQueriesWithResults | filter: [ searchSources , 'query']">
                                    <div class="col-8 title">{{result.query}}</div>
                                    <div class="col-2 title">{{result.searches}}</div>
                                    <div class="col-2 title d-flex align-items-center justify-content-between">
                                        <span class="count">{{result.clicks}}</span>
                                        <div class="view-query" (click)="openModalPopup(result)">
                                            <img src="assets/icons/view-query.svg">
                                            <span>View Results</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf='QWR_totalRecord && QWR_totalRecord>10' style="margin : 15px"><app-record-pagination [totalRecord]='QWR_totalRecord' [limitpage]='QWR_limitPage' (pageChanged)="paginate($event,'QWR')"></app-record-pagination></div>
                        </div>
                        <div id="querieswithoutresults" class="tab-pane fade tab-data-content" [ngClass]="{'active show': !querieswithresults }">
                            <div class="table_data_content">
                                <div class="table_header row m-0">
                                    <div class="col-10 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Search_results'| translate}}</div>
                                    <!-- <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">Appearances <span class="info-icon" placement="top-center" ngbTooltip="Use key board shortcuts" [container]='"body"' tooltipClass="metrics_tooltips m-0"><img src="assets/icons/Info_gray.svg"></span></div> -->
                                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Count'| translate}} <span class="info-icon" placement="top-center" ngbTooltip="Number of times the query was searched for by the end-users" [container]="'body'" tooltipClass="dashboard-custom-tooltips" class="pl-1"><img src="assets/icons/Info_gray.svg"></span></div>
                                </div>
                                <div class="table_body row m-0" *ngFor="let result of topQuriesWithNoResults | filter: [ searchSources , 'query']">
                                    <div class="col-10 title">{{result.query}}</div>
                                    <!-- <div class="col-2 title">1000</div>  -->
                                    <div class="col-2 title">
                                        <span class="count">{{result.count}}</span>
                                        <!-- <div class="view-query">
                                            <img src="assets/icons/view-query.svg">    
                                            <span>View Results</span>
                                        </div> -->
                                    </div>
                                </div>

                            </div>
                            <!-- <span *ngIf='topQuriesWithNoResults.length===0'>No results found</span> -->
                            <div *ngIf='QWNR_totalRecord && QWNR_totalRecord>10' style="margin : 15px"><app-record-pagination [totalRecord]='QWNR_totalRecord' [limitpage]='QWNR_limitPage' (pageChanged)="paginate($event,'QWNR')"></app-record-pagination></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </perfect-scrollbar>
</div>


<kr-modal modalType="center" #viewQueries modalClass="modal_popups_ view-query-modal">
    <div class="modal-header">
        <div>
            <div class="small-title">{{'metrics.search_insights.Search_Results_for'| translate}}</div>
            <div class="title-small">{{selectedQuery}}</div>
            <!-- <div class="response">FAQ Response</div> -->
        </div>
        <div class="close_icon" (click)="closeModalPopup()"><img src="assets/icons/modal-close.svg"></div>
    </div>
    <perfect-scrollbar class="perfect-scroll-modal-body">
        <div class="modal-body">
            <div class="table_data_content">
                <div class="table_header row m-0">
                    <div class="col-4 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Search_Results'| translate}}</div>
                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Appearances'| translate}}</div>
                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.No_of_Clicks'| translate}}</div>
                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1">{{'metrics.search_insights.Click-Through_Rate'| translate}}</div>
                    <div class="col-2 title"><img src="assets/icons/sort_up_down.svg" class="mr-1"><span>{{'metrics.search_insights.Avg_Position'| translate}}</span></div>
                    <!-- <div class="col-1 title d-flex align-items-start"><img src="assets/icons/sort_up_down.svg" class="mr-1"><span>{{'metrics.search_insights.Positive_Feedback'| translate}}</span></div>
                    <div class="col-1 title d-flex align-items-start"><img src="assets/icons/sort_up_down.svg" class="mr-1"><span>{{'metrics.search_insights.Negative_Feedback'| translate}}</span></div> -->
                </div>
                <div class="table_body row m-0" *ngFor="let result of getSearchQueriesResults;let i = index">
                    <div class="col-4 title d-flex align-items-center">
                        <span class="img-sec"><img src="assets/icons/question-box.svg"></span>
                        <span class="results ">{{result.answer}}</span>
                    </div>
                    <div class="col-2 title pl-3">{{result.appearances}}</div>
                    <div class="col-2 title pl-3">{{result.clicks}}</div>
                    <div class="col-2 title pl-3">{{result.clickThroughRate}} %</div>
                    <div class="col-2 title pl-3">{{result.avgPosition}}</div>
                    <!-- <div class="col-1 title">{{result.positiveFeedback}}</div>
                    <div class="col-1 title">{{result.negativeFeedback}}</div> -->
                </div>
            </div>
            <div *ngIf='SQR_totalRecord && (SQR_limitPage < SQR_totalRecord)' style="margin : 15px"><app-record-pagination [totalRecord]='SQR_totalRecord' [limitpage]='SQR_limitPage' (pageChanged)="paginate($event,'SQR')"></app-record-pagination></div>
        </div>
    </perfect-scrollbar>
    <!-- <div class="modal-footer">
      <button class="kr-sg-button-primary btn_lg">Proceed</button>
      <button class="kr-sg-button-secondary btn_lg">Back</button>
  </div> -->
</kr-modal>