<div class="business-rules-wrapper">
    <div class="header-sec col-12 row m-0">
        <div class="col-4 lef-sec p-0"
            *ngIf="!(selcectionObj && selcectionObj.selectedItems && selcectionObj.selectedCount)">
            <app-useronboarding-journey [componentType]='componentType'></app-useronboarding-journey>
            <span class="title">Business Rules</span>
        </div>
        <div class="col-4 lef-sec p-0"
            *ngIf="selcectionObj && selcectionObj.selectedItems && selcectionObj.selectedCount">
            <div class="selected-count" *ngIf="!selcectionObj.selectAll">
                <span class="mr-1">
                    <img (click)="selectAllFromPartial()" src="assets/icons/resultranking/selected-checkbox.svg"
                        class="search-icon">
                </span>
                <span class="pl-3">{{ selcectionObj.selectedCount }} {{ (selcectionObj.selectedCount
                    >1?"businessRules.rules_selected":"businessRules.rule_selected") | translate }}</span>
            </div>
            <div class="kr-sg-checkbox m-0" *ngIf="selcectionObj.selectAll">
                <input id="checkbox-1" class="checkbox-custom" type="checkbox" [(ngModel)]="selcectionObj.selectAll"
                    (change)="selectAll()" />
                <label for="checkbox-1" class="checkbox-custom-label"></label>
                <span class="allselected">{{ selcectionObj.selectedCount }} {{ (selcectionObj.selectedCount
                    >1?"businessRules.rules_selected":"businessRules.rule_selected") | translate }}</span>
            </div>
        </div>
        <div class="col-8 right-sec p-0" *ngIf="!(selcectionObj && selcectionObj.selectedItems && selcectionObj.selectedCount)">
            <div class="clock"><img src="assets/icons/clock.svg" /></div>
        </div>
    </div>
    <div class="header-tabs-rules col-12 row m-0">
        <div class="left-tabs col-4 p-0">
            <div class="tab-name-text" [ngClass]="{'active-tab-rule':selectedTab==='Contextual'}" (click)="selectedTab='Contextual'"><span>Contextual Rules</span></div>
            <i class="si-help info-icon"></i>
            <div class="tab-name-text" [ngClass]="{'active-tab-rule':selectedTab==='NLP'}" (click)="selectedTab='NLP'"><span>NLP Rules</span></div>
        </div>
        <div class="right-contnet col-8 p-0 justify-content-end">
            <div class="kr-sg-input-search">
                <input type="text" placeholder="Search" maxlength="60" id="inputSearch" class="input-search"
                    (keyup)="searchByRule()" [ngClass]="{'pl-33':!searchRules,'pl-2':searchRules}" autocomplete="off"
                    [(ngModel)]="searchRules" (keyup)="filterRules(searchRules,'search')"
                    (mouseover)="searchImgSrc = (searchFocusIn ? 'assets/icons/search_gray.svg' :'assets/icons/search_gray_dark.svg')"
                    (mouseout)="searchFocusIn=false;searchImgSrc = 'assets/icons/search_gray.svg'"
                    (focus)="searchFocusIn=true;searchImgSrc = 'assets/icons/search_gray.svg'">
                <img [src]="searchImgSrc" class="search-icon" *ngIf="!searchRules">
                <img class="close-icon" src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':searchRules}"
                    (mouseover)="activeClose=true" (mouseout)="activeClose=false" (click)="focusoutSearch()">
            </div>
            <ng-container>
                <div class="add-rule-text" (click)="createNewRule()">
                    <i class="si-add-plus"></i>
                    <span>Add {{selectedTab}} Rule</span>
                </div>
            </ng-container>
            <div class="ml-3 pl-1" *ngIf="selcectionObj && selcectionObj.selectedItems && selcectionObj.selectedCount">
                <button class="kr-sg-button-danger btn_lg" (click)="deleteMultiePop()"><i class="si-delete1 mr-2"></i>
                    {{ "businessRules.delete" | translate }}</button>
            </div>
        </div>

    </div>

    <div class="mainLoadingSpinner" *ngIf="loadingContent">
        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
        <span class="please-wait-message">Please Wait!</span>
    </div>

    <!-- Table default header -->
    <div class="table_section">
        <div class="header_sec row m-0">
            <div class="col-3 content withcheckbox " (click)="sortByApi('ruleName')">
                <!-- <div class="kr-sg-checkbox p-0 m-0">
                    <input id="selectAllRules" class="checkbox-custom" type="checkbox" (change)="selectAll()" [(ngModel)]="selcectionObj.selectAll" />
                    <label for="selectAllRules" class="checkbox-custom-label"></label>
                </div>-->
                <div class=" d-flex align-items-center title cursor-pointer">
                    <span class="d-flex align-items-center flex-column mr-1">
                        <img [ngClass]="getSortIconVisibility('ruleName', 'down')" src="assets/icons/caretDown.svg"
                            class="sortImg downArrow">
                        <img [ngClass]="getSortIconVisibility('ruleName', 'up')" src="assets/icons/caretDown.svg"
                            class="sortImg upArrow">
                    </span>
                    <!-- <img  src="assets/icons/sort_up_down.svg" class="pr-1" />
                    <img   src="assets/icons/caretDown.svg" class="pr-1" /> -->
                    {{ "name_caps" | translate }}
                </div>
            </div>
            <div class="col-3 content">{{ "businessRules.condition_caps" | translate }}</div>
            <div class="col-3 content">{{ "businessRules.outcome_caps" | translate }}</div>
            <div class="col-3 content cursor-pointer d-flex align-items-center" (click)="sortByApi('isRuleActive')">
                <span class="d-flex align-items-center flex-column mr-1">
                    <img [ngClass]="getSortIconVisibility('isRuleActive', 'down')" src="assets/icons/caretDown.svg"
                        class="sortImg downArrow">
                    <img [ngClass]="getSortIconVisibility('isRuleActive', 'up')" src="assets/icons/caretDown.svg"
                        class="sortImg upArrow">
                </span>
                {{ "businessRules.status_caps" | translate }}
                <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #isRuleActiveFilter="ngbDropdown" ngbDropdown
                    [container]="'body'" [autoClose]="true" [placement]="'bottom-right'">
                    <div class="dropdown dropdown-open">
                        <button class="dropdown-toggle dropdown-input" ngbDropdownToggle
                            (click)="$event.stopImmediatePropagation()">
                            <img class="custom-dropdown-toggle-icon" src="assets/icons/type-select-dropdown.svg">
                        </button>
                        <ul class="dropdown-menu content-menu type_sort_dropdown-content p-0" ngbDropdownMenu>
                            <li (click)="isRuleActiveFilter.close();filterTable('all','isRuleActive')">
                                <span class="list-name">All</span>
                                <img [ngClass]="{'hide': filterSystem.isRuleActiveFilter !== 'all'}"
                                    src="assets/icons/check-blue.svg">
                            </li>
                            <li *ngFor="let docType of isRuleActiveArr"
                                (click)="isRuleActiveFilter.close();filterTable(docType,'isRuleActive')">
                                <span class="list-name">{{docType == false ? 'Inactive' :(docType == true?
                                    'Active':'')}}</span>
                                <img [ngClass]="{'hide': filterSystem.isRuleActiveFilter !== docType}"
                                    src="assets/icons/check-blue.svg">
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty Page -->
    <ng-container
        *ngIf="loadingContent1 && !(rules && beforeFilterRules && beforeFilterRules.length) && !searchRules && !showSearch">
        <!-- <perfect-scrollbar class="empty-scroll">
            <div class="empty-landing-screen">
                <div class="img-block" *ngIf="!emptyItems">
                    <img class="action_icon" (load)="imageLoad()" src="assets/images/businessrules-empty.png">
                </div>
                <ng-container *ngIf="loadImageText">
                    <div class="empty-title">You haven't added any rules yet!</div>
                    <div class="desc-text">Rule is powerful tool to personalize and fine-tune search results. SearchAssist allows you to define rules based on Search , Page and User-contexts. Rules can also be used for merchandising and promotions.</div>
                    <div class="kr-sg-dropdowns" ngbDropdown [container]="'body'">
                        <button class="kr-sg-button-primary btn_lg px-3" (click)="createNewRule()">Add Rules</button>
                    </div>
                </ng-container>
                <ng-container *ngIf="noItems && emptySearchResults">
                    <div class="desc-text">Your Search Query doesn't match with any record.</div>
                </ng-container>
            </div>
        </perfect-scrollbar> -->
        <perfect-scrollbar class="empty-scroll">
            <div class="rules-empty-data" *ngIf="selectedTab==='Contextual'">
                <div class="img-block">
                    <img src="assets/icons/businessrules/b-rules-empty.svg">
                </div>
                <div class="empty-title">No Contextual Rules Found</div>
                <div>
                    <button class="kr-sg-button-primary btn_lg" (click)="createNewRule()"><i
                            class="si-add-plus mr-2"></i>Add Contextual Rule</button>
                </div>
                <div class="info-data-box">
                    <div class="text-info-empty">Contextual Rules allows you to define outcomes based on various
                        conditions set by you on search context or Page context or the User context.<br/>These rules are can
                        help achieve personalization of search results for your end users</div>
                    <div class="text-info-empty">Not sure what are contextual rules? Visit our <a href="#">Support <i
                                class="si-external-horizantal"></i></a></div>
                </div>
            </div>
            <div class="rules-empty-data" *ngIf="selectedTab==='NLP'">
                <div class="img-block">
                    <img src="assets/icons/businessrules/b-rules-empty.svg">
                </div>
                <div class="empty-title">No NLP Rules Found</div>
                <div>
                    <button class="kr-sg-button-primary btn_lg" (click)="createNewRule()"><i
                            class="si-add-plus mr-2"></i>Add NLP Rule</button>
                </div>
                <div class="info-data-box">
                    <div class="text-info-empty">Try adding NLP rules to find what you are looking for.</div>
                    <div class="text-info-empty">Not sure what are NLP rules? Visit our <a href="#">Support <i
                                class="si-external-horizantal"></i></a></div>
                </div>
            </div>
        </perfect-scrollbar>
    </ng-container>


    <!-- For business rules table -->

    <div class="table_section"
        *ngIf="(!loadingContent && rules && beforeFilterRules && beforeFilterRules.length) || searchRules || showSearch">
        <perfect-scrollbar class="scroll_table">
            <!-- <div class="body_sec row m-0" *ngFor="let ruleObj of rules | filter: [searchRules, 'ruleName']" [ngClass]="{ -->
            <div class="body_sec row m-0" *ngFor="let ruleObj of rules"
                [ngClass]="{'selected':selcectionObj && selcectionObj.selectedItems && selcectionObj.selectedItems[ruleObj._id]}">
                <div class="col-3 content withcheckbox align-items-start">
                    <div class="kr-sg-checkbox p-0 m-0">
                        <input id="{{ ruleObj._id }}" class="checkbox-custom selectRuleCheckBoxDiv" type="checkbox"
                            (change)="checkUncheckfacets(ruleObj)" />
                        <label for="{{ ruleObj._id }}" class="checkbox-custom-label"></label>
                    </div>
                    <div class="title text-truncate" [tooltipClass]="'whiteTooltip'" container="body"
                        ngbTooltip="{{ ruleObj.ruleName }}">{{ ruleObj.ruleName }}</div>
                </div>
                <div class="col-3 content">
                    <ng-container *ngFor="let rule of ruleObj.rules; let ruleIndex = index">
                        <!-- <br *ngIf="ruleIndex > 0"> -->
                        <div class="d-flex align-items-center flex-wrap">
                            <span class="divider" *ngIf="ruleIndex > 0">{{"and_caps" | translate}}</span>
                            <span class="tags-input mr-1 mb-1 contextCategory">
                                <span class="small-text">{{ "businessRules." + rule.contextType | translate}} :</span>
                                <span container="body"
                                    ngbTooltip='{{ "businessRules." + rule.contextCategory | translate }}'>{{rule.contextType!=='userContext'
                                    ? ("businessRules." + rule.contextCategory | translate):rule.contextCategory
                                    }}</span>
                            </span>
                        </div>
                        <div class="d-flex align-items-start mb-2">
                            <div class="d-inline-block">
                                <span class="outer-name mr-1 mb-1 ml-4 d-inline-block"
                                    [ngClass]="{'ml-4':ruleIndex > 0}">{{ rule.operator | titlecase}}</span>
                            </div>
                            <div class="d-flex align-items-start flex-wrap">
                                <ng-container *ngFor="let value of rule.value; let valueIndex = index">
                                    <span class="tags-input mr-1 mb-1" *ngIf="value && !checkIsArray(value)"
                                        container="body"
                                        ngbTooltip="{{rule.dataType == 'date' ? (value | dateFormatPipe: 'DD MMM YYYY'):value}}">{{rule.dataType
                                        == 'date' ? (value | dateFormatPipe: 'DD MMM YYYY'):value}}</span>
                                    <span class="tags-input mr-1 mb-1"
                                        *ngIf="value && value.length && checkIsArray(value)">
                                        <span *ngFor="let num of value; let numIndex = index" container="body"
                                            ngbTooltip="{{rule.dataType == 'date' ? (num | dateFormatPipe: 'DD MMM YYYY'):num}}">{{rule.dataType
                                            == 'date' ? (num | dateFormatPipe: 'DD MMM YYYY'):num}}
                                            <span *ngIf="!numIndex"> - </span>
                                        </span>
                                    </span>
                                    <span class="divider" *ngIf="valueIndex < rule.value.length - 1">{{ "or_caps" |
                                        translate}}</span>
                                </ng-container>
                            </div>
                        </div>
                    </ng-container>
                </div>
                <div class="col-3 content">
                    <ng-container *ngFor="let outcome of ruleObj.outcomes">
                        <div>
                            <span class="tags-input mr-1 mb-1">
                                <span
                                    *ngIf=" outcome.outcomeType === 'boost' ||  outcome.outcomeType === 'lower'">{{outcome.scale
                                    }}x</span>
                                {{"businessRules.action" + outcome.outcomeType | translate}}Result
                            </span>
                        </div>
                        <div class="d-inline-flex align-items-start">
                            <span class="outer-name mr-1 mb-1">{{"businessRules." + outcome.outcomeOperator |
                                translate}}</span>
                            <span class="tags-input mr-1 mb-1 outcome-tags-input">{{ outcome.fieldName }}:
                                <span *ngFor="let value of outcome.outcomeValue;let valueIndex = index" container="body"
                                    ngbTooltip="{{value}}">{{ value }}
                                    <span *ngIf="valueIndex < outcome.outcomeValue.length - 1"
                                        class="divider ">{{"or_caps" | translate }}</span>
                                </span>
                            </span>
                        </div>
                        <img class="pl-1 d-inline-flex"
                            *ngIf="outcome.showFieldWarning && outcome.showFieldWarning !== 'false'"
                            src="assets/icons/info-blue.svg" container="body"
                            ngbTooltip="{{fieldWarnings[outcome.showFieldWarning] || outcome.showFieldWarning}}"
                            tooltipClass="{{modifyFieldWarningMsg(outcome.showFieldWarning)?'my-custom-warning-class':'text-left-warning'}}" />
                    </ng-container>
                </div>
                <div class="col-3 content actions">
                    <div class="toggle_switch d-flex align-items-center">
                        <label class="kr-sg-toggle">
                            <input type="checkbox" checked [(ngModel)]="ruleObj.isRuleActive"
                                (click)="updateRuleStatus(ruleObj,$event)">
                            <div class="slider"></div>
                        </label>
                        <span class="active-status ml-2" *ngIf="ruleObj.isRuleActive"><span
                                class="indication"></span>{{"businessRules.active" | translate }}</span>
                        <span class="in-active-status ml-2" *ngIf="!ruleObj.isRuleActive"><span
                                class="indication"></span>{{"businessRules.In-Active" | translate }}</span>
                    </div>
                    <!-- <div class="actions-icons">
                        <img src="assets/images/edit-pencil.svg" (click)="editRule(ruleObj)" ngbTooltip='Edit' [container]="'body'" />
                        <img src="assets/icons/delete-table.svg" (click)="deleteRulePop(ruleObj, ruleIndex)" ngbTooltip='Delete' [container]="'body'" />
                    </div> -->
                    <div class="actions-icons">
                        <span class="edit-icon" (click)="editRule(ruleObj)" ngbTooltip='Edit' [container]="'body'"
                            tooltipClass="tooltip-global-" placement="top-center">
                            <i class="si-pencil-edit"></i>
                        </span>
                        <span class="delete-icon" (click)="deleteRulePop(ruleObj, ruleIndex)" ngbTooltip='Delete'
                            [container]="'body'" tooltipClass="tooltip-global-" placement="top-center">
                            <i class="si-delete1"></i>
                        </span>
                    </div>
                </div>
            </div>
            <div class="divBlockEmptylastChild text-center">
                <div class="desc">No search results found</div>
            </div>
            <app-record-pagination *ngIf="totalRecord && totalRecord>10" [totalRecord]='totalRecord' [limitpage]='10'
                (pageChanged)="paginate($event)"></app-record-pagination>
        </perfect-scrollbar>
        <div class="empty-rules" *ngIf="!loadingContent && !(rules && beforeFilterRules && beforeFilterRules.length)">
            <img src="assets/images/icons/empty_ill.svg" />
            <div class="heading">No Rules Available</div>
            <div class="desc">Please add rules</div>
        </div>
    </div>
</div>

<kr-modal modalType="center" #addBusinessRules modalClass="modal_popups_ business-rules-popup">
    <div class="modal-header">
        <div class="title font-weight-bold">{{ (addEditRuleObj._id ?"businessRules.edit_rule" :"businessRules.add_rule")
            | translate }}</div>
        <label class="kr-sg-toggle toggle-switch">
            <input type="checkbox" [(ngModel)]="addEditRuleObj.isRuleActive" />
            <div class="slider">
                <span class="enabled">{{"businessRules.rule_active" | translate}}</span>
                <span class="disabled">{{"businessRules.rule_in_active" | translate}}</span>
            </div>
        </label>
        <div class="close_icon" (click)="closeModalPopup()">
            <img src="assets/icons/modal-close.svg" />
        </div>
    </div>
    <!-- <perfect-scrollbar class="perfect-scroll-modal-body" #perfectScroll>
        
    </perfect-scrollbar> -->
    <div class="modal-body">
        <div class="col-6 rule-name-input">
            <div class="kr-sg-input-text">
                <div class="label-text">{{ "businessRules.rule_name" | translate }}</div>
                <input type="text" placeholder="Rule Name" class="input-text" maxlength="60" [(ngModel)]="addEditRuleObj.ruleName" [ngClass]="{'err-block' : (!addEditRuleObj.ruleName.length && submitted)}">
            </div>
        </div>
        <div class="rules-contexual-data row col-12 m-0 p-0">
            <div class="condition-rules col-6">
                <div class="inner-data-wrapper">
                    <div class="info-rule-contnet">
                        <div class="title-data">
                            <img src="assets/icons/business-rules/ifcondition.svg">
                            <div class="text-title">{{ "businessRules.condition" | translate }}</div>
                            <span class="info-tooltip-data">
                                <i class="si-help"></i>
                                <div class="conditon-info-tooltip">
                                    <div class="left-data-info">
                                        <div class="info-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Auctor posuere amet malesuada in. Et nullam.</div>
                                        <div class="info-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Auctor posuere amet malesuada in. Et nullam.</div>
                                    </div>
                                    <div class="img-data">
                                        <img src="assets/icons/business-rules/conditions.png">
                                    </div>
                                    <div class="right-data-info">
                                        <div class="info-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Auctor posuere amet malesuada in. Et nullam.</div>
                                        <div class="info-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Auctor posuere amet malesuada in. Et nullam.</div>
                                    </div>
                                </div>
                            </span>
                        </div>
                        <div class="sub-text text-truncate">The context of this section as to when the trigger takes
                            place.</div>
                    </div>
                    <div class="conditions-sec-data" *ngIf="false">
                        <perfect-scrollbar class="scoll-data">
                            <div class="inner-data-content">
                                <!-- Repeat the data here conditions -->
                                <ng-container *ngFor="let ruleObj of rulesArrayforAddEdit; let ruleIndex = index;">
                                    <div class="box-data-conditions">
                                        <div class="close-conditions" (click)="removeRule(ruleIndex)">
                                            <i class="si-close"></i>
                                        </div>
                                        <div class="row-input-data row col-12">
                                            <div class="col-12 column-sec title-info">Select Context</div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown
                                                    [placement]="'bottom-right'">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" ngbDropdownToggle (click)="currentEditInex = null">{{"businessRules." +ruleObj.contextType | translate}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200" *ngFor="let contextType of ruleOptions?.contextTypes">
                                                                    <li class="p-0" ngbDropdownItem (click)="ruleSelection(ruleObj, contextType, 'contextType')">
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':ruleObj.contextType===contextType}">{{"businessRules." + contextType | translate}}</a>
                                                                    </li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row-input-data row col-12">
                                            <div class="col-12 title-info">Set Parameters</div>
                                            <div class="col-4 column-sec" *ngIf="ruleObj.contextType !=='userContext'">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown [placement]="'bottom-right'">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" ngbDropdownToggle>{{"businessRules." + ruleObj.contextCategory | translate}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200" *ngFor=" let contextCategory of ruleOptions[ruleObj.contextType]">
                                                                    <li class="p-0" ngbDropdownItem (click)="ruleSelection(ruleObj,contextCategory,'contextCategory')">
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':ruleObj.contextCategory===contextCategory}">{{"businessRules." + contextCategory | translate}}</a>
                                                                    </li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-4 column-sec" *ngIf="ruleObj.contextType ==='userContext'">
                                                <div class="kr-sg-input-text">
                                                    <input type="text" class="input-text" [(ngModel)]="ruleObj.contextCategory">
                                                </div>
                                            </div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown
                                                    [placement]="'bottom-right'">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input"
                                                            data-toggle="dropdown" ngbDropdownToggle>{{((ruleObj.dataType)?("businessRules." +ruleObj.dataType): 'choose_an_option') | translate}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200" *ngFor="let dataType of ruleOptions.dataTypes">
                                                                    <li class="p-0" ngbDropdownItem [hidden]="(dataType == 'date' || dataType == 'number') && ruleObj.contextType =='searchContext'" (click)="ruleSelection(ruleObj,dataType,'dataType')">
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':ruleObj.dataType===dataType}"> {{"businessRules." + dataType | translate}}</a>
                                                                    </li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown
                                                    [placement]="'bottom-right'">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input"
                                                            data-toggle="dropdown" ngbDropdownToggle>{{((ruleObj.operator)?("businessRules." +ruleObj.operator):'choose_an_option') | translate}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add"
                                                            ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                             <ng-container *ngIf="ruleObj.dataType && conditions[ruleObj.dataType]">
                                                                <div class="scroll-max-200" *ngFor="let operator of conditions[ruleObj.dataType]">
                                                                    <li class="p-0" ngbDropdownItem (click)="ruleSelection(ruleObj,operator,'operator')">
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':ruleObj.operator===operator}">{{"businessRules." + operator | translate}}</a>
                                                                    </li>
                                                                </div>
                                                             </ng-container>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row-input-data row col-12">
                                            <div class="col-12 column-sec">
                                                <div class="kr-sg-input-text">
                                                    <mat-form-field class="example-chip-list"
                                                    [ngClass]="{'date-chip': ruleObj.dataType == 'date'}">
                                                    <mat-chip-list #chipList [attr.aria-label]="'tag selection'"
                                                        class="date-range-picker-right-d-none">

                                                        <ng-container
                                                            *ngIf="ruleObj.value && ruleObj.value.length && (ruleObj.dataType !== 'date') && (ruleObj.dataType !== 'number')">
                                                            <ng-container
                                                                *ngFor="let value of ruleObj.value; let index = index">
                                                                <mat-chip [selectable]="selectable"
                                                                    (removed)="removeTag(ruleObj.value, tag,index)"
                                                                    [ngClass]="{'firstChip':index==0}">
                                                                    <span class="mat-val" container="body"
                                                                        ngbTooltip="{{value}}"
                                                                        *ngIf="value">{{value}}</span>
                                                                    <mat-icon matChipRemove><img
                                                                            src="assets/images/close.svg" /></mat-icon>
                                                                </mat-chip>
                                                                <span>OR</span>
                                                            </ng-container>
                                                        </ng-container>
                                                        <ng-container
                                                            *ngIf="ruleObj.value && ruleObj.value.length && (ruleObj.dataType === 'number')">
                                                            <ng-container
                                                                *ngFor="let value of ruleObj.value; let index = index">
                                                                <mat-chip [selectable]="selectable"
                                                                    (removed)="removeTag(ruleObj.value, tag,index)"
                                                                    [ngClass]="{'firstChip':index==0}">
                                                                    <span class="mat-val"
                                                                        *ngIf="value && value.length && checkIsArray(value)">
                                                                        <span
                                                                            *ngFor="let num of value; let numIndex = index"
                                                                            container="body"
                                                                            ngbTooltip="{{num}}">{{num}}<span
                                                                                *ngIf="!numIndex"> - </span></span>
                                                                    </span>
                                                                    <span class="mat-val"
                                                                        *ngIf="value && !checkIsArray(value)">
                                                                        <span>{{value}}</span>
                                                                    </span>
                                                                    <mat-icon matChipRemove><img
                                                                            src="assets/images/close.svg" /></mat-icon>
                                                                </mat-chip>
                                                                <span>OR</span>
                                                            </ng-container>
                                                        </ng-container>
                                                        <!-- <ng-container *ngIf="ruleObj.value && ruleObj.value.length && (ruleObj.dataType === 'date') && (ruleObj.operator !== 'between')">
                                                        <ng-container *ngFor="let value of ruleObj.value; let index = index">
                                                            <mat-chip [selectable]="selectable" (removed)="removeTag(ruleObj.value, tag,index)">
                                                                <span class="mat-val" *ngIf="value">{{value | dateFormatPipe: 'DD MMM YYYY'}}</span>
                                                                <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                                                            </mat-chip>
                                                            <span>OR</span>
                                                        </ng-container>
                                                    </ng-container>
                                                    <ng-container *ngIf="ruleObj.value && ruleObj.value.length && (ruleObj.dataType === 'date') && (ruleObj.operator === 'between')">
                                                        <ng-container *ngFor="let value of ruleObj.value; let index = index">
                                                            <mat-chip [selectable]="selectable" (removed)="removeTag(ruleObj.value, tag,index)">
                                                                <span class="mat-val" *ngIf="value && value.length">
                                <span *ngFor="let date of value; let dateIndex = index">
                                  {{date | dateFormatPipe: 'DD MMM YYYY'}} <span *ngIf="!dateIndex"> - </span>
                                                                </span>
                                                                </span>
                                                                <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                                                            </mat-chip>
                                                            <span>OR</span>
                                                        </ng-container>
                                                    </ng-container> -->
                                                        <ng-container
                                                            *ngIf="ruleObj.value && ruleObj.value.length && (ruleObj.dataType === 'date')">
                                                            <ng-container
                                                                *ngFor="let value of ruleObj.value; let index = index">
                                                                <mat-chip [selectable]="selectable"
                                                                    (removed)="removeTag(ruleObj.value, tag,index)"
                                                                    [ngClass]="{'firstChip':index==0}">
                                                                    <span class="mat-val"
                                                                        *ngIf="value && value.length && checkIsArray(value)">
                                                                        <span
                                                                            *ngFor="let date of value; let dateIndex = index"
                                                                            container="body"
                                                                            ngbTooltip="{{date | dateFormatPipe: 'DD MMM YYYY'}}">
                                                                            {{date | dateFormatPipe: 'DD MMM YYYY'}}
                                                                            <span *ngIf="!dateIndex"> - </span>
                                                                        </span>
                                                                    </span>
                                                                    <span class="mat-val"
                                                                        *ngIf="value  && !checkIsArray(value)"
                                                                        container="body"
                                                                        ngbTooltip="{{value | dateFormatPipe: 'DD MMM YYYY'}}">{{value
                                                                        | dateFormatPipe: 'DD MMM
                                                                        YYYY'}}</span>
                                                                    <mat-icon matChipRemove><img
                                                                            src="assets/images/close.svg" /></mat-icon>
                                                                </mat-chip>
                                                                <span>OR</span>
                                                            </ng-container>
                                                        </ng-container>
                                                        <ng-container
                                                            *ngIf="(ruleObj.dataType != 'date') && (ruleObj.dataType != 'number')">
                                                            <input
                                                            id="ConditionInput"
                                                             placeholder="Type Keyword and Enter"
                                                                [matChipInputFor]="chipList"
                                                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                                (matChipInputTokenEnd)="addRules($event, ruleObj, i)"
                                                                suggestedInput />
                                                                <img *ngIf="iconImageCon && submitted" id="infoWarningCon" src="assets/icons/warning_escalation.svg" style="top: 35%; position: absolute; right: 3%; display: block;" height="12" width="12" />
                                                        </ng-container>

                                                        <ng-container *ngIf="ruleObj.dataType == 'date'">
                                                            <ng-container *ngIf="ruleObj.operator === 'between'">
                                                                <span class="select_data_placeholder w-120 py-1"
                                                                    (click)="openDateTimePicker(ruleObj,ruleIndex)">Select
                                                                    Range </span>
                                                                <input class="dateRangePicker d-none"
                                                                    id="rangePicker_{{ruleIndex}}" ngxDaterangepickerMd
                                                                    #dateRangePicker placeholder="Select range"
                                                                    showCancel="true"
                                                                    [locale]="{format: 'DD/MM/YYYY hh:mm', displayFormat: 'DD MMM YYYY'}"
                                                                    [(ngModel)]="ruleObj.dateValue"
                                                                    (datesUpdated)="onDatesUpdated($event,ruleObj)" />
                                                            </ng-container>
                                                            <ng-container *ngIf="ruleObj.operator !== 'between'">
                                                                <span (click)="openDateTimePicker(ruleObj,ruleIndex)"
                                                                    class="select_data_placeholder py-1">Select
                                                                    Date</span>
                                                                <input class="singleDatePicker d-none"
                                                                    id="datePicker_{{ruleIndex}}"
                                                                    [singleDatePicker]="true" ngxDaterangepickerMd
                                                                    #datePicker *ngIf="ruleObj.operator !== 'between'"
                                                                    placeholder="Select Date" showCancel="false"
                                                                    [locale]="{format: 'DD/MM/YYYY hh:mm', displayFormat: 'DD MMM YYYY'}"
                                                                    [(ngModel)]="ruleObj.dateValue"
                                                                    (datesUpdated)="onDatesUpdated($event,ruleObj)" />
                                                            </ng-container>
                                                        </ng-container>

                                                        <ng-container *ngIf="ruleObj.dataType == 'number'">
                                                            <input
                                                                [placeholder]="ruleObj.operator == 'between' ? 'Type Range' : 'Type Keyword and Enter'"
                                                                [matChipInputFor]="chipList"
                                                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                                (matChipInputTokenEnd)="addRules($event, ruleObj, i)" />
                                                        </ng-container>
                                                    </mat-chip-list>
                                                </mat-form-field>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="and-condition" *ngIf="rulesArrayforAddEdit && rulesArrayforAddEdit.length-1 !==ruleIndex">AND</div>
                                </ng-container>
                                <ng-container *ngIf="!rulesArrayforAddEdit.length">
                                    <div class="row m-0 col-12 info-warning-container">
                                        <div class="col-10 pl-0 w-text"><img
                                                src="assets/icons/business-rules/warning-info.svg">Defining a rule without
                                            condition can have unexpected impact on search relevance.</div>
                                        <div class="know-more col-2 pl-0 text-right">Know More</div>
                                    </div>
                                </ng-container>
                                <!-- End repeat -->
                                <div class="add-condition-btn" (click)="addNewRule()">
                                    <i class="si-add-plus"></i>
                                    <span>Add Condition</span>
                                </div>
                            </div>
                        </perfect-scrollbar>
                    </div>
                    <div class="nlp-annotator">
                        <perfect-scrollbar class="scoll-data">
                        <!-- nlp annotator text area start -->
                        <div class="nlp-annotator_form">
                            <div class="kr-sg-input-text-area">
                                <!-- <div class="label-text">NLP Annotator </div> -->
                                <div class="title-data">
                                    <div class="text-title">NLP Annotator</div>
                                    <span class="info-tooltip-data">
                                        <i class="si-help"></i>
                                        <div class="conditon-info-tooltip">
                                            <div class="img-data">
                                                <img src="assets/icons/business-rules/conditions.png">
                                            </div>
                                        </div>
                                    </span>
                                </div>
                                <div contenteditable="true" class="input-text" style="border:2px solid #BDC1C6" (mouseup)="checkSelection($event)">Enter the search query and annotate key words</div>
                                <!-- <textarea placeholder="Placeholder text" class="input-text"></textarea>  -->
                            </div>
                            <div class="kr-sg-btn">
                                <button class="kr-sg-buttonicon-secondary">
                                    <i class="si-add-plus add-icon"></i> Add
                                </button>
                            </div>
                        </div>
                         <!-- nlp annotator text area end -->
                         <!-- nlp custom tag builder area start -->
                        <div class="nlp-custom-tag-block">
                            <div class="nlp-tag-legend">Legend</div>
                            <div class="nlp-custom-tag-dynamic">
                                <div class="nlp-custom-tag"><span class="nlp-tag">Date</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Topic</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Date</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Topic</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Date</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Topic</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Date</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Topic</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Date</span> <span class="close-tag"><i class="si-close"></i></span></div>
                                <div class="nlp-custom-tag"><span class="nlp-tag">Topic</span> <span class="close-tag"><i class="si-close"></i></span></div>
                            </div>
                        </div>
                         <!-- nlp custom tag builder area end -->

                         <!-- nlp annotator first time custom tag add start -->
                         <div class="nlp-first-custom-tag d-none">
                             <div class="nlp-first-custom-block">
                                 <div class="nlp-first-custom-header">NLP Annotator</div>
                                 <div class="nlp-first-custom-tag-name">I'm looking for LED TV</div>
                             </div>
                         </div>
                         <div class="nlp-custom-tag-generator-list">
                            <div class="nlp-custom-tag-data-block">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header">Please tag</div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done">Done</div>
                                        <div class="nlp-preview-action-cancel">Cancel</div>
                                    </div>
                                </div>
                            </div>
                             <div class="nlp-custom-tag-data-block">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header">Please tag</div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done">Done</div>
                                        <div class="nlp-preview-action-cancel">Cancel</div>
                                    </div>
                                </div>
                            </div>
                            <div class="nlp-custom-tag-data-block">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header">Please tag</div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done">Done</div>
                                        <div class="nlp-preview-action-cancel">Cancel</div>
                                    </div>
                                </div>
                            </div>
                            <div class="nlp-custom-tag-data-block nlp-tag-edit">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header"><span class="warning-span"><img src="assets/images/warning.svg" class="warning-icon "/></span>Please tag  <span class="nlp-custom-tag"><span class="nlp-tag">Topic</span></span></div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done"><span class="nlp-preview-action-span"><img src="assets/images/check-primary.svg" class="warning-icon "/></span> Done</div>
                                        <div class="nlp-preview-action-cancel"><span class="nlp-preview-action-span"><img src="assets/images/close.svg" class="warning-icon "/></span> Cancel</div>
                                    </div>
                                </div>
                            </div>
                            <div class="nlp-custom-tag-data-block">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header">Please tag</div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done">Done</div>
                                        <div class="nlp-preview-action-cancel">Cancel</div>
                                    </div>
                                </div>
                            </div>
                            <div class="nlp-custom-tag-data-block">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header">Please tag</div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done">Done</div>
                                        <div class="nlp-preview-action-cancel">Cancel</div>
                                    </div>
                                </div>
                            </div>
                            <div class="nlp-custom-tag-data-block">
                                <div class="nlp-custom-tag-data-line">
                                   <div class="nlp-custom-tag-data">
                                       Looking for the <span class="nlp-custom-tag-highlight">latest</span> documents about <span class="nlp-custom-tag-highlight">process management</span> by <span class="nlp-custom-tag-highlight">Peter</span> or <span class="nlp-custom-tag-highlight">Robert</span>
                                   </div>
                                   <div class="nlp-custom-tag-overflow-menu">
                                    <div class="dropdown nlp-overflow-menu">
                                        <button class="btn dropdown-toggle dropdown-btn" type="button" id="nlpOverflowMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <img class="action_icon" src="assets/images/overflow-elipse.svg">
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="nlpOverflowMenu">
                                          <a class="dropdown-item" href="#"><span><img class="dropdown-list-icon" src="assets/images/edit-pencil.svg"></span> Edit</a>
                                          <a class="dropdown-item delete-item" href="#"><span><img class="dropdown-list-icon" src="assets/icons/delete-table.svg"></span> Delete</a>
                                        </div>
                                      </div>
                                   </div>
                                </div>
                                <div class="nlp-preview-block">
                                    <div class="nlp-preview-header">Please tag</div>
                                    <div class="nlp-preview-action-list">
                                        <div class="nlp-preview-action-done">Done</div>
                                        <div class="nlp-preview-action-cancel">Cancel</div>
                                    </div>
                                </div>
                            </div>
                          
                        </div>
                         <!-- nlp annotator first time custom tag add end -->
                        </perfect-scrollbar>
                    </div>
                </div>
            </div>
            <div class="outcome-rules col-6">
                <div class="inner-data-wrapper">
                    <div class="info-rule-contnet">
                        <div class="title-data">
                            <img src="assets/icons/business-rules/outcomesearch.svg">
                            <div class="text-title">{{ "businessRules.outcome_caps_small" | translate }}</div>
                        </div>
                        <div class="sub-text text-truncate">{{ "businessRules.condition_desc_outcome" | translate }}</div>
                    </div>

                    <div class="outcome-sec-data">
                        <perfect-scrollbar class="scoll-data">
                            <div class="inner-data-content">
                                <!-- Repeat the data here conditions -->
                                <ng-container *ngFor="let outcomeObj of outcomeArrayforAddEdit; let index = index">
                                    <div class="box-data-conditions">
                                        <div class="close-conditions" (click)="removeOutcome(index)">
                                            <i class="si-close"></i>
                                        </div>
                                        <div class="row-input-data row col-12">
                                            <div class="col-12 column-sec title-info">Action</div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown [placement]="'bottom-right'">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" (click)="currentEditInex = null" ngbDropdownToggle>{{ "businessRules." + outcomeObj.outcomeType | translate }}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200" *ngFor="let outcomeType of ruleOptions?.actions">
                                                                    <li class="p-0" (click)="outcomeSclection(outcomeObj,outcomeType,'outcomeType')" ngbDropdownItem>
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':outcomeObj.outcomeType===outcomeType}">{{"businessRules." + outcomeType | translate}}</a>
                                                                    </li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row-input-data row col-12">
                                            <div class="col-12 title-info">Response</div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown [placement]="'bottom-right'" (click)="currentEditInex = index;getFieldAutoComplete(null, null,'clearText')">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" ngbDropdownToggle>{{outcomeObj.fieldName? outcomeObj.fieldName : "Choose field"}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200">
                                                                    <li class="p-0" ngbDropdownItem *ngFor="let suggestion of fieldAutoSuggestion" (click)="selectField(suggestion, outcomeObj)">
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':outcomeObj.fieldName===suggestion.fieldName}">{{ suggestion.fieldName }}</a>
                                                                    </li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown [placement]="'bottom-right'" (click)="currentEditInex = index">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" ngbDropdownToggle disabled>{{outcomeObj.fieldDataType?(("businessRules."+outcomeObj.fieldDataType) | translate):"String"}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>                                                           
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown [placement]="'bottom-right'" (click)="currentEditInex = index">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" ngbDropdownToggle>{{"businessRules." +outcomeObj.outcomeOperator | translate}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200" *ngFor="let operator of conditions.string">
                                                                    <li class="p-0" ngbDropdownItem (click)="outcomeSclection(outcomeObj,operator,'outcomeOperator')">
                                                                        <a class="text-truncate" [ngClass]="{'font-weight-bold':outcomeObj.outcomeOperator===operator}">{{"businessRules." + operator | translate}}</a>
                                                                    </li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row-input-data row col-12">
                                            <div class="col-4 column-sec">
                                                <div class="kr-sg-dropdowns w-auto" ngbDropdown [placement]="'bottom-right'" (click)="currentEditInex = index">
                                                    <div class="dropdown dropdown-open">
                                                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" ngbDropdownToggle>{{"businessRules." +outcomeObj.outcomeValueType | translate}}</button>
                                                        <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                                            <perfect-scrollbar class="scroll-max-200">
                                                                <div class="scroll-max-200">
                                                                 <li ngbDropdownItem (click)="outcomeSclection(outcomeObj,'static','outcomeValueType');" [ngClass]="{'font-weight-bold':outcomeObj.outcomeValueType==='static'}">{{"businessRules.static" | translate}}</li>
                                                                 <li ngbDropdownItem (click)="outcomeSclection(outcomeObj,'dynamic','outcomeValueType');" [ngClass]="{'font-weight-bold':outcomeObj.outcomeValueType==='dynamic'}">{{"businessRules.dynamic" | translate}}</li>
                                                                </div>
                                                            </perfect-scrollbar>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-8 column-sec">
                                                <mat-form-field class="example-chip-list" [floatLabel]="'never'">
                                                    <mat-chip-list #chipList [attr.aria-label]="'tag selection'">
                                                        <ng-container
                                                            *ngFor="let value of outcomeObj.outcomeValue; let valueindex = index">
                                                            <mat-chip [selectable]="selectable" (removed)="removeTag(outcomeObj.outcomeValue, tag,valueindex)" [ngClass]="{'firstChip':valueindex==0}">
                                                                <span class="mat-val" *ngIf="value" container="body" ngbTooltip="{{value}}">{{value}}</span>
                                                                <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                                                            </mat-chip>
                                                            <span>OR</span>
                                                        </ng-container>
                                                        <input #contextSuggestedImput
                                                        id="OutcomeInput"
                                                            [placeholder]="'Type Keyword and Enter'"
                                                            (click)='buildCurrentContextSuggetions(outcomeObj)'
                                                            [(ngModel)]="outcomeObj.newValue"
                                                            (keyup)='buildCurrentContextSuggetions(outcomeObj)'
                                                            [matChipInputFor]="chipList" [matAutocomplete]="auto"
                                                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                            (matChipInputTokenEnd)="addOutcome($event, outcomeObj, (outcomeObj.outcomeValue.length))" />
                                                            <img *ngIf="iconImageOut && submitted" id="infoWarningOut" src="assets/icons/warning_escalation.svg" style="top: 35%; position: absolute; right: 3%; display: block;" height="12" width="12" />
                                                    </mat-chip-list>
                                                    <mat-autocomplete #auto="matAutocomplete" class="mat_autofocus_dropdown {{outcomeObj.outcomeValueType==='static'?'hideAutoFocus':''}}" (optionSelected)="selected($event,outcomeObj,index)">
                                                        <mat-option *ngFor="let suggesion of currentSugg">
                                                            {{suggesion}}
                                                        </mat-option>
                                                    </mat-autocomplete>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="and-condition" *ngIf="outcomeArrayforAddEdit && outcomeArrayforAddEdit.length-1 !==index">AND</div>
                                </ng-container>
                                <!-- End repeat -->
                                <div class="add-condition-btn" (click)="addNewOutcome()">
                                    <i class="si-add-plus"></i>
                                    <span>Add Condition</span>
                                </div>
                            </div>
                        </perfect-scrollbar>
                    </div>
                </div>
            </div>
        </div>
        <div class="nlp-custom-tag-popup" id="tagDialog" *ngIf="showEntityPopup">
            <div class="nlp-choose-tag d-none">
                <div class="nlp-choose-tag-header">
                    <span class="bot-tasks"><img src="assets/images/bot-tasks.svg" /></span> CHOOSE TAG
                </div>
                <div class="nlp-add-tag">
                    <button class="kr-sg-button-ghost pl-0" type="button">+ ADD TAG</button>
                </div>
                <div class="nlp-search-tag">
                    <div  class="kr-sg-input-search">
                        <input class="input-search" id="inputSearch" placeholder="Search" type="text">
                        <img  class="search-icon ng-star-inserted" src="assets/icons/search_gray.svg">
                    </div>
                    <div class="nlp-search-list">
                        <perfect-scrollbar class="scroll-data">
                            <div class="nlp-tag-list">
                                <div class="nlp-tag-and-name">
                                    <div class="nlp-name-value">Label</div>
                                    <div class="nlp-tag-value">SYSTEM ENTITY</div>
                                </div>
                                <div class="nlp-tag-field-actions">
                                    <div class="nlp-field-value">Field Name</div>
                                    <div class="nlp-tag-actions">
                                        <span class="nlp-tag-edit"><i class="si-pencil-edit"></i></span>
                                        <span class="nlp-tag-delete"><i class="si-delete1"></i></span>
                                    </div>
                                </div>
                            </div>
    
                            <div class="nlp-tag-list">
                                <div class="nlp-tag-and-name">
                                    <div class="nlp-name-value">Label</div>
                                    <div class="nlp-tag-value">SYSTEM ENTITY</div>
                                </div>
                                <div class="nlp-tag-field-actions">
                                    <div class="nlp-field-value">time_ist_eastindiantime_kolkata_easternasia_indianocean</div>
                                    <div class="nlp-tag-actions">
                                        <span class="nlp-tag-edit"><i class="si-pencil-edit"></i></span>
                                        <span class="nlp-tag-delete"><i class="si-delete1"></i></span>
                                    </div>
                                </div>
                            </div>

                            <div class="nlp-tag-list">
                                <div class="nlp-tag-and-name">
                                    <div class="nlp-name-value">Label</div>
                                    <div class="nlp-tag-value">SYSTEM ENTITY</div>
                                </div>
                                <div class="nlp-tag-field-actions">
                                    <div class="nlp-field-value">time_ist_eastindiantime_kolkata_easternasia_indianocean</div>
                                    <div class="nlp-tag-actions">
                                        <span class="nlp-tag-edit"><i class="si-pencil-edit"></i></span>
                                        <span class="nlp-tag-delete"><i class="si-delete1"></i></span>
                                    </div>
                                </div>
                            </div>

                            <div class="nlp-tag-list">
                                <div class="nlp-tag-and-name">
                                    <div class="nlp-name-value">Label</div>
                                    <div class="nlp-tag-value">SYSTEM ENTITY</div>
                                </div>
                                <div class="nlp-tag-field-actions">
                                    <div class="nlp-field-value">time_ist_eastindiantime_kolkata_easternasia_indianocean</div>
                                    <div class="nlp-tag-actions">
                                        <span class="nlp-tag-edit"><i class="si-pencil-edit"></i></span>
                                        <span class="nlp-tag-delete"><i class="si-delete1"></i></span>
                                    </div>
                                </div>
                            </div>

                            <div class="nlp-tag-list">
                                <div class="nlp-tag-and-name">
                                    <div class="nlp-name-value">Label</div>
                                    <div class="nlp-tag-value">SYSTEM ENTITY</div>
                                </div>
                                <div class="nlp-tag-field-actions">
                                    <div class="nlp-field-value">time_ist_eastindiantime_kolkata_easternasia_indianocean</div>
                                    <div class="nlp-tag-actions">
                                        <span class="nlp-tag-edit"><i class="si-pencil-edit"></i></span>
                                        <span class="nlp-tag-delete"><i class="si-delete1"></i></span>
                                    </div>
                                </div>
                            </div>
                            
    
                            <div class="nlp-tag-list">
                                <div class="nlp-tag-and-name">
                                    <div class="nlp-name-value">Label</div>
                                    <div class="nlp-tag-value">SYSTEM ENTITY</div>
                                </div>
                                <div class="nlp-tag-field-actions">
                                    <div class="nlp-field-value">time_ist_eastindiantime_kolkata_easternasia_indianoceane</div>
                                    <div class="nlp-tag-actions">
                                        <span class="nlp-tag-edit"><i class="si-pencil-edit"></i></span>
                                        <span class="nlp-tag-delete"><i class="si-delete1"></i></span>
                                    </div>
                                </div>
                            </div>
                        </perfect-scrollbar>
                    </div>
                </div>                        
            </div>
            <div class="nlp-custom-add-tag">
                <div class="nlp-choose-tag-header">
                    <span class="bot-tasks"><img src="assets/images/bot-tasks.svg" /></span> CHOOSE TAG
                </div>
                <div class="nlp-choose-tag-sub-header">
                    <div class="back-to-list">
                        <span><img src="assets/images/back-arrow.svg" /></span> Back
                    </div>
                    <div class="create-nlp-tag">
                        <span class="choose-tag">Choose Tag </span> / Create tag
                    </div>
                </div>
                <div class="nlp-tag-form">
                    <div class="kr-sg-input-text form-group">
                        <div  class="label-text">Tag Name</div>
                        <input  class="input-text" placeholder="Type here..." type="text">
                    </div>
                    <div class="entity-radiobtn-group">
                        <div class="group-radiobutton">
                            <div class="heading-title">ENTITY TYPE</div>
                            <div class="kr-sg-radiobutton">
                                <input id="radio-24" name="radio" class="radio-custom" checked type="radio">
                                <label for="radio-24" class="radio-custom-label">
                                    <span class="lable-truncate">SYSTEM ENTITY</span>
                                </label>
                            </div>
                            <div class="kr-sg-radiobutton">
                                <input id="radio-25" name="radio" class="radio-custom" type="radio">
                                <label for="radio-25" class="radio-custom-label">
                                    <span class="lable-truncate">INDEX FIELD</span>
                                </label>
                            </div>
                            <div class="kr-sg-radiobutton">
                                <input id="radio-26" name="radio" class="radio-custom" type="radio">
                                <label for="radio-26" class="radio-custom-label">
                                    <span class="lable-truncate">CUSTOM ENTITY</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="kr-sg-dropdowns w-auto form-group">
                        <div class="label-text">Map Field</div>
                        <div class="dropdown dropdown-open">
                            <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">Select</button>
                            <ul class="dropdown-menu content-menu">
                                <perfect-scrollbar class="scroll-max-200">
                                    <div class="scroll-max-200">
                                     <li><a class="text-truncate">Map Field 1</a></li>
                                     <li><a class="text-truncate">Map Field 2</a></li>
                                    </div>
                                </perfect-scrollbar>
                            </ul>
                        </div>
                    </div>

                    <div class="btn-grp">
                        <div class="btn-cancel"><button type="button" class="kr-sg-button-ghost" (click)="createEntity('cancel')">Cancel</button></div>
                        <div class="btn-save"><button type="button" class="kr-sg-button-ghost pr-0" (click)="createEntity('add')">Tag & Save</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="kr-sg-button-primary btn_lg" *ngIf="addEditRuleObj._id"
            (click)="updateRule(addEditRuleObj)">Save</button>
        <button class="kr-sg-button-primary btn_lg" *ngIf="!addEditRuleObj._id" (click)="createRule()">Add</button>
        <button class="kr-sg-button-secondary btn_lg"
            (click)="closeModalPopup()">{{addEditRuleObj._id?"Cancel":"Back"}}</button>
    </div>

   
</kr-modal>

<app-upgrade-plan #plans></app-upgrade-plan>

