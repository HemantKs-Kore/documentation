<ng-template #botResponse let-responses="responses" let-responseObj='responseObj' let-type="reponseType" let-id='id' let-index='index'>  
  <!-- <md-editor formControlName="botResponse" [options]="options" required height="300px"></md-editor> -->
  <div class="layout-select">
    <div class="d-flex align-items-center m-0 col-10 p-0">
      <div class="title">Select Layout</div>
      <div class="img-block" (click)="setResponseType('default',responseObj)" [ngClass]="{'active': (responseObj.responseType === 'default') || (!responseObj.responseType)}">
        <img *ngIf="(responseObj.responseType !== 'default')" src="assets/icons/editor/no-image.svg">
        <img  *ngIf="(responseObj.responseType === 'default')" src="assets/icons/editor/no-image-active.svg">
      </div>
      <div class="img-block" (click)="setResponseType('horizontalSplit',responseObj)"  [ngClass]="{'active': (responseType === 'horizontalSplit')}">
        <img *ngIf="(responseObj.responseType !== 'horizontalSplit')" src="assets/icons/editor/image-horizantal.svg">
        <img *ngIf="(responseObj.responseType === 'horizontalSplit')" src="assets/icons/editor/image-horizantal-active.svg" >
      </div>
      <div class="img-block" (click)="setResponseType('verticalSplit',responseObj)"  [ngClass]="{'active': (responseType === 'verticalSplit')}">
        <img *ngIf="(responseObj.responseType !== 'verticalSplit')" src="assets/icons/editor/image-vertical.svg">
        <img *ngIf="(responseObj.responseType == 'verticalSplit')" src="assets/icons/editor/image-vertical-active.svg" >
      </div>
    </div>
    <div class="delete-icon"><img src="assets/icons/sidemenu/delete-table.svg" (click)="delete(index)"></div>
    <!-- <div class="col-5 pr-0 drag-info-title">Drag to swap the position of the image</div> -->
  </div>
  <!-- add clases when image split mode .image-split-mode and swapmode add this class .swap-positions-->
  <div class="text-area-editor" [ngClass]="{'swap-positions': responseObj.responseType==='horizontalSplit','image-split-mode': responseObj.responseType ==='verticalSplit'}">
    <div class="upload-content-wrapper"  *ngIf="(responseObj.responseType !== 'default')">
      <div class="image-selections" (click)="openImgApp(responseObj,index,type)" *ngIf="!(responseObj && responseObj.image && responseObj.image.url)">
          <div class="img_block"><img  src="assets/icons/editor/upload-image.svg"></div>
          <div class="info-text">Upload Image or Video</div>
      </div>
      <!-- <input type="file" name="myfile"/> -->
      <div (click)="openImgApp(responseObj,index,type)" class="uploaded-image-preview"  *ngIf="responseObj && responseObj.image && responseObj.image.url && ((responseObj.responseType==='horizontalSplit') || (responseObj.responseType ==='verticalSplit'))">
        <img src="{{responseObj.image.url}}">
      </div>        
    </div>
    <div class="kr-sg-input-text-area"> 
      <div class="tabs-sec">
        <span class="tab-title " (click)="responseObj.type='string'" [ngClass]="{'active': responseObj.type === 'string'}">editor</span>
        <span class="tab-title" (click)="responseObj.type='javascript'" [ngClass]="{'active': responseObj.type==='javascript'}">&lt;/&gt; CODE</span>
      </div>
      <div class="editor-actons">
        <!-- <span class="edit-action">
          <img src="assets/icons/editor/alphabits.svg">
        </span> -->
        <span (click)="onSelected('italic')" class="edit-action">
          <img src="assets/icons/editor/italic.svg">
        </span>
        <span (click)="onSelected('bold')" class="edit-action">
          <img src="assets/icons/editor/bold.svg">
        </span>
        <span  class="edit-action" (click)="onSelected('link')">
          <img src="assets/icons/editor/link.svg">
        </span>
        <span (click)="onSelected('indentLeft')" class="edit-action">
          <img src="assets/icons/editor/align-left.svg">
        </span>
        <!-- <span class="edit-action">
          <img src="assets/icons/editor/align-center.svg">
        </span> -->
        <span (click)="onSelected('indentRight')" class="edit-action">
          <img src="assets/icons/editor/align-right.svg">
        </span>
        <span class="edit-action" (click)="onSelected('ordered')">
          <img src="assets/images/markup/list-ordered.svg">
        </span>
        <span (click)="onSelected('unordered')"  class="edit-action">
          <img src="assets/images/markup/list-unordered.svg">
        </span>
      </div>     
      <div>
      </div>  
      <div *ngIf="responseObj.type==='javascript'" >
         <ngx-codemirror #codemirror [options]="codeMirrorOptions" [(ngModel)]="responseObj.payload" (ngModelChange)="setEditorContent($event,responseObj,type,index)"> </ngx-codemirror>
      </div>
      <textarea *ngIf="responseObj.type==='string'"   (focus)="selectCurrentFocusedResponse(id,responseObj,type,index)"  [(ngModel)]="responseObj.payload" class="input-text" style="padding-bottom: 40px;" id="mainChatInputContainer{{type}}_{{index}}"></textarea>
    </div>
  </div>
</ng-template>
<div class="add-questions-form" [ngClass]="inputClass">
  <form [formGroup]="form">
    <div class="kr-sg-input-text mb-15">
      <div class="label-text">Question</div>
      <input type="text" placeholder="Enter your question" class="input-text" formControlName="question" autocomplete="off">             
    </div>
    <div for="tagInput" class="label-text">Key Terms</div>
    <mat-form-field class="example-chip-list mb-15" [floatLabel]="'never'">
      <mat-chip-list #chipList aria-label="tag selection">
        <mat-chip *ngFor="let tag of tags; let index = index;" (removed)="remove(tag)">
            <div class="mat-val" (click)="$event.stopPropagation()"> {{tag}}</div>
            <mat-icon matChipRemove><img src="assets/images/close.svg"></mat-icon>
        </mat-chip>
        <input placeholder="Type & enter"
              (focus)= "getAltTags($event)"
                [value]="typedQuery"
               [matChipInputFor]="chipList"
               [matAutocomplete]="suggestedItems"
               [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
               (matChipInputTokenEnd)="add($event)" id="tagInput" #suggestedInput (click)="$event.stopPropagation()" autocomplete="off">
        </mat-chip-list>
      <mat-autocomplete #suggestedItems="matAutocomplete" (optionSelected)="selectedTag($event)">
        <ng-container *ngFor = "let suggestion of suggestionTags">
          <mat-option *ngIf="checkDuplicateTags(suggestion)">
            {{suggestion}}
          </mat-option>
        </ng-container>
      </mat-autocomplete>
    </mat-form-field>
    <div class="mb-15">
      <div class="label-text">Groups</div>
      <app-group-input></app-group-input>
    </div>
  </form>
  <ng-container *ngFor="let faqObj of faqResponse.defaultAnswers ; let index = index">
    <div class="bot_rsponse_advance_mode">
      <div class="label-text bot-res-title">Bot Response</div>
      <div class="advanced_mode_faq">
        <label class="kr-sg-toggle with-label">
          <input type="checkbox" [checked]='(faqObj.answerType === "condition")' (click)="changeResponseType(faqObj)">
          <div class="slider"><span class="no">Default</span><span class="yes">Conditional</span></div>
        </label>
      </div>
      <img src="assets/icons/sidemenu/delete-table.svg" class="delete-response hide">
    </div>    
  <ng-container *ngIf="faqObj && faqObj.answerType === 'condition'">
    <div class="label-text">Conditions</div>
    <mat-form-field class="example-chip-list" [floatLabel]="'never'">
      <mat-chip-list #chipList2 aria-label="tag selection">
        <ng-container *ngFor="let tag of faqObj.conditions; let index = index;">
          <span class="and" *ngIf="(index)">and</span>
          <mat-chip (removed)="removeConditionTag(tag,faqObj,index)">
            <div class="mat-val" (click)="$event.stopPropagation()">{{tag.value}}</div>
            <mat-icon matChipRemove><img src="assets/images/close.svg"></mat-icon>
          </mat-chip>
        </ng-container>                           
        <input placeholder="Type & enter"
               [(ngModel)]="conditionQuary"
               [matChipInputFor]="chipList2"
               [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
               (matChipInputTokenEnd)="addConditionTag($event,faqObj)" id="tagInput12" #suggestedInput (click)="$event.stopPropagation()" autocomplete="off">
        </mat-chip-list>
    </mat-form-field>
  </ng-container>
    <ng-container *ngTemplateOutlet="botResponse; context{$implicit: faqResponse,responses:faqResponse.defaultAnswers,responseObj:faqObj,reponseType:'default',id:'default_',index:index }"> </ng-container>
  </ng-container>
  <div class="btn-sec">
    <div class="left-btns">
      <button class="kr-sg-button-primary btn_lg" (click)="save()">{{loading ? 'Saving..' : 'Save'}}</button>
      <button class="kr-sg-button-secondary btn_lg" (click)="cancel()">Cancel</button>
    </div>
    <div class="right-btns">        
      <button class="kr-sg-button-secondary btn_lg mr-0" (click)="addAnotherResponse('default')"><img src="assets/icons/editor/plus-add.svg" class="mr-2" >Another Bot Response</button>
      <button class="kr-sg-button-tertiary d-none" (click)='addAltQues()'>Add Alternate Question</button>
      <button class="kr-sg-button-tertiary d-none" (click)='addFollowupQues()'>Add Followup Question</button>
    </div>
  </div>
  
  <div *ngIf='isAdd'>
    <p>Add Alternate Question</p>
    <app-tags-inp [faqServ]='faqServiceAlt'></app-tags-inp>
  </div>
  <div *ngIf='isAlt'>
    <p>Add Followup Question</p>
    <app-tags-inp [faqServ]='faqServiceFollow'></app-tags-inp>
  </div>
 
</div>

<kr-modal modalType="default" #createImagePop>
  <div class="modal-header">
        <h4 class="modal-title">Provide Image URL</h4>
      </div>
      <div class="modal-body textAlignLeft">
        <div class="kr-sg-input-text mb-3">
          <div class="label-text">URL</div>
          <input maxlength="5128" type="text" autocomplete="off" placeholder="App name" class="input-text" [(ngModel)]="imgInfo.url" name="appName">
        </div>
        <div class="kr-sg-input-text mb-3">
          <div class="label-text">ALT</div>
          <input maxlength="128" type="text" autocomplete="off" placeholder="App name" class="input-text" [(ngModel)]="imgInfo.alt" name="appName">
        </div>
      </div>
      <div class="modal-footer">
        <button [disabled]="!imgInfo.url"  type="button" class="btn kr-btn-primary"  data-dismiss="modal" (click)='addImage()' >Add</button>
        <button type="button" class="btn kr-btn-cancel" data-dismiss="modal" (click)="closeImgApp()">Close</button>
      </div>
</kr-modal>
<kr-modal modalType="default" #createLinkPop>
  <div class="modal-header">
        <h4 class="modal-title">Provide link URL</h4>
      </div>
      <div class="modal-body textAlignLeft">
        <div class="kr-sg-input-text mb-3">
          <div class="label-text">URL</div>
          <input maxlength="1024" type="text" autocomplete="off" placeholder="App name" class="input-text" [(ngModel)]="linkInfo.link" name="LinkURL">
        </div>
        <div class="kr-sg-input-text mb-3">
          <div class="label-text">Link Text</div>
          <input maxlength="1024" type="text" placeholder="Enter Link Trxt" autocomplete="off" class="input-text" [(ngModel)]="linkInfo.linkText" name="LinkText">
        </div>
      </div>
      <div class="modal-footer">
        <button [disabled]="!linkInfo.link"  type="button" class="btn kr-btn-primary"  data-dismiss="modal" (click)='saveLink()' >Save</button>
        <button type="button" class="btn kr-btn-cancel" data-dismiss="modal" (click)="closeLinkApp()">Close</button>
      </div>
</kr-modal>
