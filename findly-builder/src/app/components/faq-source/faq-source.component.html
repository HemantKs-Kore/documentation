
<div class="mainLoadingSpinner" *ngIf="loadingFaqs" [@fadeInOutAnimation]>
    <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
    <span class="please-wait-message">{{'please_wait' | translate}}</span>
</div>
<div class="faqmain-container" *ngIf="!loadingFaqs">
    <div class="faqsListContainer">
        <div class="faq-header-sec row">
            <div class="col-8 left-sec p-0">
                <div class="tab-sec d-flex">
                    <div class="tab_title" (click)="selectTab('draft')" [ngClass]="{'active': (selectedtab === 'draft')}">Drafts<span class="">({{faqSelectionObj.stats.draft || 0}})</span></div>
                    <div class="tab_title" (click)="selectTab('in_review')" [ngClass]="{'active': (selectedtab === 'in_review')}">In-review<span class="">({{faqSelectionObj.stats.in_review || 0}})</span></div>
                    <div class="tab_title" (click)="selectTab('approved')" [ngClass]="{'active': (selectedtab === 'approved')}">Approved<span class="">({{faqSelectionObj.stats.approved || 0}})</span></div>
                </div>
            </div>
            <div class="col-4 p-0 right-sec">
                <div (click)="openStatusModal()" class="title"><img src="assets/icons/sidemenu/plus-table.svg">Manage Extracts</div>
            </div>
        </div>
        <div class="faq-content-boxes">
            <div class="content">
                <div class="content-boxes faq_tasks_list">
                    <div class="header-sec">
                        <div class="kr-sg-checkbox">
                            <input class="checkbox-custom" type="checkbox" id="selectAllFaqs" (change)="selectAll()" [(ngModel)]="faqSelectionObj.selectAll">
                            <label for="selectAllFaqs" class="checkbox-custom-label"></label>
                        </div>
                        <div class="kr-sg-input-search">                               
                            <input type="text" placeholder="Search" class="input-search" [(ngModel)]="searchFaq" id="searchFaqs" name='faqsSearch'>
                            <img src="assets/icons/search-gray.svg" class="search-icon">
                        </div>
                        <div class="kr-sg-dropdowns" #selectResourceDrop='ngbDropdown' ngbDropdown [container]="'body'" [placement]="'bottom-right'">                                        
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle data-toggle="dropdown">Filter<img src="assets/icons/filter.svg"></button>                                            
                                <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                    <ng-container *ngFor="let source of resources">
                                        <li *ngIf="source.status==='success'" (click)="selectResourceDrop.close();selectResourceFilter(source)">{{source.name}}</li>
                                    </ng-container>
                                </ul>
                            </div>
                        </div>
                        <div class="kr-sg-dropdowns add"  #selectSourceDrop='ngbDropdown'ngbDropdown [container]="'body'" [placement]="'bottom-right'">                                        
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle data-toggle="dropdown">Add</button>                                            
                                <ul class="dropdown-menu content-menu faq-filter-add" ngbDropdownMenu>
                                  <li (click)="selectSourceDrop.close();addFaqSource('faqDoc')">Extract FAQs</li>
                                  <li (click)="selectSourceDrop.close();addFaqSource('faqWeb')">Import FAQs</li>
                                  <li (click)="selectSourceDrop.close();addFaqSource('manual')">Add FAQs Manually</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="body-content">
                        <ng-container  *ngIf="(faqs && faqs.length) && !loadingTab">
                        <perfect-scrollbar class="accor-scroll" [ngClass]="{'show_footer': faqSelectionObj.selectedCount}">
                            <div class="selected-all-questions" *ngIf="faqSelectionObj.selectAll">Do you want to select all {{faqSelectionObj.totalFaqsCount || ''}} questions?</div>
                            <div id="accordion" class="accordion-content">
                                <ng-container *ngFor="let faq of faqs | filter: [ searchFaq , 'question']">
                                    <div class="card-content">
                                        <div [attr.id]="'faqquestionAcc' + faq._id" (click)="selectedFaqToTrain(faq)"  class="card_link collapsed" [ngClass]="{'is-checked': ((faqSelectionObj && faqSelectionObj.selectedItems[faq._id]) || faqSelectionObj.selectAll)}" data-toggle="collapse" [attr.data-target]="'#'+faq._id" [attr.aria-controls]="collapseOne">      
                                            <span class="published-que" *ngIf="(faq.state==='published')" [ngClass]="{'reverted': (faq.state==='reverted')}">{{faq.state | titlecase}}</span>
                                            <div class="d-flex align-items-center">
                                                <div class="kr-sg-checkbox" (click)="$event.stopImmediatePropagation();">
                                                    <input  [attr.id]="'selectFaqCheckBox_' + faq._id" (change)="checkUncheckfaqs(faq)" class="checkbox-custom selectEachfaqInput" type="checkbox">
                                                    <label [attr.for]="'selectFaqCheckBox_' + faq._id" class="checkbox-custom-label"></label>
                                                </div>
                                                <div class="title-desc-sec">
                                                    <div class="title">{{faq.question}}</div>
                                                    <div class="desc">{{faq.answer}}</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="{{faq._id}}" class="collapse"  [attr.aria-labelledby]="'faqquestionAcc' + faq._id" data-parent="#accordion">
                                            <div class="cardbody">
                                                <ng-container *ngIf="faq.alternateQuestions && faq.alternateQuestions.length">
                                                    <div class="acc-inner-que" [ngClass]="{'check-all': ((faqSelectionObj && faqSelectionObj.selectedItems[faq._is]) || faqSelectionObj.selectAll)}" *ngFor="let altQuestion of faq.alternateQuestions">
                                                        <div class="title">{{altQuestion.question}}</div>
                                                        <div class="desc">{{altQuestion.answer}}</div>
                                                    </div>
                                                </ng-container>
                                                <div class="divBlockEmptylastChild emptyAltQuestions"> No Alternate Questions</div>
                                            </div>
                                        </div>
                                    </div> 
                                </ng-container>
                                <div class="empty-questions-selected divBlockEmptylastChild">
                                    <div class="heading">No search results</div>
                                </div>
                            </div>
                        </perfect-scrollbar>
                       </ng-container>
                        <div class="empty-questions-selected"  *ngIf="!(faqs && faqs.length)">
                            <div *ngIf="loadingTab">
                                <div class="heading">{{'please_wait' | translate}}</div>
                            </div>
                            <ng-container *ngIf="!loadingTab">
                                <img src="assets/images/icons/empty_ill.svg">
                                <div class="heading">No Questions</div>
                                <div class="desc">Please add questions</div>
                            </ng-container>
                        </div>
                        <div class="footer-btns" *ngIf="faqSelectionObj.selectedCount">
                            <button class="kr-sg-button-primary btn_lg">Send for Review</button>
                            <button class="kr-sg-button-secondary btn_lg">Delete</button>
                        </div>
                    </div>
                </div>
            </div>            
            <div class="content">
                <div class="content-boxes train_your_questions">
                    <div class="header-sec row m-0">
                        <div class="col-4 p-0 title">Train your questions</div>
                        <div class="col-8 p-0 title text-right" *ngIf="selectedFaq">
                            <span class="questions-count">Alternate Questions ({{(selectedFaq.alternateQuestions?selectedFaq.alternateQuestions.length:0)}})</span>
                            <span class="questions-count">Followup Questions ({{(selectedFaq.followupQuestions?selectedFaq.followupQuestions.length:0)}})</span>
                        </div>
                    </div>
                    <ng-container *ngIf="!selectedFaq">
                        <div class="empty-questions-selected">
                        <img src="assets/images/icons/empty_ill.svg">
                        <div class="heading">No Questions</div>
                        <div class="desc">Please select a questions</div>
                       </div>
                    </ng-container>
                    <ng-container *ngIf="selectedFaq">
                    <div class="header-sec with-info row m-0" *ngIf="selectedFaq && selectedFaq.state === 'in_review'">
                        <div class="col-2 p-0 col_">
                            <div class="heading">Source</div>
                            <div class="info-title">{{selectedFaq.source | titlecase}}</div>
                        </div>
                        <div class="col-1 p-0 col_">
                            <div class="heading">Type</div>
                            <div class="info-title">{{selectedFaq.source | titlecase}}</div>
                        </div>
                        <div class="col-2 p-0 col_">
                            <div class="heading">Editor</div>
                            <div class="info-title">{{selectedFaq.createdBy}}</div>
                        </div>
                        <div class="col-3 p-0 col_">
                            <div class="heading">Req. Date & Time</div>
                            <div class="info-title">{{selectedFaq.createdBy || dateFormatPipe}}<span class="time hide">10:49:18</span></div>
                        </div>
                        <div class="col-4 p-0 col_">
                            <div class="d-flex align-items-center justify-content-end">
                                <button class="kr-sg-button-primary btn_lg">Approve</button>
                                <div class="kr-sg-dropdowns add" ngbDropdown [container]="'body'" [placement]="'bottom-right'">                                        
                                    <div class="dropdown dropdown-open">
                                        <button class="dropdown-toggle dropdown-input" ngbDropdownToggle data-toggle="dropdown"><img src="assets/icons/dropdown-arrow.svg"></button>                                            
                                        <ul class="dropdown-menu content-menu faq-filter-add pt-1 pb-1" ngbDropdownMenu>
                                          <li>Needs Rework</li>                                         
                                        </ul>
                                    </div>
                                </div>
                                <div class="comments-img">
                                    <img src="assets/icons/comment.svg">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="header-info-que" *ngIf="selectedFaq && selectedFaq.state === 'draft'">
                        <div class="col_ p-0 source">
                            <div class="heading">Source</div>
                            <div class="info-title">{{selectedFaq.source | titlecase}}</div>
                        </div>
                        <div class="col_ p-0 type">
                            <div class="heading">Type</div>
                            <div class="info-title">{{selectedFaq.source | titlecase}}</div>
                        </div>
                        <div class="col_ p-0">
                            <div class="heading">Created</div>
                            <div class="info-title">{{selectedFaq.createdBy}}</div>
                        </div>
                        <div class="col_ p-0 review-btn">
                            <button class="kr-sg-button-primary btn_lg">Send for Review</button>
                            <img src="assets/icons/delete-table.svg">
                        </div>                    
                    </div>
                    <div class="header-info-que with-info" *ngIf="selectedFaq && selectedFaq.state === 'approved'">
                        <div class="col-2 p-0">
                            <div class="heading">Source</div>
                            <div class="info-title">{{selectedFaq.source | titlecase}}</div>
                        </div>
                        <div class="col-1 p-0">
                            <div class="heading">Type</div>
                            <div class="info-title">{{selectedFaq.source | titlecase}}</div>
                        </div>
                        <div class="col-2 p-0">
                            <div class="heading">Edited by</div>
                            <div class="info-title">{{selectedFaq.createdBy}}</div>
                        </div>
                        <div class="col-3 p-0">
                            <div class="heading">Reviewed by</div>
                            <div class="info-title">{{selectedFaq.reviewedBy || '--'}}</div>
                        </div>
                        <div class="col-3 p-0">
                            <div class="heading">Approved at</div>
                            <div class="info-title">{{selectedFaq.createdBy || dateFormatPipe}}</div>
                        </div>
                        <div class="kr-sg-dropdowns elipse-dropdown col-1" ngbDropdown [container]="'body'" [placement]="'bottom-right'">                                        
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle data-toggle="dropdown"><img src="assets/icons/elipse.svg"></button>                                            
                                <ul class="dropdown-menu content-menu faq-filter-add pt-1 pb-1" ngbDropdownMenu>
                                  <li>Move to Drafts</li>      
                                  <li>Send for Review</li>                                   
                                  <li class="delete-text">Delete</li>                                   
                                </ul>
                            </div>
                        </div>
                    </div>
                    <perfect-scrollbar class="train-questions-body-scroll">               
                        <div class="body-content">
                            <div class="body-top-content">
                                <div class="question-content">
                                    <div class="title-que">
                                        <span class="">{{selectedFaq.question}}</span>
                                        <img src="assets/icons/edit.svg">
                                    </div>
                                    <div class="keywords">
                                        <span class="key-title">Keywords :</span>
                                        <span class="keys" *ngFor="let keyword of selectedFaq.keywords">{{keyword}}</span>
                                    </div>                        
                                    <div class="added-answer" [innerHtml]='selectedFaq.answer'></div>
                                </div>
                                <div class="appearences-info row">
                                    <div class="col-4 p-0">
                                        <span class="source">Appearances:</span>
                                        <span class="count">{{selectedFaq.feedback.expand}}</span>
                                    </div>
                                    <div class="col-3 p-0">
                                        <span class="source">Clicks:</span>
                                        <span class="count">{{selectedFaq.feedback.ckick}}</span>
                                    </div>
                                    <div class="col-2 p-0">
                                        <span class="source"><img src="assets/icons/like.svg"></span>
                                        <span class="count">{{selectedFaq.feedback.thumbsup}}</span>
                                    </div>
                                    <div class="col-3 p-0">
                                        <span class="source"><img src="assets/icons/dislike.svg"></span>
                                        <span class="count">{{selectedFaq.feedback.thumbsdown}}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="add-alternative-questions row">
                                <div class="col-10 pl-0 pr-2">
                                    <div class="question-name text-truncate">Alternate Questions ({{(selectedFaq.alternateQuestions?selectedFaq.alternateQuestions.length:0)}})</div>
                                    <div class="added-tags text-truncate">Add alternate forms of the question, key tags and add synonyms.</div>
                                </div>
                                <div class="col-2 p-0 text-right">
                                    <button class="kr-sg-button-primary btn_lg">Add</button>
                                </div>
                            </div>
                            <ng-container *ngIf="selectedFaq.alternateQuestions && selectedFaq.alternateQuestions.length">
                            <div class="added-questions-list" *ngFor="let alternateQuestion of selectedFaq.alternateQuestions">
                                <div class="question-name text-truncate">{{alternateQuestion.question}}</div>
                                <div class="added-tags text-truncate">
                                    <span class="tags-data" *ngFor="let keyword of alternateQuestion.keywords">{{keyword}}</span>
                                </div>
                                <img src="assets/icons/delete-table.svg" class="delete-icon">
                            </div>
                           </ng-container>
                            <div class="add-alternative-questions row">
                                <div class="col-10 pl-0 pr-2">
                                    <div class="question-name text-truncate">Followup Questions ({{(selectedFaq.followupQuestions?selectedFaq.followupQuestions.length:0)}})</div>
                                    <div class="added-tags text-truncate">Add followup the question, key tags and add synonyms.</div>
                                </div>
                                <div class="col-2 p-0 text-right">
                                    <button class="kr-sg-button-primary btn_lg">Add</button>
                                </div>
                            </div>
                            <ng-container *ngIf="selectedFaq.followupQuestions && selectedFaq.followupQuestions.length">
                                <div class="added-questions-list">
                                    <div class="question-name text-truncate">How do I access my account online at Citibank Online?</div>
                                    <div class="added-tags text-truncate">
                                        <span class="tags-data" *ngFor="let keyword of followupQuestions.keywords">{{keyword}}</span>
                                    </div>
                                    <img src="assets/icons/delete-table.svg" class="delete-icon">
                                </div>
                            </ng-container>
                        </div>
                    </perfect-scrollbar>
                   </ng-container>
                </div>
            </div>
        </div>        
    </div>
</div>


<kr-modal modalType="center" modalClass="addSourceModalComponent" #statusModalPop>
    <div class="modal-header">
        <div class="header-title" (click)='addFaqSource("faqDoc")'><img src="assets/images/closeCross.png" class="closeCross"></div>
        <!-- <div class="table-action-header modal-table-actions">       
            <div class="kr-sg-input-search">                               
              <input [disabled]='!(resources && resources.length)' type="text" placeholder="Search" id="searchContentSources" class="input-search" [(ngModel)]="searchSources">
              <img src="assets/icons/search.svg" class="search-icon">
            </div>
            <button class="kr-sg-button-primary btn_md" (click)='addFaqSource("faqDoc")'>Add Source</button>
        </div> -->
        <div class="table-action-header modal-table-actions"> 
            <input type="text" name='searchSources' placeholder="Search" id="searchContentSources" class="input-search tbsearchbar" [(ngModel)]="searchSources" (keyup)="applyFilter($event.target.value)">              
              <div class="search">
                <img *ngIf="searchSources" (click)="applyFilter('')" class="search-icon" src="assets/images/close.svg">
                <span *ngIf="!searchSources" class="search-name"><img class="search-img" src="assets/icons/sidemenu/search-table.svg"></span>
              </div>
              <div class="kr-sg-dropdowns">            
                <div class="dropdown dropdown-open">
                    <button class="dropdown-toggle dropdown-input" data-toggle="dropdown"><img src="assets/icons/sidemenu/plus-table.svg">Add Content</button>                                            
                    <ul class="dropdown-menu content-menu">                                                              
                      <li (click)="addNewContentSource('contentWeb')">Web Crawling</li>
                      <li (click)="addNewContentSource('contentDoc')">Upload File</li>                 
                    </ul>
                </div>
              </div>
              <div *ngIf="currentView === 'list'" class="grid-list-view-table" (click)="currentView='grid'"><img src="assets/icons/grid-view.svg"></div>
              <div *ngIf="currentView === 'grid'" class="grid-list-view-table" (click)="currentView='list'"><img src="assets/icons/list-view.svg"></div>
          </div> 
    </div>
    <div class="modal-body source-modal-popup" *ngIf="resources && resources.length">
        <ng-container  *ngIf="currentView === 'list'">
            <div class="table-list-content">
                <div class="kr-sg-data-table with-checkbox"  *ngIf="resources && resources.length">
                <section class="table-content">
                    <header class="table-header">
                        <div class="col" (click)="sortBy('name')">Title<img src="assets/icons/caretDown.svg" class="ml-1"></div>
                        <div class="col" (click)="sortBy('type')">Type <img src="assets/icons/caretDown.svg" class="ml-1"></div>
                        <div class="col" (click)="sortBy('recentStatus')">Status <img src="assets/icons/caretDown.svg" class="ml-1"></div>
                        <div class="col" (click)="sortBy('extrated')">Extrated <img src="assets/icons/caretDown.svg" class="ml-1"></div>
                        <div class="col" (click)="sortBy('createdOn')">Created <img src="assets/icons/caretDown.svg" class="ml-1"></div>
                        <div class="col" (click)="sortBy('createdOn')">Reviewed <img src="assets/icons/caretDown.svg" class="ml-1"></div>
                        <div class="col last-child" (click)="sortBy('name')"></div>
                    </header>
                    <perfect-scrollbar class="faqScurceListScroll" [disabled]="workflowService.disablePerfectScroll">
                    <div class="content-body" *ngFor="let source of resources | filter: [ searchSources , 'name']" (click)="openStatusSlider(source)">
                        <div class="col">{{source.title || source.name}}</div>
                        <div class="col">{{source.source | titlecase}}</div>
                        <div class="col">
                            <span *ngIf="source.recentStatus && statusObj[source.recentStatus]" [ngStyle]="{color: (source.recentStatus && statusObj[source.recentStatus])?statusObj[source.recentStatus].color:'black'}">{{statusObj[source.recentStatus].name}}</span>
                            <span *ngIf="!(source.recentStatus && statusObj[source.recentStatus])">---</span>
                        </div>
                        <div class="col">{{source.extracted || '0'}}</div>
                        <div class="col">{{source.staged || '0'}}</div>
                        <div class="col">{{source.createdOn | dateFormatPipe}}</div>
                        <div class="col text-right last-child" >
                            <span class="actions-links"><img class="action_icon" src="assets/images/trashIcon.svg"></span>
                            <!-- <span class="actions-links"><img class="action_icon" src="assets/images/list.svg"></span> -->
                        </div>
                    </div>
                    <div class="empty">No Search Results found</div>
                    </perfect-scrollbar>
                    
                </section>                               
            </div>
            <div class="divBlockEmptylastChild">{{searchSources?'No Data Found': 'No search results'}}</div>
            </div>
        </ng-container>
        <ng-container  *ngIf="currentView === 'grid'">
            <div class="list-view-data">
                <div class="row row_list">
                <div class="box-content" *ngFor="let source of resources | filter: [ searchSources , 'name']">
                    <div class="box">
                    <div class="title">{{source.title || source.name}}</div>
                    <div class="type" [ngClass]="{'doc': (source.type==='document')}">{{contentTypes[source.type] | titlecase}}</div>
                    <div class="status-data">
                        <!-- <div class="count-pages"><span class="pagelength">19</span> Pages</div> -->
                        <div class="status-info" *ngIf="source.recentStatus && statusObj[source.recentStatus]" [ngStyle]="{color: (source.recentStatus && statusObj[source.recentStatus])?statusObj[source.recentStatus].color:'#202124'}">
                        <img src="assets/icons/failed-status.svg" *ngIf="statusObj[source.recentStatus].name == 'Failed'">
                        <img class="inprogressLoader" src="assets/icons/ringLoading.svg" *ngIf="statusObj[source.recentStatus].name == 'In Progress'">
                        <div class="status-name">{{statusObj[source.recentStatus].name}}</div>
                        </div>
                        <div *ngIf="!(source.recentStatus && statusObj[source.recentStatus])">---</div>
                        <div class="created-date" *ngIf="statusObj[source.recentStatus].name == 'Success'">{{source.createdOn | dateFormatPipe}}</div>
                    </div>
                    </div>
                </div>            
                </div>
            </div> 
        </ng-container>
    </div>
</kr-modal>

<kr-modal modalType="center" modalClass="addSourceModalComponent" #addSourceModalPop>
    <ng-container *ngIf="showSourceAddition">
        <app-add-source [inputClass]='"faqSourceAddition"' [resourceIDToOpen]="showSourceAddition" (saveEvent)="onSourceAdditionSave($event)" (cancleEvent)="onSourceAdditionClose($event)"></app-add-source>
    </ng-container>
</kr-modal>
