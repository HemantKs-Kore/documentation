<div class="traits-container p-0">
    <div class="mainLoadingSpinner" *ngIf="loadingTraits" >
        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
        <span class="please-wait-message">{{'Please Wait!' | translate}}</span>
    </div>
    <ng-container *ngIf="loadingTraits1">  
    
    <!-- TABLE CONTENT -->
    <div class="traits">        
        <div class="table-list-content" >                         
            <div class="seach_add_feild">
                <app-useronboarding-journey [componentType]='componentType'></app-useronboarding-journey>
                <div class="title">Traits</div>
                <div class="d-flex align-items-center" *ngIf="traits.traitGroups &&  traits.traitGroups.length">
                    <!-- <div class="kr-sg-input-search m-0" [ngClass]="{'active': showSearch}">                               
                        <input type="text" placeholder="Search" autocomplete="off" class="input-search" name='searchSources' placeholder="Search" id="fieldSearchId" [(ngModel)]="serachTraits">           
                    </div>  -->
                    <div class="kr-sg-input-search" [ngClass]="{'d-none': !showSearch}">
                        <input type="text" placeholder="Search" maxlength="60" id="inputSearch" class="input-search" [ngClass]="{'pl-33':!serachTraits,'pl-2':serachTraits}" autocomplete="off" [(ngModel)]="serachTraits" (focusout)="focusoutSearch();" (mouseover)="searchImgSrc = (searchFocusIn ? 'assets/icons/search_gray.svg' :'assets/icons/search_gray_dark.svg')"
                            (mouseout)="searchFocusIn=false;searchImgSrc = 'assets/icons/search_gray.svg'" (focus)="searchFocusIn=true;searchImgSrc = 'assets/icons/search_gray.svg'">
                        <img [src]="searchImgSrc" class="search-icon" *ngIf="!serachTraits">
                        <img class="close-icon" *ngIf="serachTraits" src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':serachTraits}" (mouseover)="activeClose=true" (mouseout)="activeClose=false" (click)="serachTraits='';"  placement="top-center" container='body' ngbTooltip="Cancel" tooltipClass="ngb_tooltip_custom_class sampleJson">
                    </div>
                    <div class="seach-block" >
                        <span [ngClass]="{'d-none': showSearch}" class="mr-3" id="btn_toggle_search_structured_data" (click)="toggleSearch();focusinSearch('inputSearch')"><img src="assets/icons/search.svg" [ngClass]="{'d-none': showSearch}">{{'search' | translate}}</span>
                    </div>
                    <!-- <div class="seach-block" (click)="toggleSearch()"><img *ngIf="!showSearch" src="assets/icons/search.svg"><img *ngIf="showSearch" src="assets/images/close.svg">Search</div> -->
                    <div class="add_feild mr-0" (click)="createNewTraits()"><img src="assets/icons/add_plus.svg"> Add Traits</div>
                    <!-- <button class="kr-sg-button-primary btn_lg" (click)="trainIndex()">Train Index</button> -->
                </div>
            </div>  
            <div class="trailts-table-header row" *ngIf="traits.traitGroups &&  traits.traitGroups.length">
                <div class="col-3 title">TRAIT GROUP</div>
                <div class="col-8 title">TRAITS</div>
            </div>                 
            <perfect-scrollbar class="traits-scroll-data" *ngIf="traits.traitGroups &&  traits.traitGroups.length">
                <div class="traits-body-sec">
                    <div class="content-body row col-12 m-0" *ngFor="let traitGroup of  traits.traitGroups | traitsFilter:serachTraits; let index = index">
                        <div class="col-3 traitGroup-name text-truncate" ><span ngbTooltip="{{traitGroup.groupName || '---'}}" placement="top-center" container='body' tooltipClass="ngb_tooltip_custom_class sampleJson">{{traitGroup.groupName || '---'}}</span></div>
                        <div class="col-7 traits-groups row m-0 align-items-center pr-0">
                            <span *ngFor="let trait of traitGroup.traits| slice:0:getTraitsSliceValue(traitGroup.traits); let i=index;" class="trait-more">
                                {{i!==0 ?', ':''}}{{trait.traitName || '---'}}
                            </span>                                                                    

                            <div class="kr-sg-dropdowns traits-more-data-container" ngbDropdown [placement]="'right-top'" *ngIf="traitGroup.traits.length>getTraitsSliceValue(traitGroup.traits)">
                                <div class="dropdown dropdown-open">
                                    <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopPropagation()"> +{{traitGroup.traits.length-getTraitsSliceValue(traitGroup.traits)}}</button>
                                    <ul class="dropdown-menu content-menu traits-more-data-container-dropdown" ngbDropdownMenu>
                                       <div class="inner-content">
                                            <div class="close-dropdown">
                                                <img src="assets/icons/close-dropdown.svg">
                                            </div>
                                            <perfect-scrollbar class="more-traits-scroll">
                                                <li *ngFor="let trait of traitGroup.traits| slice:getTraitsSliceValue(traitGroup.traits):(traitGroup.traits.length);" ngbTooltip="{{trait.traitName || '---'}}" placement="left" container='body' tooltipClass="ngb_tooltip_custom_class sampleJson" class="text-truncate">
                                                    {{trait.traitName || '---'}}
                                                </li>
                                            </perfect-scrollbar>
                                       </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-2 action-links">
                            <img src="assets/icons/edit-pencil.svg" class="mr-4" (click)="editTraitFroup(traitGroup)" id="btn_edit_traits" placement="top-center" container='body' ngbTooltip="Edit" tooltipClass="ngb_tooltip_custom_class sampleJson">
                            <img src="assets/icons/delete-table.svg"(click)="deleteTraitsGroup(index,traitGroup,$event)"  id="btn_delete_traits" placement="top-center" container='body' ngbTooltip="Delete" tooltipClass="ngb_tooltip_custom_class sampleJson">
                        </div> 
                    </div>
                    <div class="divBlockEmptylastChild text-center">         
                        <div class="desc">No search results found</div>
                    </div>
                </div>
            </perfect-scrollbar>
        </div>

    </div>
    <!-- NO DATA FOUND -->
    <ng-container *ngIf="!(traits.traitGroups &&  traits.traitGroups.length)">
        <perfect-scrollbar class="empty-scroll">
            <div  class="empty-landing-screen" >
            <div class="img-block"*ngIf="!emptyItems"><img class="action_icon" (load)="imageLoad()" src="assets/images/traits-empty.svg"></div>
            <ng-container *ngIf="loadImageText">
                <div class="empty-title">You havenâ€™t added any Traits yet!</div>
                <div class="desc-text"> Traits are specific entities, attributes or details that the users express in their conversations.  Traits present in the utterance can be used in driving the intent detection and bot conversation flows. SearchAssist allows you to define Traits and train the utterances.
                </div>
                <div class="kr-sg-dropdowns" #selectSourceDrop='ngbDropdown' ngbDropdown [container]="'body'">                                         
                    <div class="dropdown dropdown-open">
                        <button class='kr-sg-button-primary btn_lg px-3' (click)='createNewTraits()'>Add Traits</button>
                    </div>                                    
                </div>
            </ng-container>
            <ng-container *ngIf="noItems && emptySearchResults">
                <div class="desc-text">Your Search Query doesn't match with any record.</div>
            </ng-container>
            </div>
        </perfect-scrollbar>
    </ng-container>
    <!-- CREATE NEW TRAIT MODAL-->
    </ng-container>
</div>


<kr-modal modalType="center" #statusModalPop modalClass="modal_popups_ add-Trait-Modal-Component">
    <div class="modal-header">
        <div class="title">{{(traits.addEditTraits._id)?'Edit Trait Group':'New Trait Group'}}</div>
        <div class="close_icon" (click)='closeStatusModal()'><img src="assets/icons/modal-close.svg"></div>
    </div>
    <perfect-scrollbar class="perfect-scroll-modal-body">
        <div class="modal-body">
            <div class="kr-sg-input-text trait-group-name">
                <div class="label-text">Trait Group Name</div>
                <input type="text" autocomplete="off" maxlength="60" placeholder="Enter Trait Group" class="input-text" [(ngModel)]="traits.addEditTraits.groupName" [ngClass]="{'err-block' : (!traits.addEditTraits.groupName && submitted)}">
                <div class="eg-text">Eg: Vehicle type, Class</div>
                <img *ngIf="!traits.addEditTraits.groupName && submitted" id="traitGroupNameWarning" src="assets/icons/warning_escalation.svg" style="top: 39%; position: absolute; right: 1.5%; display: block;" height="12" width="12" />
            </div>

            <div class="kr-sg-input-text add-traits-input">              
                <input autocomplete="off" type="text" maxlength="60" placeholder="Type and Enter to Add Traits" class="input-text"  #traitValue [(ngModel)]="add.traitName"(keyup.enter)="addTraits(add.traitName,$event)">
            </div>

            <ng-container *ngIf="traits.addEditTraits && traits.addEditTraits.traitsArray && traits.addEditTraits.traitsArray.length">
                <div class="content-body-traits row col-12" *ngFor="let item of traits.addEditTraits.traitsArray;let index = index;"  (click)="openAddUtteranceModel(index,item.key,item.data,true)" [ngClass]="{'pointer':item.data.length}">
                    <div class="col-4 group-name text-truncate"  *ngIf="showEditTraitInput !== index"><span ngbTooltip="{{item.key}}" placement="top-center" container='body'  tooltipClass="ngb_tooltip_custom_class sampleJson">{{item.key}}</span> </div>
                    <div class="col-6 m-0 align-items-center" *ngIf="showEditTraitInput !== index">
                        <div class="utterances-count" *ngIf="item.data.length">{{item.data.length}} {{item.data.length>1?'Utterances':'Utterance'}}</div>
                        <div class="add-utt-title" *ngIf="!item.data.length" (click)="openAddUtteranceModel(index,item.key,item.data)">
                            <img src="assets/icons/add_blue.svg">Add utterances
                        </div> 
                    </div>
                    <div class="col-2 action-btns pr-1" *ngIf="showEditTraitInput !== index">
                        <ng-container>
                            <!-- <img src="assets/icons/add_blue.svg" (click)="openAddUtteranceModel(index,item.key,item.data)" placement="top-center" container='body' ngbTooltip="Add Utterance" tooltipClass="ngb_tooltip_custom_class sampleJson">                       -->
                            <img src="assets/icons/edit-pencil.svg" id="btn_edit_traits" placement="top-center" container='body' ngbTooltip="Edit Trait Name" tooltipClass="ngb_tooltip_custom_class sampleJson" (click)="showEditTrait(index, $event)">
                            <img src="assets/icons/delete-table.svg" (click)="deleteTraitInGroup(item.key,traits.addEditTraits,$event,index)" id="btn_delete_traits" placement="top-center" container='body' ngbTooltip="Delete Trait & Utterances" tooltipClass="ngb_tooltip_custom_class sampleJson">
                        </ng-container>
                    </div> 
                    <div class="kr-sg-input-text add-traits-input mb-0" *ngIf="showEditTraitInput == index" (click)="$event.stopImmediatePropagation()">              
                        <input autocomplete="off" type="text" maxlength="60" placeholder="Type and Enter to Add Traits " class="input-text shadow-none input-h-40 pl-3" #traitValue [(ngModel)]="item.key"(keyup.enter)="editTraits(item.key,$event,item.displayName)">
                        <img class="check-icon" *ngIf="item.key" src="assets/icons/check_green.svg" [ngClass]="{'pr-22':item.key}" (click)="$event.stopImmediatePropagation();editTraits(item.key,$event,item.displayName)" placement="top-center" container='body' ngbTooltip="Save" tooltipClass="ngb_tooltip_custom_class sampleJson" >
                        <img class="close-icon" *ngIf="item.key" src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':item.key}" (click)="$event.stopImmediatePropagation();item.key=item.displayName;showEditTraitInput=null;" placement="top-center" container='body' ngbTooltip="Cancel" tooltipClass="ngb_tooltip_custom_class sampleJson" >
                    </div>
                </div>                    
            </ng-container>
        </div>
    </perfect-scrollbar>
    <div class="modal-footer">
        <button class="kr-sg-button-primary btn_lg" (click)="saveTraits(traits.addEditTraits)">Save</button>
        <button class="kr-sg-button-secondary btn_lg"  (click)="closeStatusModal()">Cancel</button>
    </div>
</kr-modal> 

<kr-modal modalType="center" #addUtteranceModalPop modalClass="modal_popups_ add-utterances-modal">
    <div class="modal-header">
        <div class="title">{{traits.addEditTraits.groupName}} <img src="assets/icons/carrotright.svg"> {{currentTraitKey}} <img src="assets/icons/carrotright.svg"> Utterance</div>
        <div class="close_icon" (click)='closeUtteranceModal()'><img src="assets/icons/modal-close.svg"></div>
    </div>
    <perfect-scrollbar class="perfect-scroll-modal-body">
        <div class="modal-body">
            <ng-container >
                <div class="content-body-traits row col-12" *ngFor="let utterance of utteranceList;let i = index;" [ngClass]="{'py-0':(showEditUtteranceInput == i)}">
                    <div class="kr-sg-input-text add-traits-input" *ngIf="showEditUtteranceInput == i">
                        <input autocomplete="off" maxlength="60" type="text" placeholder="Type and Enter to Add Utterances" class="input-text pl-3 shadow-none input-h-40" (keyup)='editUtter($event,utterance,i)' [(ngModel)]='utterance' name='utteranceName'>
                        <img class="check-icon" *ngIf="utterance" src="assets/icons/check_green.svg" [ngClass]="{'pr-22':utterance}" (click)="editUtter($event,utterance,i)" placement="top-center" container='body' ngbTooltip="Save" tooltipClass="ngb_tooltip_custom_class sampleJson" >
                        <img class="close-icon" *ngIf="utterance" src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':utterance}" (click)="utterance=tempUtterance;showEditUtteranceInput = null;showUtteranceInput = false;" placement="top-center" container='body' ngbTooltip="Cancel" tooltipClass="ngb_tooltip_custom_class sampleJson">
                    </div>

                    <div class="col-10 group-name" *ngIf="showEditUtteranceInput !== i">{{utterance}}</div>  
                    <div class="col-2 action-btns pr-1"  *ngIf="showEditUtteranceInput !== i">                        
                        <img src="assets/icons/edit-pencil.svg" placement="top-center" container='body' ngbTooltip="Edit" tooltipClass="ngb_tooltip_custom_class sampleJson" (click)="showEditUtteranceInput = i;showUtteranceInput = false;tempUtterance=utterance">
                        <img src="assets/icons/delete-table.svg" placement="top-center" container='body' ngbTooltip="Delete" tooltipClass="ngb_tooltip_custom_class sampleJson" (click)="deleteUtterance(utterance,$event)">
                    </div> 
                </div> 
                <div class="add-utt-title" *ngIf="!showUtteranceInput  && !showEditUtteranceInput && showEditUtteranceInput !== 0" (click)="showUtteranceInput = true;">
                    <img src="assets/icons/add_blue.svg" >Add utterances
                </div>                  
            </ng-container>
            <div class="kr-sg-input-text add-traits-input" *ngIf="showUtteranceInput">
                <input  maxlength="60" type="text" autocomplete="off" placeholder="Type and Enter to Add Utterances" class="input-text" (keyup)='addNewUtter(newUtterance,$event)' [(ngModel)]='newUtterance' name='utteranceName' [ngClass]="{'err-block' : ((!utteranceList || !utteranceList.length) && uttSubmitted)}">
                <img class="check-icon" *ngIf="newUtterance" src="assets/icons/check_green.svg" [ngClass]="{'pr-22':newUtterance}" (click)="addNewUtter(newUtterance,$event)" placement="top-center" container='body' ngbTooltip="Save" tooltipClass="ngb_tooltip_custom_class sampleJson" >
                <img class="close-icon" *ngIf="newUtterance" src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':newUtterance}" (click)="newUtterance='';showUtteranceInput=false;"  placement="top-center" container='body' ngbTooltip="Cancel" tooltipClass="ngb_tooltip_custom_class sampleJson">
                <img *ngIf="(!utteranceList || !utteranceList.length) && uttSubmitted" id="utteranceNameWarning" src="assets/icons/warning_escalation.svg" style="top: 31%; position: absolute; right: 1.5%; display: block;" [ngStyle]="{'right':newUtterance.length?'7.5%':'1.5%'}" height="12" width="12" />
            </div>
        </div>
    </perfect-scrollbar>
    <div class="modal-footer">
        <button class="kr-sg-button-primary btn_lg" (click)="addNewUtterance(currentTraitKey,traits.addEditTraits,currentUtteranceIndex)">Add</button>
        <button class="kr-sg-button-secondary btn_lg"  (click)="closeUtteranceModal()">Cancel</button>
    </div>
</kr-modal> 


