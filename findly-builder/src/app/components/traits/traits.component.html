<div class="traits-container p-0">
    <div class="mainLoadingSpinner" *ngIf="loadingTraits" >
        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
        <span class="please-wait-message">{{'Please Wait!' | translate}}</span>
    </div>
    <ng-container *ngIf="loadingTraits1">  
    <!-- NO DATA FOUND -->
        <ng-container *ngIf="!(traits.traitGroups &&  traits.traitGroups.length)">
            <perfect-scrollbar class="empty-scroll">
                <div  class="empty-landing-screen" >
                <div class="img-block"*ngIf="!emptyItems"><img class="action_icon" (load)="imageLoad()" src="assets/images/traits-empty.svg"></div>
                <ng-container *ngIf="loadImageText">
                    <div class="empty-title">You havenâ€™t added any Traits yet!</div>
                    <div class="desc-text"> Traits are specific entities, attributes or details that the users express in their conversations.  Traits present in the utterance can be used in driving the intent detection and bot conversation flows. SearchAssist allows you to define Traits and train the utterances.
                    </div>
                    <div class="kr-sg-dropdowns" #selectSourceDrop='ngbDropdown' ngbDropdown [container]="'body'">                                         
                        <div class="dropdown dropdown-open">
                            <button class='kr-sg-button-primary btn_lg px-3' (click)='createNewTraits()'>Add Traits</button>
                        
                    </div>                                    
                    </div>
                </ng-container>
                <ng-container *ngIf="noItems && emptySearchResults">
                    <div class="desc-text">Your Search Query doesn't match with any record.</div>
                </ng-container>
                </div>
            </perfect-scrollbar>
        </ng-container>


   


    <!-- TABLE CONTENT -->
    <div class="traits" *ngIf="traits.traitGroups &&  traits.traitGroups.length">
        <div class="kr-sg-multi-line-notification d-none">
            <div class="bulb-icon"><img src="assets/images/24x29-bulbicon.png"></div>
            <div class="tost-text">Please click on 'Train' button to update your traits model with the latest
                changes.
                Your bot will identify the traits using latest changes only after the training is completed.</div>
            <button class="kr-sg-button-primary ml-2" (click)="trainBot()">Train Traits</button>
        </div> 
        
        
        <div class="table-list-content" *ngIf="traits.traitGroups &&  traits.traitGroups.length">                         
            <div class="seach_add_feild">
                <div class="title">Traits</div>
                <div class="d-flex align-items-center">
                    <div class="kr-sg-input-search m-0" [ngClass]="{'active': showSearch}">                               
                        <input type="text" placeholder="Search" autocomplete="off" class="input-search" name='searchSources' placeholder="Search" id="fieldSearchId" [(ngModel)]="serachTraits">           
                    </div> 
                    <div class="seach-block" (click)="toggleSearch()"><img *ngIf="!showSearch" src="assets/icons/search.svg"><img *ngIf="showSearch" src="assets/images/close.svg">Search</div>
                    <div class="add_feild" (click)="createNewTraits()"><img src="assets/icons/add_plus.svg"> Add Traits</div>
                    <button class="kr-sg-button-primary btn_lg" (click)="trainIndex()">Train Index</button>
                </div>
            </div>  
            <div class="trailts-table-header row">
                <div class="col-2 title">TRAIT GROUP</div>
                <div class="col-9 title">TRAITS</div>
            </div>                 
            <perfect-scrollbar class="traits-scroll-data">
                <div class="traits-body-sec">
                    <div class="content-body row col-12 m-0" *ngFor="let traitGroup of  traits.traitGroups | traitsFilter:serachTraits; let index = index">
                        <div class="col-2 traitGroup-name" title="{{traitGroup.groupName || '---'}}">{{traitGroup.groupName || '---'}}</div>
                        <div class="col-8 traits-groups row m-0 align-items-center">
                            <span *ngFor="let trait of traitGroup.traits| slice:0:getTraitsSliceValue(traitGroup.traits); let i=index;" class="trait-more">
                                {{i!==0 ?', ':''}}{{trait.traitName || '---'}}
                            </span>   
                            
                                      <!-- <span class="trait-count-container" *ngIf="traitGroup.traits.length>5" >
                                <span class="trait-count ml-3">+{{traitGroup.traits.length-5}}</span>
                                <div class="execute-log">
                                    <div class="header-title">
                                        <div class="close-log"><img src="assets/images/close.svg" (click)="traitsCount = false"></div>
                                    </div>
                                    <ng-container *ngFor="let trait of traitGroup.traits| slice:5:(traitGroup.traits.length);">
                                      <div class="log-details">
                                        {{trait.traitName || '---'}}
                                      </div>
                                    </ng-container>
                                </div>


                            </span>   -->

                            <div class="kr-sg-dropdowns traits-more-data-container" ngbDropdown [placement]="'right-top'" *ngIf="traitGroup.traits.length>getTraitsSliceValue(traitGroup.traits)">
                                <div class="dropdown dropdown-open">
                                    <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopPropagation()"> +{{traitGroup.traits.length-getTraitsSliceValue(traitGroup.traits)}}</button>
                                    <ul class="dropdown-menu content-menu traits-more-data-container-dropdown" ngbDropdownMenu>
                                       <div class="inner-content">
                                            <div class="close-dropdown">
                                                <img src="assets/icons/close-dropdown.svg">
                                            </div>
                                            <perfect-scrollbar class="more-traits-scroll">
                                                <li *ngFor="let trait of traitGroup.traits| slice:getTraitsSliceValue(traitGroup.traits):(traitGroup.traits.length);" title="{{trait.traitName || '---'}}" class="text-truncate">
                                                    {{trait.traitName || '---'}}
                                                </li>
                                            </perfect-scrollbar>
                                       </div>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-2 action-links">
                            <img src="assets/icons/edit-pencil.svg" class="mr-4" (click)="editTraitFroup(traitGroup)" id="btn_edit_traits" placement="top-center" container='body' ngbTooltip="Edit" tooltipClass="ngb_tooltip_custom_class sampleJson">
                            <img src="assets/icons/delete-table.svg"(click)="deleteTraitsGroup(index,traitGroup,$event)"  id="btn_delete_traits" placement="top-center" container='body' ngbTooltip="Delete" tooltipClass="ngb_tooltip_custom_class sampleJson">
                        </div> 
                    </div>
                    <div class="divBlockEmptylastChild text-center">         
                        <div class="desc">No search results found</div>
                    </div>
                </div>
            </perfect-scrollbar>
        </div>
    </div>
    <!-- CREATE NEW TRAIT MODAL-->
    </ng-container>
</div>



<kr-modal modalType="center" modalClass="addTraitModalComponent" #statusModalPop>
    <div class="modal-header">
        <div class="header-title" (click)='closeStatusModal()'><img src="assets/images/closeCross.png"
                class="closeCross">
            {{(traits.addEditTraits._id)?'Edit':'Create New'}}
        </div>
    </div>
    <perfect-scrollbar class="traits-modal-scroller">
        <div class="modal-body traits-modal-popup">

            <div class="kr-sg-input-text">
                <div class="label-text">Trait Group</div>
                <p class="text">Provide a name that represents group of traits. System will try to identify the
                    closest
                    trait in the group from user utterances.
                    Example - 'vehicle type', 'device type'.
                </p>
                <input type="text" autocomplete="off" placeholder="Enter Trait Group" class="input-text" maxlength="120" [(ngModel)]="traits.addEditTraits.groupName">
            </div>
            <div class="kr-sg-input-text">
                <div class="label-text">Traits</div>
                <p class="text">Add one or more traits and provide the required training sentences. E.g. 'car',
                    'bus', 'modem', 'router'.
                </p>
                <input autocomplete="off" type="text" placeholder="Type & Enter To Add" class="input-text" maxlength="120" #traitValue [(ngModel)]="add.traitName"
                    (keyup.enter)="addTraits(add.traitName,$event)">
            </div>
            <div class="traits-group" *ngIf="traits.addEditTraits && traits.addEditTraits.traitsArray && traits.addEditTraits.traitsArray.length">
                <ng-container *ngFor="let item of traits.addEditTraits.traitsArray;let index = index;">
                    <div class="traits-header" (click)="accordianAction(index)">
                        <span class="icon">
                            <img [ngClass]="{'expanded': (currentTraitEditIndex === index)}" src="assets/images/arrow.svg" class="ml-1">
                        </span>
                        <div class="title">
                            {{item.key}}
                            <span class="edit-icon">
                                <img src="assets/images/icons/edit-black.svg" class="ml-1">
                            </span>
                            <span class="delete-icon" (click)="deleteTraitInGroup(item.key,traits.addEditTraits,$event,index)">
                                <img src="assets/images/trashIcon.svg" class="ml-1 ">
                            </span>
                        </div>
                    </div>
                    <div class="add-utterances" *ngIf="currentTraitEditIndex === index">
                        <div class="sub-title">
                            Add utterances or phrases
                        </div>
                        <div class="kr-sg-input-text">
                            <input  maxlength="2048" type="text" autocomplete="off" placeholder="Add Utterance" class="input-text"
                            (keyup)='addUtterance(item.utterance,item.key,$event,traits.addEditTraits,index)' [(ngModel)]='item.utterance'
                            name='traitName'>
                        </div>
                        <div class="utterance-list" *ngIf="item.data && item.data.length">
                            <ng-container *ngFor="let utterance of item.data; let uIndex = index;">
                                <div class="item">
                                    {{utterance}}
                                    <span class="delete-icon" (click)="$event.stopPropagation();deleteUtteranceIntrait(utterance,item.key,traits.addEditTraits,index)">
                                        <img src="assets/images/trashIcon.svg" class="ml-1 ">
                                    </span>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </perfect-scrollbar>

    <div class="modal-footer">
        <button class="kr-sg-button-primary btn_lg" [disabled]="!traits.addEditTraits.groupName" (click)="saveTraits(traits.addEditTraits)">Save</button>
        <button class="kr-sg-button-secondary btn_lg"  (click)="closeStatusModal()">Cancel</button>
    </div>
</kr-modal>