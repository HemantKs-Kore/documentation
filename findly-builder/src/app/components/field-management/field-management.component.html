<div class="fieldManagementComponent">
    <div class="mainLoadingSpinner" *ngIf="loadingContent" >
        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
        <span class="please-wait-message">Please Wait!</span>
    </div>
    <div class="table_sec" *ngIf="!loadingContent" >
            <div class="seach_add_feild">
                <div class="title">Fields</div>
                <div class="d-flex align-items-center">
                    <div class="kr-sg-input-search m-0" [ngClass]="{'active': showSearch}">                               
                        <input type="text" placeholder="Search" autocomplete="off" class="input-search" name='searchSources' placeholder="Search" id="fieldSearchId" [(ngModel)]="searchFields">           
                    </div> 
                    <div class="seach-block" (click)="toggleSearch()"><img *ngIf="!showSearch" src="assets/icons/search.svg"><img *ngIf="showSearch" src="assets/images/close.svg">Search</div>
                    <div class="add_feild" (click)="addEditFiled()"><img src="assets/icons/add_plus.svg">Add Field</div>
                </div>
            </div> 
            <div class="empty-list"  *ngIf="!(filelds && filelds.length)">
                <ng-container>
                    <img src="assets/images/icons/empty_ill.svg">
                    <div class="desc">No fields available</div>
                </ng-container>
            </div>     
            <div>
                <div class="table_data_content" *ngIf="filelds && filelds.length">
                    <div class="table_header row m-0">
                        <div class="col_ col-2 title d-flex align-items-center"  (click)="sortBy('fieldName')">
                            <span class="d-flex align-items-center flex-column mr-1">
                                <img [ngClass]="getSortIconVisibility('fieldName', 'down')" src="assets/icons/caretDown.svg" class="ml-1 sortImg downArrow">
                                <img [ngClass]="getSortIconVisibility('fieldName', 'up')" src="assets/icons/caretDown.svg" class="ml-1 sortImg upArrow">
                              </span>
                            Field Name</div>
                        <div class="col_  col-2 title d-flex align-items-center" (click)="sortBy('fieldDataType')">
                            <span class="d-flex align-items-center flex-column mr-1">
                                <img [ngClass]="getSortIconVisibility('fieldDataType', 'down')" src="assets/icons/caretDown.svg" class="ml-1 sortImg downArrow">
                                <img [ngClass]="getSortIconVisibility('fieldDataType', 'up')" src="assets/icons/caretDown.svg" class="ml-1 sortImg upArrow">
                              </span>
                            Type 
                            <div class=" ml-2 kr-sg-dropdowns type_sort_dropdown" #sourceFilter="ngbDropdown" ngbDropdown [container]="'body'"
                            [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                              <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopImmediatePropagation()">
                         
                                <img class="custom-dropdown-toggle-icon" src="assets/icons/Vector.svg">
                              </button>
                              <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                <li (click)="sourceFilter.close();filterTable('all','fieldDataType')"><span class="list-name">All</span><img
                                    [ngClass]="{'hide': filterSystem.typefilter !== 'all'}" src="assets/icons/check-blue.svg"></li>
                                <li *ngFor="let fieldDataType of fieldDataTypeArr" (click)="sourceFilter.close();filterTable(fieldDataType,'fieldDataType')">
                                  <span
                                    class="list-name">{{fieldDataType | translate}}</span><img
                                    [ngClass]="{'hide': filterSystem.typefilter !== fieldDataType}" src="assets/icons/check-blue.svg"></li>
                              </ul>
                            </div>
                        </div>
                        </div>
                        <div class="col_  col-2 title d-flex align-items-center"  (click)="sortBy('isMultiValued')">
                            <span class="d-flex align-items-center flex-column mr-1">
                                <img [ngClass]="getSortIconVisibility('isMultiValued', 'down')" src="assets/icons/caretDown.svg" class="ml-1 sortImg downArrow">
                                <img [ngClass]="getSortIconVisibility('isMultiValued', 'up')" src="assets/icons/caretDown.svg" class="ml-1 sortImg upArrow">
                              </span>
                            Multi-Value
                            <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #selectFilter="ngbDropdown" ngbDropdown [container]="'body'"
                            [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopImmediatePropagation()">
                                    <img class="custom-dropdown-toggle-icon" src="assets/icons/Vector.svg">
                                </button>
                                <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                    <li (click)="selectFilter.close();filterTable('all','isMultiValued')"><span class="list-name">All</span><img
                                            [ngClass]="{'hide': filterSystem.isMultiValuedFilter !== 'all'}" src="assets/icons/check-blue.svg"></li>
                                    <li *ngFor="let docType of isMultiValuedArr" (click)="selectFilter.close();filterTable(docType,'isMultiValued')">
                                        <span
                                            class="list-name">{{docType == false ? 'No' :(docType == true? 'Yes': '')}}</span><img
                                            [ngClass]="{'hide': filterSystem.isMultiValuedFilter !== docType}" src="assets/icons/check-blue.svg"></li>
                                </ul>
                            </div>
                        </div>
                        </div>
                        <div class="col_  col-2 title d-flex align-items-center"  (click)="sortBy('isRequired')">
                            <span class="d-flex align-items-center flex-column mr-1">
                                <img [ngClass]="getSortIconVisibility('isRequired', 'down')" src="assets/icons/caretDown.svg" class="ml-1 sortImg downArrow">
                                <img [ngClass]="getSortIconVisibility('isRequired', 'up')" src="assets/icons/caretDown.svg" class="ml-1 sortImg upArrow">
                              </span>
                            Required
                            <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #isRequiredFilter="ngbDropdown" ngbDropdown [container]="'body'"
                            [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopImmediatePropagation()">
                                    <img class="custom-dropdown-toggle-icon" src="assets/icons/Vector.svg">
                                </button>
                                <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                    <li (click)="isRequiredFilter.close();filterTable('all','isRequired')"><span class="list-name">All</span><img
                                            [ngClass]="{'hide': filterSystem.isRequiredFilter !== 'all'}" src="assets/icons/check-blue.svg"></li>
                                    <li *ngFor="let docType of isRequiredArr" (click)="isRequiredFilter.close();filterTable(docType,'isRequired')">
                                        <span
                                            class="list-name">{{docType == false ? 'No' :(docType == true? 'Yes': '')}}</span><img
                                            [ngClass]="{'hide': filterSystem.isRequiredFilter !== docType}" src="assets/icons/check-blue.svg"></li>
                                </ul>
                            </div>
                        </div>
                        </div>
                        <div class="col_  col-2 title d-flex align-items-center"  (click)="sortBy('isStored')">
                            <span class="d-flex align-items-center flex-column mr-1">
                                <img [ngClass]="getSortIconVisibility('isStored', 'down')" src="assets/icons/caretDown.svg" class="ml-1 sortImg downArrow">
                                <img [ngClass]="getSortIconVisibility('isStored', 'up')" src="assets/icons/caretDown.svg" class="ml-1 sortImg upArrow">
                              </span>
                            Stored
                            <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #isStoredFilter="ngbDropdown" ngbDropdown [container]="'body'"
                            [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopImmediatePropagation()">
                                    <img class="custom-dropdown-toggle-icon" src="assets/icons/Vector.svg">
                                </button>
                                <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                    <li (click)="isStoredFilter.close();filterTable('all','isStored')"><span class="list-name">All</span><img
                                            [ngClass]="{'hide': filterSystem.isStoredFilter !== 'all'}" src="assets/icons/check-blue.svg"></li>
                                    <li *ngFor="let docType of isStoredArr" (click)="isStoredFilter.close();filterTable(docType,'isStored')">
                                        <span
                                            class="list-name">{{docType == false ? 'No' :(docType == true? 'Yes': '')}}</span><img
                                            [ngClass]="{'hide': filterSystem.isStoredFilter !== docType}" src="assets/icons/check-blue.svg"></li>
                                </ul>
                            </div>
                        </div>
                        </div>
                        <div class="col_  col-2 title d-flex align-items-center"  (click)="sortBy('isIndexed')">
                            <span class="d-flex align-items-center flex-column mr-1">
                                <img [ngClass]="getSortIconVisibility('isIndexed', 'down')" src="assets/icons/caretDown.svg" class="ml-1 sortImg downArrow">
                                <img [ngClass]="getSortIconVisibility('isIndexed', 'up')" src="assets/icons/caretDown.svg" class="ml-1 sortImg upArrow">
                              </span>
                            Indexed
                            <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #isIndexedFilter="ngbDropdown" ngbDropdown [container]="'body'"
                            [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle (click)="$event.stopImmediatePropagation()">
                                    <img class="custom-dropdown-toggle-icon" src="assets/icons/Vector.svg">
                                </button>
                                <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                    <li (click)="isIndexedFilter.close();filterTable('all','isIndexed')"><span class="list-name">All</span><img
                                            [ngClass]="{'hide': filterSystem.isIndexedFilter !== 'all'}" src="assets/icons/check-blue.svg"></li>
                                    <li *ngFor="let docType of isIndexedArr" (click)="isIndexedFilter.close();filterTable(docType,'isIndexed')">
                                        <span
                                            class="list-name">{{docType == false ? 'No' :(docType == true? 'Yes': '')}}</span><img
                                            [ngClass]="{'hide': filterSystem.isIndexedFilter !== docType}" src="assets/icons/check-blue.svg"></li>
                                </ul>
                            </div>
                        </div>
                        </div>
                    </div>
                    <perfect-scrollbar class="table_body_content">
                        <div class="table_body row m-0" *ngFor="let field of filelds | fieldsFilter: [ searchFields, 'fieldName']">
                            <div class="col-2 title">{{field.fieldName}}</div>
                            <div class="col-2 title">{{field.fieldDataType | translate}}</div>
                            <div class="col-2 title">{{field.isMultiValued?'Yes':'No'}}</div>
                            <div class="col-2 title">{{field.isRequired?'Yes':'No'}}</div>
                            <div class="col-2 title">{{field.isStored?'Yes':'No'}}</div>
                            <div class="col-2 title">{{field.isIndexed?'Yes':'No'}}
                                <div class=" action_links text-right">
                                    <img src="assets/images/edit-pencil.svg" (click)="addEditFiled(field)">
                                    <img src="assets/icons/delete-table.svg" class="ml-3" (click)="deleteFieldPop(field)">
                                </div>
                            </div>
                           
                        </div>
                        <div class="divBlockEmptylastChild text-center">         
                            <div class="desc">No search results found</div>
                        </div> 
                    </perfect-scrollbar>  
                </div>
               
            </div>      
            
     </div>
</div>

<kr-modal modalType="center" modalClass="modal_popups_ addFieldModalPop smallModal"  #addFieldModalPop>   
    <div class="modal-header">
        <div class="title">{{(newFieldObj && newFieldObj._id)?'Edit Field':'Add Field'}}</div>
        <div class="close_icon" (click)="closeModalPopup()"><img src="assets/icons/modal-close.svg"></div>
    </div>
    <ng-container *ngIf="newFieldObj">
    <perfect-scrollbar class="perfect-scroll-modal-body">
    <div class="modal-body textAlignLeft">
        <div class="top_sec" >
            <div class="row m-0 mb-20">
                <div class="kr-sg-input-text col-12 p-0">
                    <div class="label-text">Field Name</div>
                    <!-- <input type="number" *ngIf="newFieldObj.fieldDataType === 'number'"  placeholder="Field name" class="input-text" [(ngModel)]="newFieldObj.fieldName"> -->
                    <input type="text" placeholder="Field name" class="input-text" [(ngModel)]="newFieldObj.fieldName">
                </div>
            </div>
            <div class="label-text col-12 p-0">Field Type</div>
            <div class="row m-0 align-items-center">                         
                <div class="kr-sg-dropdowns col-12 p-0">                    
                    <div class="dropdown dropdown-open">
                        <button class="dropdown-toggle dropdown-input" data-toggle="dropdown" data-boundary="window">{{(newFieldObj.fieldDataType?newFieldObj.fieldDataType:'choose_an_option') | translate}}</button>                                            
                        <ul class="dropdown-menu content-menu">                                                                    
                          <li  (click)="selectFieldType('string')"><a>String</a></li>
                          <li  (click)="selectFieldType('number')"><a>Number</a></li>
                          <li  (click)="selectFieldType('trait')"><a>Trait</a></li>
                          <li  (click)="selectFieldType('dense_vector')"><a>Dense Vector</a></li>
                          <li  (click)="selectFieldType('entity')"><a>Entity</a></li>
                          <li  (click)="selectFieldType('keyword')"><a>Keyword</a></li>
                          <li  (click)="selectFieldType('array')"><a>Array</a></li>
                          <li  (click)="selectFieldType('object')"><a>Object</a></li>
                        </ul>
                    </div>
                </div>
                <div class="kr-sg-checkbox col-2 pl-5 pr-0 m-0 d-none">
                    <input id="checkbox-1" class="checkbox-custom" type="checkbox" [(ngModel)]="newFieldObj.isDynamic">
                    <label for="checkbox-1" class="checkbox-custom-label">Dynamic</label>
                </div>  
            </div>
        </div>
        <div class="bottom_sec">
            <div class="group-checkbox mb-3">
                <div class="label-text mb-2">Select ones that apply</div>
                <div class="kr-sg-checkbox">
                    <input id="checkbox_grpfd" class="checkbox-custom" type="checkbox" [(ngModel)]="newFieldObj.isMultiValued">
                    <label for="checkbox_grpfd" class="checkbox-custom-label">Multi-Valued</label>
                </div>
                <div class="kr-sg-checkbox">
                    <input id="checkbox_grpf" class="checkbox-custom" type="checkbox" [(ngModel)]="newFieldObj.isRequired">
                    <label for="checkbox_grpf" class="checkbox-custom-label">Required</label>
                </div>
                <div class="kr-sg-checkbox">
                    <input id="checkbox_grpd" [disabled]="newFieldObj.isIndexed" class="checkbox-custom" type="checkbox" [(ngModel)]="newFieldObj.isStored">
                    <label for="checkbox_grpd" class="checkbox-custom-label">Stored</label>
                </div>
                <div class="kr-sg-checkbox">
                    <input id="checkbox_grpe" class="checkbox-custom" type="checkbox" [(ngModel)]="newFieldObj.isIndexed" (change)="newFieldObj.isIndexed?(newFieldObj.isStored=true):return">
                    <label for="checkbox_grpe" class="checkbox-custom-label">Indexed</label>
                </div>
            </div>
            <div class="kr-sg-input-text col-10 p-0  d-none">
                <div class="label-text">Default Value (Optional)</div>
                <input type="text" placeholder="Add value here" class="input-text" [(ngModel)]="newFieldObj.defaultValue">
            </div>
            <div class="kr-sg-inline-notification" *ngIf="!newFieldObj.isIndexed">
                <div class="bulb-icon"><img src="assets/icons/info-blue.svg"></div>
                <div class="tost-text">Indexed Property has been set to False. This will impact facet and Business Rules.</div>                                   
            </div>
            <div class="kr-sg-inline-notification" *ngIf="newFieldObj._id && (newFieldObj.previousFieldDataType !== newFieldObj.fieldDataType)">
                <div class="bulb-icon"><img src="assets/icons/info-blue.svg"></div>
                <div class="tost-text">The field type has been changed from {{newFieldObj.previousFieldDataType | translate}} to {{newFieldObj.fieldDataType | translate}}. This will impact the facet configuration.</div>                                   
            </div>
        </div>
    </div>
    </perfect-scrollbar> 
    <div class="modal-footer text-left">
        <button type="button" [disabled]="!(newFieldObj.fieldName) || !(newFieldObj.fieldDataType)" class="kr-sg-button-primary btn_lg float-right" (click)="addField()">{{newFieldObj._id?'Save':'Add'}}</button>                   
        <button type="button" class="kr-sg-button-secondary btn_lg float-right" (click)="closeModalPopup()">Cancel</button>
    </div>    
</ng-container>
</kr-modal>