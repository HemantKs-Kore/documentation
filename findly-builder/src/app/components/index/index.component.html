<app-useronboarding-journey #onboard [componentType]='componentType'></app-useronboarding-journey>

<div class="workbench_main_container">
  <div class="mainLoadingSpinner" *ngIf="loadingContent">
    <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
    <span class="please-wait-message">Please Wait!</span>
  </div>
  <div class="header_sec">
    <!-- <div class="title">Index Configuration</div> -->
    <div class="title" >Index Configuration</div> <!-- (click)="openModalPopup()" -->
    <div class="btn_sec">
      <button class="kr-sg-button-secondary btn_lg" [disabled]="savingConfig" (click)="saveConfig()">
        {{ savingConfig ? "Saving..." : "Save Configuration" }}
      </button>
      <!-- <button class="kr-sg-button-primary btn_lg" [disabled]='reIndexing' (click)="reindex()">{{(reIndexing)?'Re-Indexing..':'Re-Index'}}</button> -->
    </div>
  </div>
  <div class="split_section_stage_table" *ngIf="!loadingContent">
    <div class="stage_sec">
      <div class="stage_header">
        <div class="title">Stages
          <span class="tooltip-custom-data">
            <img src="assets/icons/help_gray.svg">
            <span class="tooltip-custom_">
              <div class="title-data">Transform the incoming data into optimized documents using Index Pipeline Stages</div>
              <div class="learn_more">Learn More</div>
            </span>
          </span>
        </div>
        <div class="add" (click)="showNewStageType=true;selectedStage={};" placement="bottom-right" 
          [disableTooltip]="pipeline && pipeline.length" #tleft="ngbTooltip" triggers="manual"
          (mouseenter)="tleft.open()" ngbTooltip="Click here to get started by adding a stage" [container]="'body'"
          tooltipClass="custom_tooltip_class">
          <img src="assets/icons/add_plus.svg" /><span id="addToolTo"
            (click)="$event.stopPropagation(); tleft.open()"></span>
        </div>
      </div>
      <perfect-scrollbar class="scroll_stage_content">
        <ng-container>
          <div *ngIf="showNewStageType">
            <div class="field_data active cdk-drag"  >
              <div class="drag_drop_icon">
                <img src="assets/icons/drog_drop.svg" />
              </div>
              <div class="stateIcon" >
                <img src="assets/images/activeStage.svg" />
              </div>
              <div class="title text-truncate">Choose Stage Type</div>
              <div class="close_icon" (click)="closeNewStage()">
                <img src="assets/icons/close_field.svg" />
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="pipeline && pipeline.length">
          <div cdkDropList (cdkDropListDropped)="drop($event, pipeline)">
            <div (click)="selectStage(pipe, i)" class="field_data" *ngFor="let pipe of pipeline; let i = index" cdkDrag
              [ngClass]="{
                active: selectedStage && selectedStage?.name === pipe?.name,
                runningActive:
                  simulteObj &&
                  simulteObj.simulationInprogress &&
                  simulteObj.currentSimulateAnimi === i,
                runningActive2:
                  simulteObj &&
                  simulteObj.simulationInprogress &&
                  simulteObj.currentSimulateAnimi === i - 1,
                allRunningActive: simulteObj && i < simulteObj.totalStages
              }">
              <div class="field_data" *cdkDragPreview>
                <div class="title text-truncate"></div>
              </div>
              <div class="drag_drop_icon">
                <img src="assets/icons/drog_drop.svg" />
              </div>
              <div class="stateIcon" *ngIf="pipe?.enable">
                <img src="assets/images/activeStage.svg" />
              </div>
              <div class="stateIcon" *ngIf="!pipe?.enable">
                <img src="assets/images/inActiveStage.svg" />
              </div>
              <div class="title text-truncate">{{ pipe?.name }}</div>
              <div class="close_icon" (click)="removeStage(i,pipe?.name)">
                <img src="assets/icons/close_field.svg" />
              </div>
            </div>
          </div>
        </ng-container>
      </perfect-scrollbar>
    </div>
    <div class="table_sec" *ngIf="!(selectedStage && selectedStage.type) && !showNewStageType">
      <div class="empty-list">
        <ng-container>
          <img src="assets/images/icons/empty_ill.svg" />
          <!-- <div class="heading">No Stages</div> -->
          <div class="desc">No Stages available</div>
        </ng-container>
      </div>
    </div>
    <div class="form_sec"  *ngIf="showNewStageType">
      <perfect-scrollbar class="scroll_form">
        <div class="form_edit_content">
          <div class="d-flex m-0 col-12 p-0">
            <div class="kr-sg-dropdowns mb-20 pr-4 pl-0">
              <div class="label-text">
                Stage Type
              </div>
              <div class="dropdown dropdown-open">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                  {{
                  (selectedStage.type
                  ? selectedStage.type
                  : "choose_stage_type"
                  ) | translate
                  }}
                </button>
                <ul class="dropdown-menu content-menu">
                  <li *ngFor="
                      let systemStage of defaultStageTypes;
                      let index = index
                    " (click)="switchStage(systemStage, index);">
                    <a *ngIf="newMappingObj[systemStage.type]">{{
                      systemStage.type | translate
                      }}</a>
                  </li>
                </ul>
              </div>
            </div>
          
          </div>
         
        </div>
      </perfect-scrollbar>
    </div>
    <div class="form_sec" *ngIf="selectedStage && selectedStage.type && !showNewStageType">
      <perfect-scrollbar class="scroll_form">
        <div class="form_edit_content">
          <div class="d-flex m-0 col-12 p-0">
            <div class="kr-sg-dropdowns mb-20 pr-4 pl-0">
              <div class="label-text">
                Stage Type
                <!-- <span tooltipClass="tooltip_custom" ngbTooltip="Select an appropriate stage to create and transform pipeline document objects" tooltipClass="workbench_tolltips m-0" placement="right-center" container="body" class="pl-1"><img src="assets/icons/help_gray.svg"/></span> -->
              </div>
              <div class="dropdown dropdown-open" [ngClass]="{ disabled: selectedStage._id }">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                  {{
                  (selectedStage.type
                  ? selectedStage.type
                  : "choose_stage_type"
                  ) | translate
                  }}
                </button>
                <ul class="dropdown-menu content-menu">
                  <li *ngFor="
                      let systemStage of defaultStageTypes;
                      let index = index
                    " (click)="switchStage(systemStage, index)">
                    <a *ngIf="newMappingObj[systemStage.type]">{{
                      systemStage.type | translate
                      }}</a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="stageToggle">
              <label class="kr-sg-toggle">
                <input type="checkbox" checked [(ngModel)]="selectedStage.enable" />
                <div class="slider">
                  <span class="enabled">Stage Active</span><span class="disabled">Stage Inactive</span>
                </div>
              </label>
            </div>
          </div>
          <div class="kr-sg-input-text mb-20">
            <div class="label-text">
              Stage Name
              <img container="body" placement="right-center" ngbTooltip="Give Stage Name of your choice to create multiple stages with the same Stage Type" tooltipClass="workbench_tolltips m-0" class="pl-1" src="assets/icons/help_gray.svg" />
            </div>
            <input type="text" placeholder="Please Enter Stage Name" (keyup)="changesDetected = true" autocomplete="off"
              class="input-text" [(ngModel)]="selectedStage.name" />
          </div>
          <div class="kr-sg-input-text mb-2">
            <div class="label-text">
              Add Condition
              <span class="tooltip-custom-data">
                <img src="assets/icons/help_gray.svg">
                <span class="tooltip-custom_ width-245">
                  <div class="title-data">Documents that satisfy the condition will be executed as part of the stage. You can define condition in Painless Script
                  </div>
                  <div class="learn_more">Learn More</div>
                </span>
              </span>
            </div>
            <input type="text" placeholder="Define Condition" (keyup)="changesDetected = true" autocomplete="off"
              class="input-text" [(ngModel)]="selectedStage.condition" />
              <!-- <div class="text-primary py-2" *ngIf="selectedStage.type === 'exclude_document'"><img class="pl-1 pr-2" src="assets/icons/info-blue.svg" /> It is mandatory to add conditions for defining the Exclude Document stage.</div> -->
          </div>
          <div class="add-condition-example-text">Eg: ctx.sysContentType=="faq"</div>
          <div class="add-condition-info" *ngIf="selectedStage.type === 'exclude_document'">
            <img src="assets/icons/Info_blue.svg">It is mandatory to add conditions for defining the Exclude Document stage.
          </div>

        </div>
        <div class="form_inputs_data" *ngIf="selectedStage.type === 'field_mapping'">
          <ng-container *ngIf="
              selectedStage &&
              selectedStage.config &&
              selectedStage.config.mappings &&
              selectedStage.config.mappings.length
            ">
            <div cdkDropList (cdkDropListDropped)="drop($event, selectedStage.config.mappings)">
              <div class="row m-0 form_list" *ngFor="let map of selectedStage.config.mappings; let i = index" cdkDrag>
                <div *cdkDragPreview class="drag_drop">
                  
                </div>
                <div class="drag_drop">
                  <img src="assets/icons/drag_drop_move_icon.svg" />
                </div>
                <div class="kr-sg-dropdowns col-4 input-box">
                  <div class="label-text">Action</div>
                  <div class="dropup dropdown-open">
                    <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                      {{
                      (map.operation ? map.operation : "choose_an_option")
                      | translate
                      }}
                    </button>
                    <ul class="dropdown-menu content-menu">
                      <li (click)="
                          setRuleObj(map, 'operation', 'set', 'field_mapping')
                        ">
                        <a>Set</a>
                      </li>
                      <li (click)="
                          setRuleObj(
                            map,
                            'operation',
                            'rename',
                            'field_mapping'
                          )
                        ">
                        <a>Rename</a>
                      </li>
                      <li (click)="
                          setRuleObj(map, 'operation', 'copy', 'field_mapping')
                        ">
                        <a>Copy</a>
                      </li>
                      <li (click)="
                          setRuleObj(
                            map,
                            'operation',
                            'remove',
                            'field_mapping'
                          )
                        ">
                        <a>Remove</a>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="kr-sg-input-text col-4 input-box"
                  *ngIf="map.operation === 'copy' || map.operation === 'rename'">
                  <div class="label-text" *ngIf="map.operation === 'copy'">
                    Source Field
                  </div>
                  <div class="label-text" *ngIf="map.operation === 'rename'">
                    Field Name
                  </div>
                  <input type="text" placeholder="Enter Target" (keyup)="changesDetected = true" class="input-text"
                    [(ngModel)]="map.source_field" />
                </div>
                <div class="kr-sg-input-text col-4 input-box">
                  <div class="label-text" *ngIf="map.operation === 'copy'">
                    Target Filed
                  </div>
                  <div class="label-text" *ngIf="map.operation === 'rename'">
                    New Name
                  </div>
                  <div class="label-text" *ngIf="
                      map.operation !== 'copy' && map.operation !== 'rename'
                    ">
                    Field Name
                  </div>
                  <input type="text" placeholder="Enter Target" (keyup)="changesDetected = true" class="input-text"
                    [(ngModel)]="map.target_field" />
                </div>
                <div class="kr-sg-input-text col-4 input-box" (keyup)="changesDetected = true" *ngIf="
                    map.operation !== 'remove' &&
                    map.operation !== 'copy' &&
                    map.operation !== 'rename'
                  ">
                  <div class="label-text">Value</div>
                  <input type="text" placeholder="Value" class="input-text" [(ngModel)]="map.value" />
                </div>
                <div class="delete_icon" (click)="removeConfig(i, selectedStage.config.mappings)">
                  <img src="assets/icons/delete-table.svg" />
                </div>
              </div>
            </div>
          </ng-container>
          <div class="row m-0 form_list" *ngIf="
              newMappingObj &&
              newMappingObj.field_mapping &&
              newMappingObj.field_mapping.defaultValue
            ">
            <div class="kr-sg-dropdowns col-4 input-box">
              <div class="label-text">Action</div>
              <div class="dropup dropdown-open">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                  {{
                  (newMappingObj.field_mapping.defaultValue.operation
                  ? newMappingObj.field_mapping.defaultValue.operation
                  : "choose_an_option"
                  ) | translate
                  }}
                </button>
                <ul class="dropdown-menu content-menu">
                  <li (click)="
                      setRuleObj(
                        newMappingObj.field_mapping.defaultValue,
                        'operation',
                        'set',
                        'field_mapping'
                      )
                    ">
                    <a>Set</a>
                  </li>
                  <li (click)="
                      setRuleObj(
                        newMappingObj.field_mapping.defaultValue,
                        'operation',
                        'rename',
                        'field_mapping'
                      )
                    ">
                    <a>Rename</a>
                  </li>
                  <li (click)="
                      setRuleObj(
                        newMappingObj.field_mapping.defaultValue,
                        'operation',
                        'copy',
                        'field_mapping'
                      )
                    ">
                    <a>Copy</a>
                  </li>
                  <li (click)="
                      setRuleObj(
                        newMappingObj.field_mapping.defaultValue,
                        'operation',
                        'remove',
                        'field_mapping'
                      )
                    ">
                    <a>Remove</a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="kr-sg-input-text col-4 input-box" *ngIf="
                newMappingObj.field_mapping.defaultValue.operation === 'copy' ||
                newMappingObj.field_mapping.defaultValue.operation === 'rename'
              ">
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation === 'copy'
                ">
                Source Field
              </div>
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation ===
                  'rename'
                ">
                Field Name
              </div>
              <input type="text" placeholder="Enter Source Field" (keyup)="changesDetected = true" class="input-text"
                [(ngModel)]="
                  newMappingObj.field_mapping.defaultValue.source_field
                " />
            </div>
            <div class="kr-sg-input-text col-4 input-box">
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation === 'copy'
                ">
                Target Filed
              </div>
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation ===
                  'rename'
                ">
                New Name
              </div>
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation !==
                    'copy' &&
                  newMappingObj.field_mapping.defaultValue.operation !==
                    'rename'
                ">
                Field Name
              </div>
              <input type="text" placeholder="Enter Name" class="input-text" [(ngModel)]="
                  newMappingObj.field_mapping.defaultValue.target_field
                " />
            </div>
            <div class="kr-sg-input-text col-4 input-box" *ngIf="
                newMappingObj.field_mapping.defaultValue.operation !==
                  'remove' &&
                newMappingObj.field_mapping.defaultValue.operation !== 'copy' &&
                newMappingObj.field_mapping.defaultValue.operation !== 'rename'
              ">
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation !==
                  'rename'
                ">
                Value
              </div>
              <div class="label-text" *ngIf="
                  newMappingObj.field_mapping.defaultValue.operation ===
                  'rename'
                ">
                New Name
              </div>
              <input type="text" placeholder="Value" class="input-text"
                [(ngModel)]="newMappingObj.field_mapping.defaultValue.value" />
            </div>
            <div class="colse_form">
              <img (click)="setResetNewMappingsObj()" src="assets/images/close-cross.svg" />
            </div>
            <div class="add_icon" (click)="
                addFiledmappings(newMappingObj.field_mapping.defaultValue)
              ">
              <img src="assets/images/add-input-field.svg" />
            </div>
          </div>
        </div>
        <div class="form_inputs_data" *ngIf="
            selectedStage.type === 'entity_extraction' ||
            selectedStage.type === 'traits_extraction' ||
            selectedStage.type === 'keyword_extraction' ||
            selectedStage.type === 'semantic_meaning'
          ">
          <ng-container *ngIf="
              selectedStage &&
              selectedStage.config &&
              selectedStage.config.mappings &&
              selectedStage.config.mappings.length
            ">
            <div cdkDropList (cdkDropListDropped)="drop($event, selectedStage.config.mappings)">
              <div class="row m-0 form_list form_list_drag"
                *ngFor="let map of selectedStage.config.mappings; let i = index" cdkDrag>
                <div *cdkDragPreview class="drag_drop">
                
                </div>
                <div class="drag_drop">
                  <img src="assets/icons/drag_drop_move_icon.svg" />
                </div>
                <div class="kr-sg-input-text col-4 input-box">
                  <div class="label-text">Source Field</div>
                  <input type="text" placeholder="Value" (keyup)="changesDetected = true" class="input-text"
                    [(ngModel)]="map.source_field" />
                </div>
                <div class="kr-sg-dropdowns col-4 input-box" *ngIf="selectedStage.type === 'semantic_meaning'">
                  <div class="label-text">Choose Model</div>
                  <div class="dropup dropdown-open">
                    <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                      {{ map.model ? map.model : "Choose Model" }}
                    </button>
                    <ul class="dropdown-menu content-menu">
                      <li (click)="map.model = 'Universal Sentence Encoder'" ngbTooltip="Universal Sentence Encoder" placement="top-left">
                        <a>Universal Sentence Encoder</a>
                      </li>
                      <li (click)="map.model = 'Sentence Transformers'" ngbTooltip="Sentence Transformers" placement="top-left">
                        <a>Sentence Transformers</a>
                      </li>
                      <li (click)="map.model = 'InferSent'" ngbTooltip="InferSent" placement="top-left">
                        <a>InferSent</a>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="kr-sg-dropdowns col-4 input-box" *ngIf="selectedStage.type === 'keyword_extraction'">
                  <div class="label-text">Choose Model</div>
                  <div class="dropup dropdown-open">
                    <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                      {{ map.model ? map.model : "Choose Model" }}
                    </button>
                    <ul class="dropdown-menu content-menu">
                      <li (click)="map.model = 'topic_rank'" >
                        <a>Topic Rank</a>
                      </li>
                      <li (click)="map.model = 'position_rank'">
                        <a>Position Rank</a>
                      </li>
                      <li (click)="map.model = 'multipartite_rank'">
                        <a>Multipartite Rank</a>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="kr-sg-input-text col-4 input-box" *ngIf="
                    !(selectedStage.type === 'keyword_extraction') &&
                    !(selectedStage.type === 'semantic_meaning')
                  ">
                  <div class="label-text" *ngIf="selectedStage.type === 'entity_extraction'">
                    Add Entities
                    <img class="ml-1" tooltipClass="workbench_tolltips m-0"
                      ngbTooltip="Entities to be identified from the source field" [container]="'body'"
                      src="assets/icons/help_gray.svg" />
                  </div>
                  <div class="label-text" *ngIf="selectedStage.type === 'traits_extraction'">
                    Add Trait Groups
                    <img class="ml-1" tooltipClass="workbench_tolltips m-0"
                      ngbTooltip="Traits to be identified from the source field" [container]="'body'"
                      src="assets/icons/help_gray.svg" />
                  </div>
                  <div class="label-text" *ngIf="selectedStage.type === 'keyword_extraction'">
                    Choose Kwywords
                  </div>
                  <ng-container *ngIf="selectedStage.type === 'entity_extraction'">
                    <mat-form-field class="example-chip-list" [floatLabel]="'never'">
                      <mat-chip-list #chipList [attr.aria-label]="'tag selection'">
                        <mat-chip *ngFor="let entity of map.entity_types" [selectable]="true" [removable]="true"
                          (removed)="removeEntityList(map, entity)"><span class="mat-val" *ngIf="entity">{{
                            entity | translate
                            }}</span>
                          <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                        </mat-chip>
                        <input placeholder="Type and Enter" [matChipInputFor]="chipList"
                          [matAutocomplete]="suggestedItems" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                          [matChipInputAddOnBlur]="false" (matChipInputTokenEnd)="addEntityList($event, map)"
                          #suggestedInput />
                      </mat-chip-list>
                      <mat-autocomplete #suggestedItems="matAutocomplete"
                        (optionSelected)="selectedTag($event, map.entity_types)">
                        <ng-container *ngFor="let suggestion of entityNlp">
                          <mat-option [value]="suggestion.value">
                            {{ suggestion.title }}
                          </mat-option>
                        </ng-container>
                      </mat-autocomplete>
                    </mat-form-field>
                  </ng-container>
                  <ng-container *ngIf="selectedStage.type === 'traits_extraction'">
                    <mat-form-field class="example-chip-list" [floatLabel]="'never'">
                      <mat-chip-list #chipList>
                        <mat-chip *ngFor="let entity of map.trait_groups" [selectable]="true" [removable]="true"
                          (removed)="removeTraitsList(map, entity)"><span class="mat-val" *ngIf="entity">{{
                            entity
                            }}</span>
                          <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                        </mat-chip>
                        <input placeholder="Type and Enter" [matChipInputFor]="chipList"
                          [matAutocomplete]="suggestedItems" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                          [matChipInputAddOnBlur]="false" (matChipInputTokenEnd)="addTraitsList($event, map)"
                          #suggestedInput />
                      </mat-chip-list>
                      <mat-autocomplete #suggestedItems="matAutocomplete"
                        (optionSelected)="selectedTag($event, map.trait_groups)">
                        <ng-container *ngFor="let suggestion of traitsSuggesitions">
                          <mat-option [value]="suggestion">
                            {{ suggestion }}
                          </mat-option>
                        </ng-container>
                      </mat-autocomplete>
                    </mat-form-field>
                  </ng-container>
                </div>
                <div class="kr-sg-input-text col-4 input-box">
                  <div class="label-text">Target Field</div>
                  <input type="text" placeholder="Value" (keyup)="changesDetected = true" class="input-text"
                    [(ngModel)]="map.target_field" />
                </div>
                <div class="delete_icon" (click)="removeConfig(i, selectedStage.config.mappings)">
                  <img src="assets/icons/delete-table.svg" />
                </div>
              </div>
            </div>
          </ng-container>

          <div class="row m-0 form_list" *ngIf="
              newMappingObj[selectedStage.type] &&
              newMappingObj[selectedStage.type].defaultValue
            ">
            <div class="kr-sg-input-text col-4 input-box">
              <div class="label-text">Source Field</div>
              <input type="text" placeholder="Value" class="input-text" [(ngModel)]="
                  newMappingObj[selectedStage.type].defaultValue.source_field
                " />
            </div>
            <div class="kr-sg-dropdowns col-4 input-box" *ngIf="selectedStage.type === 'semantic_meaning'">
              <div class="label-text">Choose Model</div>
              <div class="dropup dropdown-open">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">{{newMappingObj[selectedStage.type].defaultValue.model? newMappingObj[selectedStage.type].defaultValue.model: "Choose Model"}}</button>
                <ul class="dropdown-menu content-menu">
                  <li (click)="newMappingObj[selectedStage.type].defaultValue.model ='Universal Sentence Encoder'"> <a>Universal Sentence Encoder</a></li>
                  <li (click)="newMappingObj[selectedStage.type].defaultValue.model ='Sentence Transformers'"><a>Sentence Transformers</a></li>
                  <li (click)="newMappingObj[selectedStage.type].defaultValue.model ='InferSent'"><a>InferSent</a></li>
                </ul>
              </div>
            </div>
            <div class="kr-sg-dropdowns col-4 input-box" *ngIf="selectedStage.type === 'keyword_extraction'">
              <div class="label-text">Choose Model</div>
              <div class="dropup dropdown-open">
                <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
                  {{newMappingObj[selectedStage.type].defaultValue.model? newMappingObj[selectedStage.type].defaultValue.model: "Choose Model"}}
                </button>
                <ul class="dropdown-menu content-menu">
                  <li (click)="newMappingObj[selectedStage.type].defaultValue.model ='topic_rank'"><a>Topic Rank</a></li>
                  <li (click)="newMappingObj[selectedStage.type].defaultValue.model ='position_rank'"><a>Position Rank</a></li>
                  <li (click)="newMappingObj[selectedStage.type].defaultValue.model ='multipartite_rank'"><a>Multipartite Rank</a></li>
                </ul>
              </div>
            </div>
            <div class="kr-sg-input-text col-4 input-box" *ngIf="
                !(selectedStage.type === 'keyword_extraction') &&
                !(selectedStage.type === 'semantic_meaning')
              ">
              <div class="label-text" *ngIf="selectedStage.type === 'entity_extraction'">
                Add Entities
                <img class="ml-1" tooltipClass="workbench_tolltips m-0"
                  ngbTooltip="Entities to be identified from the source field" [container]="'body'"
                  src="assets/icons/help_gray.svg" />
              </div>
              <div class="label-text" *ngIf="selectedStage.type === 'traits_extraction'">
                Add Trait Groups
                <img class="ml-1" tooltipClass="workbench_tolltips m-0"
                  ngbTooltip="Traits to be identified from the source field" [container]="'body'"
                  src="assets/icons/help_gray.svg" />
              </div>
              <div class="label-text" *ngIf="selectedStage.type === 'keyword_extraction'">
                Choose Kwywords
              </div>
              <ng-container *ngIf="selectedStage.type === 'entity_extraction'">
                <mat-form-field class="example-chip-list" [floatLabel]="'never'">
                  <mat-chip-list #chipList>
                    <mat-chip *ngFor="
                        let entity of newMappingObj[selectedStage.type]
                          .defaultValue.entity_types
                      " [selectable]="true" [removable]="true" (removed)="
                        removeEntityList(
                          newMappingObj[selectedStage.type].defaultValue,
                          entity
                        )
                      "><span class="mat-val" *ngIf="entity">{{
                        entity | translate
                        }}</span>
                      <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                    </mat-chip>
                    <input placeholder="Type and Enter" [matChipInputFor]="chipList" [matAutocomplete]="suggestedItems"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="false"
                      (matChipInputTokenEnd)="
                        addEntityList(
                          $event,
                          newMappingObj[selectedStage.type].defaultValue
                        )
                      " #suggestedInput />
                  </mat-chip-list>
                  <mat-autocomplete #suggestedItems="matAutocomplete" (optionSelected)="
                      selectedTag(
                        $event,
                        newMappingObj[selectedStage.type].defaultValue
                          .entity_types
                      )
                    ">
                    <ng-container *ngFor="let suggestion of entityNlp">
                      <mat-option [value]="suggestion.value">
                        {{ suggestion.title }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-container>
              <ng-container *ngIf="selectedStage.type === 'traits_extraction'">
                <mat-form-field class="example-chip-list" [floatLabel]="'never'">
                  <mat-chip-list #chipList>
                    <mat-chip *ngFor="
                        let entity of newMappingObj[selectedStage.type]
                          .defaultValue.trait_groups
                      " [selectable]="true" [removable]="true" (removed)="
                        removeTraitsList(
                          newMappingObj[selectedStage.type].defaultValue,
                          entity
                        )
                      "><span class="mat-val" *ngIf="entity">{{ entity }}</span>
                      <mat-icon matChipRemove><img src="assets/images/close.svg" /></mat-icon>
                    </mat-chip>
                    <input placeholder="Type and Enter" [matChipInputFor]="chipList"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matAutocomplete]="suggestedItems"
                      [matChipInputAddOnBlur]="false" (matChipInputTokenEnd)="
                        addTraitsList(
                          $event,
                          newMappingObj[selectedStage.type].defaultValue
                        )
                      " #suggestedInput />
                  </mat-chip-list>
                  <mat-autocomplete #suggestedItems="matAutocomplete" (optionSelected)="
                      selectedTag(
                        $event,
                        newMappingObj[selectedStage.type].defaultValue
                          .trait_groups
                      )
                    ">
                    <ng-container *ngFor="let suggestion of traitsSuggesitions">
                      <mat-option [value]="suggestion">
                        {{ suggestion }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-form-field>
              </ng-container>
            </div>
            <div class="kr-sg-input-text col-4 input-box">
              <div class="label-text">Target Field</div>
              <input type="text" placeholder="Value" class="input-text" [(ngModel)]="
                  newMappingObj[selectedStage.type].defaultValue.target_field
                " />
            </div>
            <div class="colse_form">
              <img (click)="setResetNewMappingsObj()" src="assets/images/close-cross.svg" />
            </div>
            <div class="add_icon" (click)="
                addFiledmappings(newMappingObj[selectedStage.type].defaultValue)
              ">
              <img src="assets/images/add-input-field.svg" />
            </div>
          </div>
        </div>
        <div class="form_inputs_data" *ngIf="selectedStage.type === 'custom_script'">
          <div class="customScript">
            <div class="kr-sg-input-text-area">
              <div class="label-text">&lt;/&gt;Painless</div>
              <textarea placeholder="Please Enter Script" class="input-text" (keyup)="
                  addCustomScript(
                    newMappingObj.custom_script.defaultValue.script
                  )
                " [(ngModel)]="newMappingObj.custom_script.defaultValue.script"></textarea>
            </div>
          </div>
        </div>
      </perfect-scrollbar>
      <div class="footer-simulate-form simulatebtnContainer">
        <span class="float-right"><button class="kr-sg-button-primary btn_lg mr-0" id="simulateBtn" (click)="simulate()" placement="top-right"
            tooltipClass="workbench_tolltips m-0" [disabled]="simulteObj.simulating"
            ngbTooltip="Simulate to check how the changes reflect in the documents before saving">
            <img src="assets/images/simulate.svg" class="mr-1" />{{
            simulteObj.simulating ? "Simulating.." : "Simulate"
            }}
          </button> 
        </span>
      </div>
    </div> 
  </div>
  <div class="simulator-div" *ngIf="simulteObj && simulteObj.showSimulation">
    <div class="header">
      <div class="title">Simulator</div>
      <div class="close_icon">
        <img src="assets/images/close.svg" (click)="closeSimulator()" />
      </div>
    </div>
    <div class="row m-0 input-boxes">
      <div class="kr-sg-dropdowns col-6 pl-0 pr-2">
        <div class="label-text">Source</div>
        <div class="dropdown dropdown-open">
          <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
            {{
              (simulteObj.sourceType
              ? (simulteObj.sourceType == 'faq'? 'FAQ': (simulteObj.sourceType =='data'?'Data':(simulteObj.sourceType =='all'?'All':(simulteObj.sourceType =='file'?'File':(simulteObj.sourceType =='web'?'Web':simulteObj.sourceType)))))
              : "choose_an_option"
              ) | translate
              }}
          </button>
          <ul class="dropdown-menu content-menu">
            <li (click)="changeSimulate('all', 'source')"><a>All</a></li>
            <li (click)="changeSimulate('faq', 'source')"><a>FAQ</a></li>
            <li (click)="changeSimulate('web', 'source')"><a>Web</a></li>
            <li (click)="changeSimulate('file', 'source')"><a>File</a></li>
            <li (click)="changeSimulate('data', 'source')"><a>Data</a></li>
          </ul>
        </div>
      </div>
      <div class="kr-sg-dropdowns col-6 pr-0 pl-2">
        <div class="label-text">Number of Documents</div>
        <div class="dropdown dropdown-open">
          <button class="dropdown-toggle dropdown-input" data-toggle="dropdown">
            {{
            (simulteObj.docCount
            ? simulteObj.docCount + " Documents"
            : "choose_an_option"
            ) | translate
            }}
          </button>
          <ul class="dropdown-menu content-menu">
            <li (click)="changeSimulate(5, 'doc')"><a>5 Documents</a></li>
            <li (click)="changeSimulate(10, 'doc')"><a>10 Documents</a></li>
            <li (click)="changeSimulate(20, 'doc')"><a>20 Documents</a></li>
          </ul>
        </div>
      </div>
    </div>
    <perfect-scrollbar class="content_body">
      <div *ngIf="simulateJson">
        <ngx-codemirror [(ngModel)]="simulateJson" [options]="codeMirrorOptions">
        </ngx-codemirror>
      </div>
    </perfect-scrollbar>
  </div>
</div>
<kr-modal modalType="center" modalClass="modal_popups_ addFieldModalPop addFieldCheckBox" #addFieldModalPop>
  <div class="modal-header">
    <div class="title">
      Choose the fields you would like to add and define properties
    </div>
    <div class="close_icon" (click)="closeModalPopup()">
      <img src="assets/icons/modal-close.svg" />
    </div>
  </div>
  <ng-container>
    <perfect-scrollbar class="perfect-scroll-modal-body">
      <div class="mainLoadingSpinner" *ngIf="loadingFields">
        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
        <span class="please-wait-message">Please Wait!</span>
      </div>
      <div class="table_sec" *ngIf="!newfieldsData.length && !loadingFields">
        <div class="empty-list">
          <ng-container>
            <img src="assets/images/icons/empty_ill.svg" />
            <!-- <div class="heading">No Stages</div> -->
            <div class="desc">No Stages available</div>
          </ng-container>
        </div>
      </div>
      <div class="modal-body textAlignLeft" *ngIf="!loadingFields && newfieldsData.length">
        <!-- DATA TABLE START HERE -->
        <div class="kr-sg-data-table">
          <section class="table-content">
            <header class="table-header">
              <div class="col">
                <div class="kr-sg-checkbox">
                  <input id="fieldIsActiveAll" class="checkbox-custom" [(ngModel)]="isActiveAll" (change)="selectAll()"
                    type="checkbox" />
                    <label for="fieldIsActiveAll" class="checkbox-custom-label px-0">
                Field Name
              </label>
            </div>
              </div>
              <div class="col">Type</div>
              <div class="col text-center">Multi-Value</div>
              <div class="col text-center">Required</div>
              <div class="col text-center">Stored</div>
              <div class="col text-center">Indexed</div>
            </header>
            <div class="content-body" *ngFor="let field of newfieldsData; let i = index">
              <div class="col">
                <div class="kr-sg-checkbox">
                  <input id="fieldIsActive{{ i }}" class="checkbox-custom" [(ngModel)]="field.isActive" (change)="selectSingle(field.isActive)"
                    type="checkbox" />
                  <label for="fieldIsActive{{ i }}" class="checkbox-custom-label">{{ field.fieldName }}</label>
                </div>
              </div>
              <div class="col">{{ field.fieldDataType | translate }}</div>
              <div class="col text-center">
                <div class="kr-sg-checkbox">
                  <input id="fieldMultiValue{{ i }}" class="checkbox-custom" [(ngModel)]="field.isMultiValued"  [disabled]="!field.isActive"
                    type="checkbox" />
                  <label for="fieldMultiValue{{ i }}" class="checkbox-custom-label" [ngClass]="{'gray-checkbox':!field.isActive}"></label>
                </div>
              </div>
              <div class="col text-center">
                <div class="kr-sg-checkbox">
                  <input id="field.isRequired{{ i }}" class="checkbox-custom" [(ngModel)]="field.isRequired"  [disabled]="!field.isActive"
                    type="checkbox" />
                  <label for="field.isRequired{{ i }}" class="checkbox-custom-label" [ngClass]="{'gray-checkbox':!field.isActive}"></label>
                </div>
              </div>
              <div class="col text-center">
                <div class="kr-sg-checkbox">
                  <input id="field.isStored{{ i }}" class="checkbox-custom"  [(ngModel)]="field.isStored" [disabled]="!field.isActive" (change)='(field.isStored)?field.isIndexed = true:field.isIndexed = false'
                    type="checkbox" />
                  <label for="field.isStored{{ i }}" class="checkbox-custom-label" [ngClass]="{'gray-checkbox':!field.isActive}"></label>
                </div>
              </div>
              <div class="col text-center">
                <div class="kr-sg-checkbox">
                  <input id="field.isIndexed{{ i }}" class="checkbox-custom"  (change)='(field.isIndexed)?field.isStored = true:false' [(ngModel)]="field.isIndexed" [disabled]="!field.isActive"
                    type="checkbox" />
                  <label for="field.isIndexed{{ i }}" class="checkbox-custom-label" [ngClass]="{'gray-checkbox':!field.isActive}"></label>
                </div>
              </div>
            </div>
          </section>
        </div>
        <!-- DATA TABLE ENDS HERE -->
      </div>
    </perfect-scrollbar>
    <div class="modal-footer text-left">
      <button type="button" [disabled]="loadingFields" class="kr-sg-button-primary btn_lg float-right"
        (click)="addField()">
        {{ "Add" }}
      </button>
      <button type="button" class="kr-sg-button-secondary btn_lg float-right" (click)="closeModalPopup()">
        Cancel
      </button>
    </div>
  </ng-container>
</kr-modal>