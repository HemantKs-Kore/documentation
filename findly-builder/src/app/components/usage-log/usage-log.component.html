<div class="invoice-container">
    <div class="mainLoadingSpinner" *ngIf="loading">
        <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
        <span class="please-wait-message">{{'sa_please_wait' | translate}}</span>
    </div>
    <div class="header-sec">
        <app-useronboarding-journey [componentType]='componentType'></app-useronboarding-journey>
        <div class="title">{{"ussageLog_ussageLog"| translate}}
            <span class="module-topic" tooltipClass="tooltip-global-" [container]="'body'" ngbTooltip='{{"sa_topic_guide" | translate}}' 
 placement="right-center"(click)="openUserMetaTagsSlider()">
                <i class="si-topic-guide-1"></i>
            </span>
        </div>
        <div class="d-flex align-items-center"
            *ngIf="searchUsageLog || usageLogs?.length || searchLoading || showSearch">
            <div class="kr-sg-input-search" [ngClass]="{'d-none': !showSearch}">
                <input type="text" placeholder="{{'sa_search' | translate}}" class="input-search" id="inputSearch"
                    [ngClass]="{'pl-33':!searchUsageLog, 'pl-2':searchUsageLog}" autocomplete="off" autofocus
                    [(ngModel)]="searchUsageLog" (keyup)="searchUsageLogs()"
                    (mouseover)="searchImgSrc = (searchFocusIn ? 'assets/icons/search_gray.svg' :'assets/icons/search_gray_dark.svg')"
                    (mouseout)="searchFocusIn=false;searchImgSrc = 'assets/icons/search_gray.svg'"
                    (focus)="searchFocusIn=true;searchImgSrc = 'assets/icons/search_gray.svg'">
                <img [src]="searchImgSrc" class="search-icon" *ngIf="!searchUsageLog">
                <img class="close-icon" (mouseover)="activeClose=true" (mouseout)="activeClose=false"
                    src="assets/icons/close_icon.svg" [ngClass]="{'pr-22':searchUsageLog}" (click)="focusoutSearch()">
            </div>
            <div class="seach-block">
                <span [ngClass]="{'d-none': showSearch}" class="mr-3" id="btn_toggle_search_structured_data"
                    (click)="toggleSearch();focusinSearch('inputSearch')"><img src="assets/icons/search.svg"
                        [ngClass]="{'d-none': showSearch}">{{'sa_search' | translate}}</span>
            </div>
            <div class="download-icon" tooltipClass="tooltip_custom margin-10" placement="bottom-right" container='body'
                ngbTooltip="{{'ussageLog_download_log' | translate}}" (click)="exportUsageLog()">
                <img src="assets/icons/usage-log/download.svg">
            </div>
        </div>
    </div>

    <ng-container *ngIf="!usageLogs.length && !loading && !searchUsageLog && !showSearch">
        <app-empty-screen class="empty-lg" [width]="150" [height]="132" [title]="emptyScreen.TITLE" [desc]="emptyScreen.DESC" [imgName]="emptyScreen.IMG_NAME">
        </app-empty-screen>
        <!-- <div class="empty-usage-log">
            <div class="img-block">
                <img src="assets/icons/usage-log/empty-log.png">
            </div>
            <div class="empty-text">{{"ussageLog_usage_log_will_appear_once_the_app_is_active" | translate}}</div>
        </div> -->
    </ng-container>
    <ng-container *ngIf="(usageLogs.length && !loadingLogs) || searchUsageLog || showSearch">
        <div class="plan-type">
            <div class="current-plan">{{"ussageLog_current_plan"| translate}}</div>
            <div class="type">{{current_plan_name}}</div>
        </div>
        <perfect-scrollbar class="scroll-invoice-content">
            <div class="table_data_content">
                <div class="table_header row m-0">
                    <div class="col_ col-4 title d-flex align-items-center">
                        {{"ussageLog_search_query"| translate}}
                    </div>
                    <div class="col_ col-3 title d-flex align-items-center" (click)="sortBy('queryType')">
                        <span class="d-flex align-items-center flex-column mr-1">
                            <img [ngClass]="getSortIconVisibility('queryType', 'down')" src="assets/icons/caretDown.svg"
                                class="ml-1 sortImg downArrow">
                            <img [ngClass]="getSortIconVisibility('queryType', 'up')" src="assets/icons/caretDown.svg"
                                class="ml-1 sortImg upArrow">
                        </span>
                        {{"ussageLog_type"| translate}}
                        <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #queryTypeFilter="ngbDropdown" ngbDropdown
                            [container]="'body'" [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle
                                    (click)="$event.stopImmediatePropagation()">
                                    <img class="custom-dropdown-toggle-icon" src="assets/icons/type-select-dropdown.svg">
                                </button>
                                <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                    <li (click)="queryTypeFilter.close();filterTable('all','queryType')">
                                        <span class="list-name">{{"ussageLog_all"| translate}}</span>
                                        <img [ngClass]="{'hide': filterSystem.queryTypeFilter !== 'all'}"
                                            src="assets/icons/check-blue.svg">
                                    </li>
                                    <li *ngFor="let queryType of queryTypeArr"
                                        (click)="queryTypeFilter.close();filterTable(queryType,'queryType')">
                                        <span class="list-name">{{queryType}}</span><img
                                            [ngClass]="{'hide': filterSystem.queryTypeFilter !== queryType}"
                                            src="assets/icons/check-blue.svg">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col_ col-3 title d-flex align-items-center" (click)="sortBy('results')">
                        <span class="d-flex align-items-center flex-column mr-1">
                            <img [ngClass]="getSortIconVisibility('results', 'down')" src="assets/icons/caretDown.svg"
                                class="ml-1 sortImg downArrow">
                            <img [ngClass]="getSortIconVisibility('results', 'up')" src="assets/icons/caretDown.svg"
                                class="ml-1 sortImg upArrow">
                        </span>
                        {{"ussageLog_results_caps"| translate}}
                        <div class="ml-2 kr-sg-dropdowns type_sort_dropdown" #resultsFilter="ngbDropdown" ngbDropdown
                            [container]="'body'" [autoClose]="true" [placement]="'bottom-right'">
                            <div class="dropdown dropdown-open">
                                <button class="dropdown-toggle dropdown-input" ngbDropdownToggle
                                    (click)="$event.stopImmediatePropagation()">
                                    <img class="custom-dropdown-toggle-icon" src="assets/icons/type-select-dropdown.svg">
                                </button>
                                <ul class="dropdown-menu content-menu type_sort_dropdown-content" ngbDropdownMenu>
                                    <li (click)="resultsFilter.close();filterTable('all','results')">
                                        <span class="list-name">{{"ussageLog_all"| translate}}</span>
                                        <img [ngClass]="{'hide': filterSystem.resultsFilter !== 'all'}"
                                            src="assets/icons/check-blue.svg">
                                    </li>
                                    <li *ngFor="let docType of resultsArr"
                                        (click)="resultsFilter.close();filterTable(docType,'results')">
                                        <span class="list-name">{{docType?'Yes':'No'}}</span><img
                                            [ngClass]="{'hide': filterSystem.resultsFilter !== docType}"
                                            src="assets/icons/check-blue.svg">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col_ col-2 title d-flex align-items-center" (click)="sortBy('createdOn')">
                        <span class="d-flex align-items-center flex-column mr-1">
                            <img [ngClass]="getSortIconVisibility('createdOn', 'down')" src="assets/icons/caretDown.svg"
                                class="ml-1 sortImg downArrow">
                            <img [ngClass]="getSortIconVisibility('createdOn', 'up')" src="assets/icons/caretDown.svg"
                                class="ml-1 sortImg upArrow">
                        </span>
                        {{"ussageLog_date_&_time"| translate}}
                    </div>
                </div>

                <ng-container *ngIf="usageLogs.length; else noUsageLogs">
                    <div class="table_body row" *ngFor="let usageLog of usageLogs">
                        <div class="col-4 title search-query-data">
                            <div class="img-block">
                                <img src="assets/icons/usage-logs/info-img.svg">
                            </div>
                            <div class="content-sec">{{usageLog.query}}</div>
                        </div>
                        <div class="col-3 title pl-4">{{usageLog.queryType}}</div>
                        <!-- <div class="col-2 title pl-3">{{usageLog.requestSource}}</div> -->
                        <div class="col-3 title pl-4">{{usageLog.results?'Yes':'No'}}</div>
                        <div class="col-2 title pl-4">{{usageLog.createdOn | dateFormatPipe: 'DD MMM YYYY h:mm a'}}
                        </div>
                    </div>
                </ng-container>
                <ng-template #noUsageLogs>
                    <app-empty-screen class="empty-lg" [width]="100" [height]="88" *ngIf="searchUsageLog && !loading" [title]="emptyScreen.TITLE_SEARCH" [desc]="emptyScreen.DESC_SEARCH" [imgName]="emptyScreen.IMG_NAME">
                    </app-empty-screen> 
                </ng-template>
                <app-record-pagination *ngIf="totalRecord && totalRecord>10" [totalRecord]='totalRecord'
                    [limitpage]='10' (pageChanged)="paginate($event)"></app-record-pagination>
            </div>
        </perfect-scrollbar>
    </ng-container>
</div>