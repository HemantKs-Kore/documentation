<div class="pricing-container-wrapper">
  <div class="title-header d-flex align-items-center justify-content-between">
    <div>{{"plan.plan_head"| translate}}</div>
    <div class="btns-block">
    <button class="kr-sg-button-secondary btn_lg mr-2" *ngIf="(currentSubscriptionPlan?.subscription?.planName|lowercase)!=='free'" (click)="cancelSubscriptionModal('open')"><i class="si-minus-circle-o"></i>Cancel Subscription</button>
    <button class="kr-sg-button-primary btn_lg" (click)="selectModal('choose_plan')"><i class="si-publish si-icon"></i>Upgrade Plan</button>
    </div>
  </div>
    <div class="info-note proInfo proInfoSuccess row m-0 d-none">
      <div class="col-10 d-flex align-items-center p-0">
        <span class="info-proTip-icon"><i class="si-green-check"></i></span>
        <span class="info-text">Your previous payment of $100 is processed successfully. You can Publish your bot now to upgrade to the Standard plan.</span>
      </div>
      <div class="close-info col-2 text-right">
        <span class="info-proTip-close" (click)="proInfo=true"><i class="si-close"></i></span>
      </div>
    </div>
  <perfect-scrollbar class="pricing-scroll">
    <div class="pricing-details-main-sec">
       <div class="row col-12 m-0 tile-block">
          <div class="col-4 tile-left">
            <div class="tile-header">
              <span class="pr-1"><i class="si-instructions"></i></span>  Current Plan details
            </div>
            <div class="tile-plan-overview">

              <div class="tile-current-plan">
                <div class="tile-plan-details">
                  <div class="plan-type">{{currentSubscriptionPlan?.subscription?.planName|uppercase}} PLAN  <i class="si-info"></i></div> 
                  <div class="plan-price">
                   <span class="plan-crown-img" *ngIf="(currentSubscriptionPlan?.subscription?.planName|lowercase)!=='free'"><img src="assets/images/pricing-plan/plan-crown.svg" /></span> ${{currentSubscriptionPlan?.subscription?.planAmount}} <span class="plan-duration" *ngIf="currentSubscriptionPlan?.subscription?.planAmount>0">/ {{currentSubscriptionPlan?.subscription?.billingUnit}}</span>
                  </div>
                  <div class="plan-options">
                    <div class="plan-view">
                      <button class="kr-sg-button-ghost btn_md" data-toggle="modal" data-target="#viewPlanModal">View Plan <span><i class="si-carrotup angle-right-icon"></i></span></button>
                    </div>
                    <div class="plan-change">
                      <button class="kr-sg-button-ghost btn_md" (click)="selectModal('choose_plan')">Change Plan <span><i class="si-carrotup angle-right-icon"></i></span></button>
                      <!-- <button class="kr-sg-button-ghost btn_md" (click)="openPopup5();">Change Plan <span><i class="si-carrotup angle-right-icon"></i></span></button> -->

                      
                    </div>
                  </div>
                </div>
                <div class="tile-plan-status plan-status-active">
                  <div class="plan-subscription"><span class="plan-current-status"></span> Active</div>
                  <div class="plan-subscription-duration">{{(currentSubscriptionPlan?.subscription?.planName|lowercase)!=='free'?'Till  ':''}}{{(currentSubscriptionPlan?.subscription?.planName|lowercase)==='free'?'Forever':currentSubscriptionPlan?.subscription?.endDate|dateFormatPipe:'D.MMM.YYYY'}}</div>
                </div>

                <!-- <div class="tile-plan-status plan-status-cancel">
                  <div class="plan-subscription"><span class="plan-current-status"></span> {{"plan.cancel_request_sent" | translate}}</div>
                  <div class="plan-subscription-duration">{{"plan.revert_cancellation_btn" | translate}}</div>
                </div> -->
              </div>

              <div class="tile-plan-utilization plan-current-usage">
                <div class="plan-current-and-overage">
                  <div class="plan-current-usage">CURRENT USAGE</div>
                </div>
                <div class="plan-progress-bar-block">
                  <div class="plan-progress-bar-header-block">
                    <div class="plan-progress-bar-header">Documents</div>
                    <div class="plan-progress-bar-count">{{usageDetails?.ingestDocs?.used}} <span class="total-count">/ {{usageDetails?.ingestDocs?.limit}}</span></div>
                  </div>
                  <div class="plan-progress-bar">
                    <ngb-progressbar class="mt-3" height="10px" [type]="usageDetails.ingestDocs?.type" [value]="usageDetails.ingestDocs?.used" [max]="usageDetails.ingestDocs?.limit"></ngb-progressbar>
                  </div>
                </div>

                <div class="plan-progress-bar-block">
                  <div class="plan-progress-bar-header-block">
                    <div class="plan-progress-bar-header">Queries</div>
                    <div class="plan-progress-bar-count">{{usageDetails?.searchQueries?.used}} <span class="total-count">/ {{usageDetails?.searchQueries?.limit}}</span></div>
                  </div>
                  <div class="plan-progress-bar">
                    <ngb-progressbar class="mt-3" height="10px" [type]="usageDetails.searchQueries?.type" [value]="usageDetails.searchQueries?.used" [max]="usageDetails.searchQueries?.limit"></ngb-progressbar>
                  </div>
                </div>
              </div>

              <button class="btn btn-add-overage" *ngIf="currentSubscriptionPlan?.overages.length===0; else overageUsage" (click)="selectModal('add_overage')"><span class="pr-2"><i class="si-grow-up-arrow"></i></span>Add Overage</button>              
              <ng-template #overageUsage>
              <div class="tile-plan-utilization plan-overview">
                <div class="plan-current-and-overage">
                  <div class="plan-current-usage">OVERAGE</div>
                  <div class="plan-add-btn">
                    <button class="kr-sg-button-ghost btn_md" (click)="selectModal('add_overage')">+ADD</button>
                  </div>
                </div>
                <div class="plan-progress-bar-block">
                  <div class="plan-progress-bar-header-block">
                    <div class="plan-progress-bar-header">Documents</div>
                    <div class="plan-progress-bar-count">13000 <span class="total-count">/ 20000</span></div>
                  </div>
                  <div class="plan-progress-bar">
                    <ngb-progressbar class="mt-3" height="10px" [type]="usageDetails.searchQueries?.type" [value]="usageDetails.searchQueries?.used" [max]="usageDetails.searchQueries?.limit"></ngb-progressbar>
                  </div>
                </div>
                <div class="plan-progress-bar-block">
                  <div class="plan-progress-bar-header-block">
                    <div class="plan-progress-bar-header">Queries</div>
                    <div class="plan-progress-bar-count">13000 <span class="total-count">/ 20000</span></div>
                  </div>
                  <div class="plan-progress-bar">
                    <ngb-progressbar class="mt-3" height="10px" [type]="usageDetails.searchQueries?.type" [value]="usageDetails.searchQueries?.used" [max]="usageDetails.searchQueries?.limit"></ngb-progressbar>
                  </div>
                </div>
              </div>
            </ng-template>
            </div>
          </div>
          <div class="col-8 tile-right">
            <div class="tile-header">
              <span class="pr-1"><i class="si-graph-lines"></i></span> Usage Metrics <span><i class="si-info"></i></span>
            </div>
            <div class="tile-chart"
            [ngStyle]="{'opacity':isyAxisQuerydata?'none':'0.5','pointer-events':isyAxisQuerydata?'auto':'none'}">
            <div class="title">{{"plan.query_usage_analytics"| translate}} <span>| {{monthRange}}
                ({{"plan.last_6_months"| translate}})</span></div>
            <div echarts [options]="queryGraph" class="demo-chart-graphMode" style="height: 320px;"></div>
          </div>
          </div>
        </div>
    </div>
  </perfect-scrollbar>
</div>

<!--cancel subscription modal-->
<kr-modal modalType="center" modalClass="modal_popups_ cancel_subscription_new" #cancelSubscriptionModel>
  <div class="modal-header">
    <div class="title">{{"plan.cancel_subscription"| translate}}</div>
    <div class="close_icon" (click)="cancelSubscriptionModal('close')">
      <img src="assets/icons/modal-close.svg">
    </div>
  </div>
  <perfect-scrollbar>
    <div class="modal-body">
        <div class="row col-12 m-0 cancel-subscription-block">
          <div class="col-6">
            <div class="order-img">
              <img src="assets/images/pricing-plan/plan-order/payment-hold.svg" class="order-stage-img" />
            </div>
          </div>
          <div class="col-6">
           <section class="cancel-subscription-section">
            <div class="terms-list-block">
              <div class="terms-list">
                <div class="check-icon"><i class="si-check"></i></div>
                <div>
                  Your Subscription is valid till the end of billing cycle - {{currentSubscriptionPlan?.subscription?.endDate|date:'dd MMM yyyy'}}.
                </div>
              </div>
              <div class="terms-list">
                <div class="check-icon"><i class="si-check"></i></div>
                <div>
                  Post billing cycle your app will not respond to the end users
                </div>
              </div>
              <div class="terms-list">
                <div class="check-icon"><i class="si-check"></i></div>
                <div>
                  However, you will have access to your app for 15 more days after cancellantion to either reactive or take a backup of your application. After 15 days your app will be permanently deleted.
                </div>
              </div>
            </div>
            <div class="reason-header">What is the reason you want to cancel?</div>

            <div class="reason-check-list">
              <div class="group-checkbox">
                <div class="kr-sg-checkbox d-block" *ngFor="let data of cancellationCheckboxText;let i=index">
                  <input [id]="i" class="checkbox-custom cancel-checkbox" type="checkbox">
                  <label [for]="i" class="checkbox-custom-label">{{data}}</label>
                </div>
              </div>
            </div>

            <div class="reason-comment">
              <div class="kr-sg-input-text-area">
                <div class="label-text">{{"plan.comments"| translate}}</div>
                <textarea placeholder="Start typing here" id="cancel_comment_text" class="input-text"></textarea>
              </div>
            </div>
           </section>
          </div>
        </div>
    </div>
  </perfect-scrollbar>
  <div class="modal-footer text-right">
    <button class="kr-sg-button-primary btn_lg" (click)="cancelSubscription()">{{"plan.done"| translate}}</button>
  </div>
</kr-modal>

  <!-- View plan Modal -->
  <div class="modal fade" id="viewPlanModal">
    <div class="modal-dialog single-plan">
      <div class="modal-content">
        <!-- Modal body -->
        <div class="modal-body">
          <div class="plan-tile-block">
            <div class="plan-type-block">
              <div class="plan-img"><img src="assets/images/pricing-plan/pricing-plan-{{currentSubscriptionPlan?.subscription?.planName|lowercase}}.svg" /></div>
              <div class="plan-details">
                <div class="plan-type">
                  <div class="plan-name">{{currentSubscriptionPlan?.subscription?.planName}}</div>
                  <div class="plan-current-status">Current Plan</div>
                </div>
                <div class="plan-cost-details">
                  <div class="plan-cost">${{currentSubscriptionPlan?.subscription?.planAmount}} <span class="plan-duration-type">{{(currentSubscriptionPlan?.subscription?.planName|lowercase)!=='free'?'/ ':''}}{{(currentSubscriptionPlan?.subscription?.planName|lowercase)==='free'?'Forever':currentSubscriptionPlan?.subscription?.billingUnit}}</span></div>
                </div>
              </div>
              <span class="plan-close" data-dismiss="modal"><i class="si-close"></i></span>
            </div>
            <div class="plan-tag-line">
              <div>Try our platform for free.</div>
              <div>No credit card required.</div>
            </div>
            <div class="plan-upgrade-block">
              <button class="btn" (click)="selectModal('choose_plan')">Upgrade Plan</button>
            </div>
            <div class="plan-features-block">
              <perfect-scrollbar class="paln-overflow-scroll">
                <div class="plan-feature-desc font-weight-bold"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 <span class="plan-records">records</span> </div>
                <div class="plan-feature-desc font-weight-bold"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 <span class="plan-records">queries/month</span> </div>
                <div class="plan-sub-features">
                  <div class="plan-sub-feature-hding">Features Includes</div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> Website Crawler </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> Weights,Synonyms & Stopwords </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> Indexing & Workbench </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> Connectors </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 records </div>
                  <div class="show-more"><span class="icon-si"><i class="si-ellipsis-horizontal"></i></span> Show <span>23</span> more features </div>
                </div>
                <div class="plan-sub-features">
                  <div class="plan-sub-feature-hding">Features Includes</div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 records </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 records </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 records </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 records </div>
                  <div class="plan-feature-desc"><span class="icon-si"><i class="si-green-check"></i></span> 10,000 records </div>
                  <div class="show-more"><span class="icon-si"><i class="si-ellipsis-horizontal"></i></span> Show <span>23</span> more features </div>
                </div>
              </perfect-scrollbar>
            </div>
          </div>
        </div>
        <!-- Modal body -->
      </div>
    </div>
  </div>

  <app-upgrade-plan #plans></app-upgrade-plan>
