<div class="experiment-container">
  <div class="mainLoadingSpinner" *ngIf="loadingContent">
    <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
    <span class="please-wait-message">{{ 'sa_please_wait' | translate }}</span>
  </div>

  <div *ngIf="loadingContent1">
    <div
      class="header-sec row"
      *ngIf="listOfExperiments.length > 0 || filterExperiments.length > 0"
    >
      <div class="col-6 left-sec p-0">
        <div class="tab-sec d-flex">
          <b
            >{{ 'experiments_name' | translate }}
            <span
              class="module-topic"
              tooltipClass="tooltip-global-"
              [container]="'body'"
              ngbTooltip="{{ sa_topic_guide | translate }}"
              placement="right-center"
              (click)="openUserMetaTagsSlider()"
            >
              <i class="si-topic-guide-1"></i>
            </span>
          </b>
        </div>
      </div>
      <div
        class="col-6 p-0 right-sec d-flex align-items-center justify-content-end"
      >
        <div
          class="kr-sg-input-search m-0"
          [ngClass]="{ 'd-none': !showSearch }"
          style="float: left"
        >
          <input
            type="text"
            maxlength="60"
            placeholder="{{ 'sa_search' | translate }}"
            id="inputSearch"
            class="input-search"
            [ngClass]="{ 'pl-33': !searchFields, 'pl-2': searchFields }"
            autocomplete="off"
            [(ngModel)]="searchFields"
            maxlength="50"
            (keyup)="getExperiments(searchFields, 'search')"
            (mouseover)="
              searchImgSrc = searchFocusIn
                ? 'assets/icons/search_gray.svg'
                : 'assets/icons/search_gray_dark.svg'
            "
            (mouseout)="
              searchFocusIn = false;
              searchImgSrc = 'assets/icons/search_gray.svg'
            "
            (focus)="
              searchFocusIn = true;
              searchImgSrc = 'assets/icons/search_gray.svg'
            "
          />
          <img [src]="searchImgSrc" class="search-icon" *ngIf="!searchFields" />
          <img
            class="close-icon"
            src="assets/icons/close_icon.svg"
            [ngClass]="{ 'pr-22': searchFields }"
            (mouseover)="activeClose = true"
            (mouseout)="activeClose = false"
            (click)="focusoutSearch()"
            placement="top-center"
            container="body"
            ngbTooltip="{{ 'sa_cancel' | translate }}"
            tooltipClass="ngb_tooltip_custom_class sampleJson"
          />
        </div>
        <div
          class="searchBlock"
          (click)="showSearch = !showSearch; focusinSearch('inputSearch')"
          *ngIf="listOfExperiments.length > 0 || filterExperiments.length > 0"
        >
          <span
            [ngClass]="{ 'd-none': showSearch }"
            class="mr-3"
            id="btn_toggle_search_structured_data"
            ><img
              src="assets/icons/search.svg"
              [ngClass]="{ 'd-none': showSearch }"
            />{{ 'sa_search' | translate }}</span
          >
        </div>
        <div (click)="addExperiment('add')" class="title">
          <img src="assets/icons/add_plus.svg" />{{
            'experiments_add_btn' | translate
          }}
        </div>
      </div>
    </div>
    <perfect-scrollbar
      class="p-scroll-data"
      [ngClass]="{ 'scroll-empty-screen': filterExperiments.length === 0 }"
    >
      <div class="table-data-content">
        <div
          class="row m-0 header-data col-12"
          *ngIf="filterExperiments.length > 0"
        >
          <div class="col-3 h-title d-flex align-items-center">
            {{ 'experiments_exp_name' | translate
            }}<sup class="field-mandatory">*</sup>
          </div>
          <div class="col-3 h-title">
            {{ 'experiments_variants' | translate }}
          </div>
          <div
            class="col-2 d-flex align-items-center h-title"
            (click)="sortByApi('state')"
          >
            <span class="d-flex align-items-center flex-column mr-1">
              <img
                [ngClass]="getSortIconVisibility('state', 'down')"
                src="assets/icons/caretDown.svg"
                class="ml-1 sortImg downArrow"
              />
              <img
                [ngClass]="getSortIconVisibility('state', 'up')"
                src="assets/icons/caretDown.svg"
                class="ml-1 sortImg upArrow"
              />
            </span>
            {{ 'experiments_status' | translate }}&nbsp;
            <div
              class="kr-sg-dropdowns type_sort_dropdown"
              #statusFilter="ngbDropdown"
              ngbDropdown
              [container]="'body'"
              [autoClose]="true"
              [placement]="'bottom-right'"
            >
              <div class="dropdown dropdown-open">
                <button
                  class="dropdown-toggle dropdown-input"
                  ngbDropdownToggle
                  (click)="$event.stopPropagation()"
                >
                  <img
                    class="custom-dropdown-toggle-icon"
                    src="assets/icons/type-select-dropdown.svg"
                  />
                </button>
                <ul
                  class="dropdown-menu content-menu type_sort_dropdown-content"
                  ngbDropdownMenu
                >
                  <li
                    [ngClass]="{
                      'selected-list': filterSystem.statusfilter === 'all'
                    }"
                    (click)="filterTable('all', 'status'); statusFilter.close()"
                  >
                    All
                    <img
                      [ngClass]="{ hide: filterSystem.statusfilter !== 'all' }"
                      src="assets/icons/check-blue.svg"
                    />
                  </li>
                  <li
                    [ngClass]="{
                      'selected-list': filterSystem.statusfilter === status
                    }"
                    *ngFor="let status of dynamicStatus"
                    (click)="
                      filterTable(status, 'status'); statusFilter.close()
                    "
                  >
                    <span class="list-name">{{ status }}</span>
                    <img
                      [ngClass]="{ hide: filterSystem.statusfilter !== status }"
                      src="assets/icons/check-blue.svg"
                    />
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-3 h-title d-flex align-items-center">
            {{ 'experiments_duration' | translate }}
          </div>
        </div>
        <ng-container
          *ngIf="
            (listOfExperiments | filter : [searchFields, 'name']).length;
            else noExperiments
          "
        >
          <div id="accordion">
            <div
              class="acc-card"
              *ngFor="
                let exp of listOfExperiments | filter : [searchFields, 'name'];
                let exp_index = index
              "
            >
              <div class="acc-card-header">
                <div
                  class="acc-card-link collapsed"
                  data-toggle="collapse"
                  attr.data-target="#{{ exp._id }}"
                >
                  <div class="row m-0 col-12 row_data">
                    <div class="col-3 ex-title">{{ exp.name }}</div>
                    <div class="col-3 variants">
                      <div class="variants-block left">
                        <span
                          class="v-name"
                          *ngFor="let vari of exp.variants; let index = index"
                          [style.background-color]="vari.color"
                          [hidden]="index === 3"
                        >
                          <span *ngIf="index < 2">{{ vari.code }}</span>
                          <span *ngIf="index > 1 && index >= 2">{{
                            exp.variants.length === 3 ? '+ 1 ' : '+ 2 '
                          }}</span>
                        </span>
                      </div>
                      <div class="variants-block right">
                        <span
                          *ngFor="let vari of exp.variants; let index = index"
                        >
                          <span
                            *ngIf="
                              exp.top_leader === vari.code &&
                              exp.state !== 'configured'
                            "
                          >
                            <span
                              class="v-name status"
                              [style.background-color]="vari.color"
                              >{{ exp.top_leader }}</span
                            >
                            <span class="winner" *ngIf="vari.leader"
                              ><img
                                src="assets/icons/experiment/leader.svg"
                                alt="leader"
                            /></span>
                            <span class="winner" *ngIf="vari.winner">{{
                              'experiments_winner' | translate
                            }}</span></span
                          >
                        </span>
                      </div>
                    </div>
                    <div class="col-2 status">
                      <span class="a-status" [ngClass]="exp.state">{{
                        exp.state | titlecase
                      }}</span>
                    </div>
                    <div
                      class="col-3 duration-data d-flex align-items-start"
                      *ngIf="
                        exp.state !== 'configured' && exp.state !== 'completed'
                      "
                    >
                      <div class="left-sec">
                        <div class="date-stamp">
                          <span class="s-color"
                            >{{ 'experiments_start_date' | translate }}:</span
                          >
                          {{ exp.start | date : 'mediumDate' }}
                        </div>
                        <div class="date-stamp">
                          <span class="s-color"
                            >{{ 'experiments_end_date' | translate }}:</span
                          >
                          {{ exp.end | date : 'mediumDate' }}
                        </div>
                      </div>
                      <div class="right-sec" *ngIf="exp.state !== 'completed'">
                        <div class="hours">
                          {{ exp.total_days }}
                          {{ 'experiments_more' | translate }}
                        </div>
                        <div class="hours">
                          <ngb-progressbar
                            type="secondary"
                            [value]="exp.time_result"
                            [max]="24 * exp.duration.days"
                          >
                          </ngb-progressbar>
                        </div>
                      </div>
                    </div>
                    <div
                      class="col-4 d-flex align-items-center duration-data"
                      *ngIf="exp.state === 'completed'"
                    >
                      <div class="left-sec">
                        <div class="date-stamp">
                          <span class="s-color"
                            >{{ 'experiments_start_date' | translate }}:</span
                          >
                          {{ exp.start | date : 'mediumDate' }}
                        </div>
                      </div>
                      <div class="right-sec">
                        <div class="date-stamp">
                          <span class="s-color"
                            >{{ 'experiments_end_date' | translate }}:</span
                          >
                          {{ exp.end | date : 'mediumDate' }}
                        </div>
                      </div>
                    </div>
                    <div
                      class="col-4 d-flex align-items-center duration-data justify-content-between"
                      *ngIf="exp.state === 'configured'"
                    >
                      <div
                        class="left-sec border-0 before-none pl-0"
                        [class.col-9]="status_active"
                      >
                        <div class="info-data" *ngIf="status_active">
                          <img src="assets/icons/experiment/Info.svg" />{{
                            'experiments_cannot_run' | translate
                          }}
                        </div>
                      </div>
                      <div class="right-sec">
                        <button
                          class="kr-sg-button-secondary btn_lg"
                          [class.mr-2]="!status_active"
                          [disabled]="status_active"
                          (click)="runExperiment(exp._id, 'active', $event)"
                        >
                          {{ 'experiments_run' | translate }}
                        </button>
                        <!-- <span (click)="addExperiment('edit', exp)" style="padding-left: 2px; font-size: 9px"
                          *ngIf="!status_active">{{"experiments_view_configuration"| translate}}</span> -->
                      </div>
                    </div>

                    <div class="delete-table">
                      <img
                        src="assets/icons/pause.svg"
                        ngbTooltip="{{ 'experiments_pause' | translate }}"
                        *ngIf="exp.state === 'active'"
                        (click)="runExperiment(exp._id, 'paused', $event)"
                      />
                      <img
                        src="assets/icons/End.svg"
                        ngbTooltip="{{ 'experiments_stop' | translate }}"
                        *ngIf="exp.state === 'active'"
                        (click)="runExperiment(exp._id, 'stopped', $event)"
                      />
                      <img
                        src="assets/icons/play_black.svg"
                        ngbTooltip="{{ 'experiments_play' | translate }}"
                        *ngIf="exp.state === 'paused'"
                        (click)="runExperiment(exp._id, 'active', $event)"
                      />
                      <img
                        src="assets/icons/return_black.svg"
                        class="d-none"
                        ngbTooltip="{{ 'experiments_restart' | translate }}"
                        *ngIf="exp.state === 'stopped'"
                        (click)="runExperiment(exp._id, 'active', $event)"
                      />
                      <img
                        src="assets/icons/delete-table.svg"
                        ngbTooltip="{{ 'experiments_delete' | translate }}"
                        *ngIf="
                          exp.state === 'completed' ||
                          exp.state === 'stopped' ||
                          exp.state === 'paused'
                        "
                        (click)="confirmationPopup(exp._id, $event, 'delete')"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div id="{{ exp._id }}" class="collapse" data-parent="#accordion">
                <div class="acc-card-body">
                  <div class="bg-sec">
                    <div class="row m-0 col-12 acc-row-header">
                      <div class="col-2 title">
                        {{ 'experiments_variant' | translate }}
                      </div>
                      <div class="col-1 title">
                        {{ 'experiments_index' | translate }}
                      </div>
                      <div class="col-2 title">
                        {{ 'experiments_search_config' | translate }}
                      </div>
                      <div class="col-1 title">
                        {{ 'experiments_traffic' | translate }}
                      </div>
                      <div class="col-1 title">
                        {{ 'experiments_users' | translate }}
                      </div>
                      <div class="col-1 title">
                        {{ 'experiments_searches' | translate }}
                        <span
                          placement="top-center"
                          [ngbTooltip]="searchTooltip"
                          [container]="'body'"
                          tooltipClass="metrics_tooltips m-0"
                          ><img src="assets/icons/overview/Info.svg"
                        /></span>
                      </div>
                      <div class="col-1 title">
                        {{ 'experiments_clicks' | translate }}
                      </div>
                      <div class="col-1 title d-flex align-items-center">
                        <span
                          class="d-inline-block text-truncate"
                          style="max-width: 70px"
                          title="{{ 'experiments_ctr' | translate }}"
                          >{{ 'experiments_ctr' | translate }}</span
                        >
                        <span
                          placement="top-center"
                          [ngbTooltip]="ctrTooltip"
                          [container]="'body'"
                          tooltipClass="metrics_tooltips m-0"
                          ><img src="assets/icons/overview/Info.svg"
                        /></span>
                      </div>
                      <div class="col-2 title">
                        {{ 'experiments_searches_results' | translate }}
                        <span
                          placement="top-center"
                          [ngbTooltip]="searchResultTooltip"
                          [container]="'body'"
                          tooltipClass="metrics_tooltips m-0"
                          ><img src="assets/icons/overview/Info.svg"
                        /></span>
                      </div>
                    </div>
                    <div
                      class="row m-0 col-12 acc-row-body align-items-center"
                      *ngFor="let expCol of exp.variants"
                    >
                      <div class="col-2 d-flex varient-data align-items-center">
                        <div
                          class="name-letter"
                          [style.background-color]="expCol.color"
                        >
                          {{ expCol.code }}
                        </div>
                        <div class="name">
                          {{ expCol.name }}
                        </div>
                      </div>
                      <div class="col-1 title">
                        {{ expCol.indexPipelineName }}
                      </div>
                      <div class="col-2 title">
                        {{ expCol.queryPipelineName }}
                      </div>
                      <div class="col-1 title">{{ expCol.trafficPct }}%</div>
                      <div class="col-1 title">{{ expCol.users || 0 }}</div>
                      <div class="col-1 title">{{ expCol.searches }}</div>
                      <div class="col-1 title">{{ expCol.clicks }}</div>
                      <div
                        class="col-1 title"
                        [class.leader_percent]="
                          expCol.searches > 0 && expCol.leader
                        "
                      >
                        {{
                          expCol.ctr > 0
                            ? expCol.ctr.toFixed(2) + '%'
                            : expCol.ctr
                        }}
                      </div>
                      <div class="col-2 title">
                        {{ expCol.searchesWithResults }}
                      </div>
                    </div>
                    <div class="v-search-config">
                      <span (click)="addExperiment('edit', exp)">{{
                        'experiments_view_configuration' | translate
                      }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>

      <ng-container *ngIf="filterExperiments.length === 0">
        <app-empty-screen
          class="empty-lg"
          [width]="170"
          [height]="170"
          title="{{ 'TITLE' | translate }}"
          desc="{{ 'DESC' | translate }}"
          imgName="experiments.png"
        >
          <div class="action-buttons">
            <button
              class="kr-sg-button-primary btn_lg"
              (click)="addExperiment('add')"
            >
              <i class="si-add-plus"></i>
              {{ 'experiments_add_btn' | translate }}
            </button>
          </div>
        </app-empty-screen>
        <!-- <div class="empty-landing-screen">
          <div class="img-block"><img class="action_icon" src="assets/images/experiments-empty.png"
              (load)="imageLoaded()"></div>
          <ng-container *ngIf="loadImageText">
            <div class="empty-title">{{"experiments_havenot_added"| translate}}</div>
            <div class="desc-text">{{"experiments_desc_text"| translate}}</div>
            <button class="kr-sg-button-primary btn_lg px-3" (click)="addExperiment('add')">{{"experiments_add_btn"|
              translate}}</button>
          </ng-container>
        </div> -->
      </ng-container>
      <div
        class="no-experiments"
        *ngIf="filterExperiments.length !== 0 && listOfExperiments.length === 0"
      >
        <div>{{ 'experiments_no_result_found' | translate }}</div>
      </div>
      <div
        *ngIf="exp_totalRecord && exp_totalRecord > 10"
        style="margin-right: 45px"
      >
        <app-record-pagination
          [totalRecord]="exp_totalRecord"
          [limitpage]="10"
          (pageChanged)="paginate($event)"
        >
        </app-record-pagination>
      </div>
    </perfect-scrollbar>
  </div>
  <ng-template #noExperiments>
    <app-empty-screen
      class="empty-sm"
      [width]="130"
      [height]="130"
      *ngIf="!loadingContent && searchFields"
      title="{{ 'NO_SEARCH_RESULTS_FOUND' | translate }}"
      desc="{{ 'DESC_SEARCH' | translate }}"
      imgName="experiments.png"
    >
    </app-empty-screen>
  </ng-template>
</div>
<!---add popup-->
<kr-modal
  modalType="center"
  modalClass="modal_popups_ addFieldModalPop smallModal"
  #addExperiments
>
  <div class="modal-header">
    <div class="title">
      {{
        form_type === 'edit'
          ? ('experiments_view_experiment' | translate)
          : ('experiments_new_experiment' | translate)
      }}
    </div>
    <div class="close_icon" (click)="closeModalPopup()">
      <img src="assets/icons/modal-close.svg" />
    </div>
  </div>
  <perfect-scrollbar class="perfect-scroll-modal-body">
    <!-- <div
      class="kr-sg-multi-line-notification"
    >
      <div class="bulb-icon">
        <img src="assets/icons/info-blue.svg" />
      </div>
      <div class="tost-text">{{ status }} Experiment cannot be edited.</div>
    </div> -->
    <div class="modal-body textAlignLeft">
      <div
        class="info-notifcation"
        *ngIf="exp_status !== 'configured' && form_type === 'edit'"
      >
        <img src="assets/icons/info-blue.svg" />
        <span class="title"
          >{{ exp_status | titlecase }}
          {{ 'experiments_exp_cannot_edited' | translate }}</span
        >
      </div>
      <div class="row ml-0 mr-0 mb-3 col-12 p-0 pr-30">
        <div class="kr-sg-input-text col-8 pl-pr-5">
          <div class="label-text">
            {{ 'experiments_exp_name' | translate
            }}<sup class="field-mandatory">*</sup>
          </div>
          <input
            type="text"
            autocomplete="off"
            maxlength="60"
            id="enterName"
            placeholder="{{ 'experiments_enter_experiment_name' | translate }}"
            class="input-text"
            (blur)="inputChanged('enterName')"
            (change)="inputChanged('enterName')"
            [(ngModel)]="experimentObj.name"
            [disabled]="exp_status !== 'configured' && form_type === 'edit'"
            [ngClass]="{
              disable_edit: exp_status !== 'configured' && form_type === 'edit'
            }"
            [ngStyle]="{
              'background-color':
                exp_status !== 'configured' && form_type === 'edit'
                  ? '#EFF0F1'
                  : '#ffffff',
              'border-color':
                exp_status !== 'configured' && form_type === 'edit'
                  ? '#f3f3f4'
                  : '#BDC1C6'
            }"
          />
          <img
            id="infoWarning"
            src="assets/icons/warning_escalation.svg"
            style="display: none"
            height="12"
            width="12"
          />
        </div>
      </div>

      <div
        class="row ml-0 mr-0 mb-3 col-12 p-0 pr-30"
        *ngFor="let vari of variantsArray; let varIndex = index"
      >
        <div class="kr-sg-input-text col-4 pl-pr-5 ifvariant">
          <div class="label-text">
            {{ 'experiments_var_name' | translate
            }}<sup class="field-mandatory">*</sup>
          </div>
          <input
            type="text"
            maxlength="60"
            autocomplete="off"
            #varName
            placeholder="{{ 'experiments_enter_variant_name' | translate }}"
            class="input-text"
            id="variantName{{ varIndex }}"
            (change)="inputChanged('variantName', varIndex)"
            [(ngModel)]="vari.name"
            (blur)="
              fetchVariant(varIndex, varName.value, 'name');
              inputChanged('variantName', varIndex)
            "
            [disabled]="exp_status !== 'configured' && form_type === 'edit'"
            [ngClass]="{
              disable_edit: exp_status !== 'configured' && form_type === 'edit'
            }"
          />
          <span class="v-name" [style.background-color]="vari.color">{{
            vari.code
          }}</span>
          <img
            id="infoWarning{{ varIndex }}"
            src="assets/icons/warning_escalation.svg"
            style="display: none"
            height="12"
            width="12"
          />
        </div>
        <div class="kr-sg-dropdowns col-4 pl-pr-5">
          <div class="label-text">
            {{ 'experiments_exp_index' | translate
            }}<sup class="field-mandatory">*</sup>
          </div>
          <div class="dropdown dropdown-open">
            <button
              class="dropdown-toggle dropdown-input"
              data-toggle="dropdown"
              id="indexPipelineName{{ varIndex }}"
              [disabled]="exp_status !== 'configured' && form_type === 'edit'"
              [ngStyle]="{
                'background-color':
                  exp_status !== 'configured' && form_type === 'edit'
                    ? '#EFF0F1'
                    : '#ffffff',
                color:
                  vari.indexPipelineName === undefined ||
                  (exp_status !== 'configured' && form_type === 'edit')
                    ? '#9aa0a6'
                    : '#202124',
                'border-color':
                  exp_status !== 'configured' && form_type === 'edit'
                    ? '#f3f3f4'
                    : '#BDC1C6'
              }"
            >
              {{
                vari.indexPipelineName === undefined
                  ? varIndex === 0
                    ? 'Select Index'
                    : 'Select Index'
                  : vari.indexPipelineName
              }}
            </button>
            <ul class="dropdown-menu content-menu">
              <li
                *ngFor="let index of indexConfig"
                (click)="
                  fetchVariant(varIndex, index, 'indexid');
                  getQueryPipeline(index._id, varIndex)
                "
                [ngStyle]="{
                  'font-weight':
                    vari.indexPipelineId === index._id ? 'bold' : ''
                }"
              >
                {{ index.name === 'Default' ? 'Default Index' : index.name }}
              </li>
            </ul>
          </div>
        </div>
        <div class="kr-sg-dropdowns col-4 pl-pr-5">
          <div class="label-text">
            {{ 'experiments_search_configuration' | translate
            }}<sup class="field-mandatory">*</sup>
          </div>
          <div class="dropdown dropdown-open">
            <button
              class="dropdown-toggle dropdown-input"
              data-toggle="dropdown"
              id="queryPipelineName{{ varIndex }}"
              [disabled]="
                (exp_status !== 'configured' && form_type === 'edit') ||
                vari.indexPipelineName === undefined
              "
              [ngStyle]="{
                'background-color':
                  (exp_status !== 'configured' && form_type === 'edit') ||
                  vari.indexPipelineName === undefined
                    ? '#EFF0F1'
                    : '#ffffff',
                color:
                  vari.indexPipelineName === undefined ||
                  (exp_status !== 'configured' && form_type === 'edit')
                    ? '#9aa0a6'
                    : '#202124',
                'border-color':
                  exp_status !== 'configured' && form_type === 'edit'
                    ? '#f3f3f4'
                    : '#BDC1C6'
              }"
            >
              {{
                vari.queryPipelineName === undefined
                  ? varIndex === 0
                    ? 'Select Search Configuration'
                    : 'Select Search Configuration'
                  : vari.queryPipelineName
              }}
            </button>
            <ul
              class="dropdown-menu content-menu"
              *ngIf="vari.indexPipelineName !== undefined"
            >
              <li
                *ngFor="let query of queryPipeline[varIndex]"
                (click)="fetchVariant(varIndex, query, 'queryid')"
                [ngStyle]="{
                  'font-weight':
                    vari.queryPipelineId === query._id ? 'bold' : ''
                }"
              >
                {{
                  query.name === 'Default'
                    ? ('app_menu_Default_search' | translate)
                    : query.name
                }}
              </li>
            </ul>
          </div>
        </div>
        <div
          class="delete-rule"
          (click)="removeVariant(varIndex)"
          [hidden]="
            (exp_status !== 'configured' && form_type === 'edit') ||
            [0, 1].includes(varIndex)
          "
        >
          <img src="assets/icons/modal-close.svg" />
        </div>
      </div>

      <div
        class="mb-3 variant-add"
        (click)="addVarient()"
        *ngIf="variantsArray.length < 4"
        [hidden]="exp_status !== 'configured' && form_type === 'edit'"
      >
        <img src="assets/icons/add_blue.svg" />{{
          'experiments_add_variant' | translate
        }}
      </div>

      <div class="trafic-sec">
        <div class="pl-pr-5 slider-sec">
          <div class="label-text">{{ 'experiments_traffic' | translate }}</div>
          <nouislider
            *ngIf="showSlider"
            #sliderref
            [config]="someRangeconfig"
            [(ngModel)]="someRange"
            [ngStyle]="{
              'pointer-events':
                exp_status !== 'configured' && form_type === 'edit'
                  ? 'none'
                  : 'auto'
            }"
            (slide)="sliderChanged()"
          ></nouislider>
        </div>
        <div class="percentage-sec">
          <div class="names" *ngFor="let code of variantsArray">
            <span class="name" [style.background-color]="code.color">{{
              code.code
            }}</span
            ><span class="perentage">{{ code.trafficPct }}%</span>
          </div>
        </div>
      </div>

      <div class="duration-sec">
        <div class="kr-sg-input-text">
          <div class="label-text">
            {{ 'experiments_exp_duration' | translate }}
          </div>
          <input
            type="number"
            autocomplete="off"
            class="input-text text-center"
            min="30"
            max="90"
            (keyup)="checkDuration(experimentObj?.duration.days)"
            [(ngModel)]="experimentObj?.duration.days"
            [disabled]="exp_status !== 'configured' && form_type === 'edit'"
            [ngStyle]="{
              'background-color':
                exp_status !== 'configured' && form_type === 'edit'
                  ? '#EFF0F1'
                  : '#ffffff',
              'border-color':
                exp_status !== 'configured' && form_type === 'edit'
                  ? '#f3f3f4'
                  : '#BDC1C6'
            }"
          />
          <img
            src="assets/icons/Black_minus.svg"
            class="minus"
            [hidden]="exp_status !== 'configured' && form_type === 'edit'"
            (click)="
              experimentObj?.duration.days =
                experimentObj?.duration.days > 1
                  ? experimentObj?.duration.days - 1
                  : 0
            "
          />
          <img
            src="assets/icons/add_plus.svg"
            class="plus"
            [hidden]="exp_status !== 'configured' && form_type === 'edit'"
            (click)="
              experimentObj?.duration.days =
                experimentObj?.duration.days <= 89
                  ? experimentObj?.duration.days + 1
                  : 90
            "
          />
        </div>
        {{ 'experiments_exp_days' | translate }}
      </div>
    </div>
  </perfect-scrollbar>
  <div class="modal-footer text-left">
    <button
      type="button"
      class="kr-sg-button-primary btn_lg float-right"
      (click)="validateSource()"
      [disabled]="exp_status !== 'configured' && form_type === 'edit'"
    >
      <!-- [disabled]="
   !experimentObj.name ||
          (exp_status !== 'configured' && form_type === 'edit') || (variantsArray.length < 2) || (experimentObj?.duration.days < 1)
        " -->
      {{ 'experiments_save_btn' | translate }}
    </button>
    <button
      type="button"
      class="kr-sg-button-secondary btn_lg float-right"
      (click)="closeModalPopup()"
    >
      {{ 'experiments_cancel_btn' | translate }}
    </button>
  </div>
</kr-modal>
