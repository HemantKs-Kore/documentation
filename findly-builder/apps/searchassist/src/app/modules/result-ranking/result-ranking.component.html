<div class="faqmain-container" id="result-rank-container">
  <div class="mainLoadingSpinner" *ngIf="loadingContent">
    <mat-spinner diameter="18" strokeWidth="2"></mat-spinner>
    <span class="please-wait-message">{{ 'sa_please_wait' | translate }}</span>
  </div>
  <div class="header-sec col-12 row m-0">
    <div class="col-4 p-0">
      {{ 'resultRanking_resultRanking' | translate }}
      <span
        class="module-topic"
        tooltipClass="tooltip-global-"
        [container]="'body'"
        ngbTooltip="{{ 'sa_topic_guide' | translate }}"
        placement="right-center"
        (click)="openUserMetaTagsSlider()"
      >
        <i class="si-topic-guide-1"></i>
      </span>
    </div>
  </div>
  <ng-container *ngIf="!nextPage && loadingContent1">
    <app-useronboarding-journey
      [componentType]="componentType"
    ></app-useronboarding-journey>
    <perfect-scrollbar class="empty-scroll">
      <app-empty-screen
        class="empty-sm"
        [width]="200"
        [height]="200"
        title="{{ 'TITLE' | translate }}"
        desc="{{ 'DESC' | translate }}"
        imgName="result-ranking.png"
        (isImgLoading)="isEmptyScreenLoading($event)"
      >
        <div class="action-buttons">
          <button
            class="kr-sg-button-primary btn_lg mr-2"
            (click)="lauchTest()"
          >
            <i class="si-external-horizantal"></i>
            {{ 'resultRanking_letstrat' | translate }}
          </button>
        </div>
      </app-empty-screen>
    </perfect-scrollbar>
  </ng-container>
  <div *ngIf="nextPage">
    <div class="faqsListContainer">
      <div class="faq-content-boxes">
        <div class="content left-content">
          <div class="content-boxes faq_tasks_list">
            <div class="header-sec">
              <div
                class="row reset-div align-items-center justify-content-between m-0 w-100"
                *ngIf="resultSelected"
              >
                <div class="d-flex align-items-center">
                  <ng-container
                    *ngIf="collectedRecord.length === customizeList.length"
                  >
                    <div class="kr-sg-checkbox">
                      <input
                        class="checkbox-custom"
                        type="checkbox"
                        id="selectAllFaqs"
                        checked
                        autocomplete="off"
                        (click)="selectAll()"
                      />
                      <label
                        for="selectAllFaqs"
                        class="checkbox-custom-label"
                      ></label>
                    </div>
                  </ng-container>
                  <div
                    class="mr-3"
                    *ngIf="collectedRecord.length !== customizeList.length"
                  >
                    <img
                      (click)="selectAll()"
                      src="assets/icons/resultranking/selected-checkbox.svg"
                      class="search-icon"
                    />
                  </div>
                  <div class="count-selected">
                    {{ collectedRecord.length }}
                    {{ 'resultRanking_selected' | translate }}
                  </div>
                </div>
                <div [ngClass]="{ disableDiv: permisionView }">
                  <button
                    class="kr-sg-button-danger btn_lg"
                    (click)="resetCustomization()"
                  >
                    {{ 'resultRanking_reset' | translate }}
                  </button>
                </div>
              </div>
              <ng-container *ngIf="!resultSelected">
                <div class="kr-sg-checkbox">
                  <input
                    class="checkbox-custom"
                    type="checkbox"
                    id="selectAllFaqs"
                    autocomplete="off"
                    (click)="selectAll()"
                  />
                  <label
                    for="selectAllFaqs"
                    class="checkbox-custom-label"
                  ></label>
                </div>
                <div
                  class="kr-sg-input-search"
                  [ngClass]="{ 'd-none': !showSearch }"
                >
                  <input
                    type="text"
                    id="inputSearch"
                    placeholder="{{ 'sa_search' | translate }}"
                    class="input-search"
                    [(ngModel)]="searchSources"
                    name="faqsSearch"
                    autocomplete="off"
                    [ngClass]="{
                      'pl-33': !searchSources,
                      'pl-2': searchSources
                    }"
                  />
                  <img
                    src="assets/icons/search-gray.svg"
                    class="search-icon"
                    *ngIf="!searchSources"
                  />
                  <img
                    class="close-icon"
                    src="assets/icons/close_icon.svg"
                    (mouseover)="activeClose = true"
                    (mouseout)="activeClose = false"
                    [ngClass]="{ 'pr-22': searchSources }"
                    (click)="searchSources = ''"
                  />
                </div>
                <div
                  class="search-block"
                  (click)="
                    showSearch = !showSearch; focusinSearch('inputSearch')
                  "
                >
                  <span
                    [ngClass]="{ 'd-none': showSearch }"
                    class="mr-3"
                    id="btn_toggle_search_structured_data"
                    ><img
                      src="assets/icons/search.svg"
                      [ngClass]="{ 'd-none': showSearch }"
                    />{{ 'sa_search' | translate }}</span
                  >
                </div>
              </ng-container>
            </div>
            <ng-container
              *ngIf="
                (customizeList | filter : [searchSources, 'searchQuery'])
                  .length;
                else noResultRanking
              "
            >
              <div class="info-div">
                <div>{{ 'resultRanking_infoDiv' | translate }}</div>
              </div>
              <div class="body-content">
                <div class="empty-questions-selected d-none">
                  <div class="heading">{{ 'sa_please_wait' | translate }}</div>
                </div>
                <perfect-scrollbar
                  class="accor-scroll"
                  #fqasScrollContainer
                  [ngClass]="{ show_footer: totalRecord }"
                >
                  <ng-container>
                    <div id="accordion" class="accordion-content">
                      <ng-container *ngIf="customizeList">
                        <div
                          class="card-content"
                          *ngFor="
                            let list of customizeList
                              | filter : [searchSources, 'searchQuery'];
                            let i = index
                          "
                        >
                          <div
                            class="card_link collapsed"
                            [ngClass]="{
                              'is-checked': list.check === true,
                              'is-selected-list':
                                selectedRecord._id === list._id
                            }"
                            (click)="clickCustomizeRecord(list, $event)"
                          >
                            <div class="d-flex align-items-center w-100">
                              <div
                                class="kr-sg-checkbox"
                                (click)="$event.stopImmediatePropagation()"
                              >
                                <input
                                  [attr.id]="'result' + i"
                                  class="checkbox-custom selectEachfaqInput"
                                  type="checkbox"
                                  autocomplete="off"
                                  [(ngModel)]="list.check"
                                  (click)="
                                    multiSelect(list, !list.check, $event)
                                  "
                                />
                                <label
                                  [attr.for]="'result' + i"
                                  class="checkbox-custom-label"
                                ></label>
                              </div>
                              <div class="title-desc-sec">
                                <div class="title">{{ list.searchQuery }}</div>
                                <div class="desc">
                                  {{ list.numberOfCustomisations }}
                                  {{
                                    'resultRanking_customization' | translate
                                  }}
                                </div>
                              </div>
                            </div>
                            <div
                              class="restore-icon"
                              [ngClass]="{ disableDiv: permisionView }"
                              (click)="restore(list)"
                            >
                              <img
                                class="action-icon"
                                src="assets/icons/restore.svg"
                                ngbTooltip="{{
                                  'resultRanking_reset' | translate
                                }}"
                                placement="top"
                                container="body"
                              />
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </ng-container>
                </perfect-scrollbar>
                <div class="pagination mt-4" *ngIf="totalRecord > 10">
                  <app-record-pagination
                    [totalRecord]="totalRecord"
                    [limitpage]="limitpage"
                    (pageChanged)="paginate($event)"
                  ></app-record-pagination>
                </div>
              </div>
            </ng-container>
            <ng-template #noResultRanking>
              <app-empty-screen
                class="empty-sm"
                [width]="100"
                [height]="100"
                title="{{ 'NO_SEARCH_RESULTS_FOUND' | translate }}"
                desc="{{ 'DESC_SEARCH' | translate }}"
                imgName="result-ranking.png"
              >
              </app-empty-screen>
            </ng-template>
          </div>
        </div>
        <div
          class="content right-content"
          [ngClass]="{ disableDiv: disableDiv }"
        >
          <div class="content-boxes train_your_questions">
            <ng-container>
              <div class="header-info-que">
                <div class="row m-0 col-12 p-0">
                  <div class="col-4 p-0 lef-info">
                    <div class="approved_title">
                      {{
                        'resultRanking_no._of_customizations_caps' | translate
                      }}
                    </div>
                    <div class="approved_date">
                      <span class="time">{{
                        selectedRecord.numberOfCustomisations || '--'
                      }}</span>
                    </div>
                  </div>
                  <div class="col-4 p-0 lef-info">
                    <div class="approved_title">
                      {{ 'resultRanking_last_changes_caps' | translate }}
                    </div>
                    <div class="approved_date">
                      <span class="time">{{
                        lastModifiedOn | dateFormatPipe : 'dd MMMM yyyy' || '--'
                      }}</span>
                    </div>
                  </div>
                  <div class="col-4 p-0 actions-sec">
                    <div
                      class="kr-sg-dropdowns comments_header_dropdown"
                      ngbDropdown
                      [container]="'body'"
                      [placement]="'bottom-right'"
                    >
                      <div
                        class="dropdown dropdown-open"
                        [ngClass]="{ disableDiv: permisionView }"
                        (click)="launch()"
                      >
                        <button
                          class="dropdown-toggle dropdown-input"
                          ngbDropdownToggle
                          tooltipClass="test-icon-tooltip"
                          ngbTooltip="{{
                            'resultRanking_launch_query_in_customize_mode'
                              | translate
                          }}"
                          placement="top"
                        >
                          <img class="cursor" src="assets/icons/play.svg" />
                        </button>
                      </div>
                    </div>
                    <div
                      class="kr-sg-dropdowns comments_header_dropdown"
                      ngbDropdown
                      [container]="'body'"
                      [placement]="'bottom-right'"
                    >
                      <div class="dropdown dropdown-open" (click)="showLogs()">
                        <button
                          class="dropdown-toggle dropdown-input"
                          ngbDropdownToggle
                          ngbTooltip="{{ 'resultRanking_log' | translate }}"
                          placement="top"
                        >
                          <img class="cursor" src="assets/icons/Timer.svg" />
                        </button>
                      </div>
                    </div>
                    <div
                      class="d-flex align-items-center justify-content-end"
                      [ngClass]="{ disableDiv: permisionView }"
                    >
                      <button
                        class="kr-sg-button-secondary btn_lg reset_btn"
                        (click)="restore(selectedRecord)"
                      >
                        <img src="assets/icons/restore.svg" />{{
                          'resultRanking_restore' | translate
                        }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <perfect-scrollbar
                class="train-questions-body-scroll"
                #resultRankingRightContainer
              >
                <div class="body-content" id="resultsRankingRight">
                  <div class="body-top-content">
                    <!-- customized ActionLog Data Bindin -->
                    <div
                      id="accordion"
                      class="accordion-sec"
                      *ngFor="
                        let actLog of customizedActionLogData;
                        let i = index
                      "
                    >
                      <div class="acc-card" *ngIf="customizedActionLogData">
                        <div class="acc-card-header">
                          <a
                            class="collapsed acc-card-link link-block"
                            data-toggle="collapse"
                            href="#collapse{{ i }}"
                          >
                            <div class="row m-0 row_data">
                              <div class="main-title-text">
                                <div class="img-block">
                                  <img
                                    *ngIf="actLog.contentType"
                                    container="body"
                                    ngbTooltip="{{
                                      actLog.contentType
                                        .substr(0, 1)
                                        .toUpperCase() +
                                        actLog.contentType.substr(1)
                                    }}"
                                    placement="top"
                                    src="{{ actLog.icon }}"
                                    class="cursor-pointer"
                                  />
                                </div>
                                <ng-container *ngIf="actLog.title">
                                  <div class="title">{{ actLog.title }}</div>
                                </ng-container>
                              </div>

                              <ng-container *ngIf="actLog.desc">
                                <div class="desc-text-ranking">
                                  {{ actLog.desc }}
                                </div>
                              </ng-container>

                              <div class="info-data-pinned-or-boostead">
                                <div
                                  class="pinned"
                                  *ngIf="actLog.action"
                                  [ngClass]="{ manual: actLog.addedResult }"
                                >
                                  <img
                                    src="{{ actLog.actionIcon }}"
                                    [ngClass]="{
                                      'rotateimg180-move-up':
                                        actLog.action === 'boosted'
                                    }"
                                  />
                                  <span *ngIf="actLog.action === 'pinned'">{{
                                    'resultRanking_PINNED' | translate
                                  }}</span>
                                  <span *ngIf="actLog.action === 'hidden'">{{
                                    'resultRanking_HIDDEN' | translate
                                  }}</span>
                                  <span *ngIf="actLog.action === 'lowered'"
                                    >{{ actLog.value }}x{{
                                      'resultRanking_LOWERED' | translate
                                    }}</span
                                  >
                                  <span *ngIf="actLog.action === 'boosted'"
                                    >{{ actLog.value }}x{{
                                      'resultRanking_BOOSTED' | translate
                                    }}</span
                                  >
                                </div>
                                <div class="time-stamp">{{ actLog.lMod }}</div>
                              </div>
                              <div
                                class="remove-btn-sec"
                                [ngClass]="{ disableDiv: permisionView }"
                              >
                                <div
                                  class="remove-btn"
                                  (click)="removeRecord(actLog)"
                                >
                                  {{ 'resultRanking_Remove' | translate }}
                                </div>
                              </div>
                            </div>
                          </a>
                        </div>
                        <div
                          id="collapse{{ i }}"
                          class="collapse"
                          data-parent="#accordion"
                        ></div>
                      </div>
                    </div>
                    <!-- customized ActionLog Data Binding -->
                  </div>
                </div>
              </perfect-scrollbar>
            </ng-container>
          </div>
        </div>
      </div>
    </div>

    <div class="log_section_data" [ngClass]="{ 'd-none': !resultLogs }">
      <div class="header-sec">
        <div class="h-title">
          {{ 'resultRanking_LOG' | translate }} ({{ customizeLog.length || 0 }})
        </div>
        <div class="close_icon" (click)="closeLogs()">
          <img src="assets/icons/resultranking/close-log.svg" />
        </div>
      </div>
      <perfect-scrollbar>
        <div
          class="body_content"
          *ngFor="let log of customizeLog; let i = index"
        >
          <div class="accordion_sec" *ngIf="customizeLog">
            <div id="accordion">
              <div class="card-acc">
                <div
                  class="card-header-acc"
                  *ngIf="log && log.action !== 'restored' && log.target"
                >
                  <a
                    class="card-link-acc link-block"
                    data-toggle="collapse"
                    href="#collapse_log_{{ i }}"
                  >
                    {{ log.displayMessage }} - {{ log.target.contentType }}</a
                  >
                  <a
                    class="card-link-acc link-block"
                    data-toggle="collapse"
                    href="#collapse_log_{{ i }}"
                    *ngIf="
                      log.target.contentType &&
                      log.target.contentType === 'task'
                    "
                  >
                    {{ log.displayMessage }} - {{ log.target.contentType }}</a
                  >
                </div>
                <div class="card-header-acc" *ngIf="log.action === 'restored'">
                  <a
                    class="card-link-acc link-block"
                    data-toggle="collapse"
                    href="#collapse_log_{{ i }}"
                  >
                    {{ log.displayMessage }} - {{ log.action }}</a
                  >
                </div>
                <div
                  id="collapse_log_{{ i }}"
                  class="collapse"
                  data-parent="#accordion"
                  *ngIf="log.action !== 'restored'"
                >
                  <div class="card-body-acc" *ngIf="log.target">
                    <div
                      class="question-text"
                      *ngIf="
                        log.target.contentinfo && log.target.contentInfo._source
                      "
                    >
                      {{
                        log.target.contentInfo._source.faq_question ||
                          log.target.contentInfo._source.page_title ||
                          log.target.contentInfo._source.file_title ||
                          log.target.contentInfo._source.strucDataHeadingDis
                      }}
                    </div>
                    <div
                      class="question-text"
                      *ngIf="
                        log.target.contentinfo &&
                        log.target.contentType &&
                        log.target.contentType === 'task'
                      "
                    >
                      {{ log.target.contentInfo.lname }}
                    </div>

                    <div
                      class="ans-info"
                      *ngIf="
                        log.target.contentinfo && log.target.contentInfo._source
                      "
                    >
                      {{
                        log.target.contentInfo._source.page_preview ||
                          log.target.contentInfo._source.file_preview
                      }}
                    </div>
                    <div
                      class="ans-info"
                      *ngIf="
                        log.target.contentinfo &&
                        log.target.contentType &&
                        log.target.contentType === 'task'
                      "
                    >
                      {{ log.target.contentInfo.shortDesc }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="row align-items-center justify-content-end ml-0 mr-0 mt-3"
            >
              <div class="user-name">{{ log.userDetails.fullName }}</div>
              <div class="time-stamp">{{ log.createdOn }}</div>
            </div>
          </div>
        </div>
      </perfect-scrollbar>
    </div>
  </div>
</div>
